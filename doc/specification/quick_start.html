<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kstryä¸šåŠ¡æ¶æ„é¦–é€‰æ¡†æ¶</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="Kstryä½¿ç”¨æ–‡æ¡£">
    
    <link rel="preload" href="/assets/css/0.styles.9634fd34.css" as="style"><link rel="preload" href="/assets/js/app.fc8f11ce.js" as="script"><link rel="preload" href="/assets/js/2.6d18f2ff.js" as="script"><link rel="preload" href="/assets/js/5.a021e58e.js" as="script"><link rel="prefetch" href="/assets/js/10.976139c2.js"><link rel="prefetch" href="/assets/js/11.cee08e74.js"><link rel="prefetch" href="/assets/js/12.b8c547b5.js"><link rel="prefetch" href="/assets/js/13.63a0d034.js"><link rel="prefetch" href="/assets/js/14.8cab9faf.js"><link rel="prefetch" href="/assets/js/15.349558f5.js"><link rel="prefetch" href="/assets/js/16.0d2fbd26.js"><link rel="prefetch" href="/assets/js/17.af43253d.js"><link rel="prefetch" href="/assets/js/3.84f41dcf.js"><link rel="prefetch" href="/assets/js/4.32e6db9d.js"><link rel="prefetch" href="/assets/js/6.8b7c2b97.js"><link rel="prefetch" href="/assets/js/7.c487ae2f.js"><link rel="prefetch" href="/assets/js/8.81adceba.js"><link rel="prefetch" href="/assets/js/9.c1a65384.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9634fd34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="http://cdn.kstry.cn/doc/img/title-field.png" alt="Kstryä¸šåŠ¡æ¶æ„é¦–é€‰æ¡†æ¶" class="logo"> <span class="site-name can-hide">Kstryä¸šåŠ¡æ¶æ„é¦–é€‰æ¡†æ¶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><a href="/doc/understandkstry/use_case_demo.html" class="nav-link">
  ä½¿ç”¨åœºæ™¯
</a></div><div class="nav-item"><a href="/doc/specification/quick_start.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ä½¿ç”¨æ–‡æ¡£
</a></div><div class="nav-item"><a href="http://kstry.cn/modeler" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é…ç½®å°
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/doc/release/kstry-release.html" class="nav-link">
  å‘å¸ƒè®°å½•
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ¨è" class="dropdown-title"><span class="title">æ¨è</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ¨è" class="mobile-dropdown-title"><span class="title">æ¨è</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://waitmoon.com/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è§„åˆ™å¼•æ“â€”ice
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/kstry/kstry-core" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/kstry/kstry-core" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><a href="/doc/understandkstry/use_case_demo.html" class="nav-link">
  ä½¿ç”¨åœºæ™¯
</a></div><div class="nav-item"><a href="/doc/specification/quick_start.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ä½¿ç”¨æ–‡æ¡£
</a></div><div class="nav-item"><a href="http://kstry.cn/modeler" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é…ç½®å°
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/doc/release/kstry-release.html" class="nav-link">
  å‘å¸ƒè®°å½•
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ¨è" class="dropdown-title"><span class="title">æ¨è</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ¨è" class="mobile-dropdown-title"><span class="title">æ¨è</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://waitmoon.com/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è§„åˆ™å¼•æ“â€”ice
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/kstry/kstry-core" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/kstry/kstry-core" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/doc/specification/quick_start" class="sidebar-heading clickable open"><span>ä½¿ç”¨æ–‡æ¡£</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/specification/quick_start.html" aria-current="page" class="active sidebar-link">ä¸€ã€å¿«é€Ÿå¼€å§‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-1-é…ç½®å¼•å…¥" class="sidebar-link">1.1 é…ç½®å¼•å…¥</a></li><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-2-é¡¹ç›®å¼•å…¥" class="sidebar-link">1.2 é¡¹ç›®å¼•å…¥</a></li><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-3-ä¸šåŠ¡å®ä½“å®šä¹‰" class="sidebar-link">1.3 ä¸šåŠ¡å®ä½“å®šä¹‰</a></li><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-4-å®šä¹‰å‡ºå…¥å‚åŠæ•°æ®ä¼ é€’ç±»" class="sidebar-link">1.4 å®šä¹‰å‡ºå…¥å‚åŠæ•°æ®ä¼ é€’ç±»</a></li><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-5-ç¼–å†™æœåŠ¡ç»„ä»¶" class="sidebar-link">1.5 ç¼–å†™æœåŠ¡ç»„ä»¶</a></li><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-6-å®šä¹‰æœåŠ¡æµç¨‹" class="sidebar-link">1.6 å®šä¹‰æœåŠ¡æµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-6-1-bpmnæ ¼å¼å®šä¹‰æµç¨‹" class="sidebar-link">1.6.1 BPMNæ ¼å¼å®šä¹‰æµç¨‹</a></li><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-6-2-jsonæ ¼å¼å®šä¹‰æµç¨‹" class="sidebar-link">1.6.2 JSONæ ¼å¼å®šä¹‰æµç¨‹</a></li><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-6-3-ä»£ç æ–¹å¼å®šä¹‰æµç¨‹" class="sidebar-link">1.6.3 ä»£ç æ–¹å¼å®šä¹‰æµç¨‹</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-7-è°ƒç”¨æ‰§è¡Œ" class="sidebar-link">1.7 è°ƒç”¨æ‰§è¡Œ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-7-1-åŒæ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ" class="sidebar-link">1.7.1 åŒæ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ</a></li><li class="sidebar-sub-header"><a href="/doc/specification/quick_start.html#_1-7-2-å¼‚æ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ" class="sidebar-link">1.7.2 å¼‚æ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ</a></li></ul></li></ul></li><li><a href="/doc/specification/process_choreography.html" class="sidebar-link">äºŒã€æµç¨‹ç¼–æ’</a></li><li><a href="/doc/specification/data_transfer.html" class="sidebar-link">ä¸‰ã€æ•°æ®æµè½¬</a></li><li><a href="/doc/specification/rbac_model.html" class="sidebar-link">å››ã€RBACæ¨¡å¼</a></li><li><a href="/doc/specification/use_variable.html" class="sidebar-link">äº”ã€å˜é‡</a></li><li><a href="/doc/specification/link_tracing.html" class="sidebar-link">å…­ã€é“¾è·¯è¿½è¸ª</a></li><li><a href="/doc/specification/appendix.html" class="sidebar-link">é™„å½•</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><br> <br> <br> <p><a data-fancybox="" title="æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯æµç¨‹å®šä¹‰" href="../img2/e25009a28fddcdeed786aff92a414151.png"><img src="/assets/img/e25009a28fddcdeed786aff92a414151.ec6f83fc.png" alt="image-WX20230926"></a></p> <p><strong>å‡è®¾è¦å®ç°ä»¥ä¸Š <em>å­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢æµç¨‹</em> ä¸­çš„é€»è¾‘ï¼š</strong></p> <p>Â Â Â Â ğŸŸ¢ æµç¨‹å¼€å§‹ååˆ†åˆ«æŸ¥è¯¢å­¦ç”ŸåŸºç¡€ä¿¡æ¯ã€æ•æ„Ÿä¿¡æ¯ï¼Œå†å°†ä¸¤ç§ä¿¡æ¯è¿›è¡Œç»„åˆè£…é…</p> <p>Â Â Â Â ğŸŸ¢ å¦‚æœéœ€è¦å±•ç¤ºåˆ†æ•°åˆ—è¡¨çš„è¯ï¼Œæµç¨‹å¼€å§‹æ—¶è¿˜ä¼šæŸ¥è¯¢å­¦ç”Ÿå­¦å¹´åˆ—è¡¨ï¼Œå†é€šè¿‡å­¦å¹´åˆ—è¡¨åˆ†åˆ«æŸ¥è¯¢ç­çº§å’Œåˆ†æ•°ä¿¡æ¯å¹¶ç»„åˆè£…é…</p> <p>Â Â Â Â ğŸŸ¢ æœ€åå°†å­¦ç”Ÿä¿¡æ¯å’Œåˆ†æ•°ä¿¡æ¯ç»„åˆè£…é…å¹¶è¿”å›ç»“æœ</p> <h2 id="_1-1-é…ç½®å¼•å…¥"><a href="#_1-1-é…ç½®å¼•å…¥" class="header-anchor">#</a> 1.1 é…ç½®å¼•å…¥</h2> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.kstry.framework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kstry-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>æœ€æ–°ç‰ˆæœ¬<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><a href="https://central.sonatype.com/artifact/cn.kstry.framework/kstry-core/overview" target="_blank" rel="noopener noreferrer">æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_1-2-é¡¹ç›®å¼•å…¥"><a href="#_1-2-é¡¹ç›®å¼•å…¥" class="header-anchor">#</a> 1.2 é¡¹ç›®å¼•å…¥</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Kstryæ¡†æ¶ä¸Springå®¹å™¨æœ‰è¾ƒä¸ºå¯†åˆ‡çš„å…³è”å’Œä¾èµ–ï¼Œå½“å‰ç‰ˆæœ¬æš‚æ—¶åªèƒ½åœ¨Springç¯å¢ƒä¸­è¿è¡Œ</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableKstry</span><span class="token punctuation">(</span>bpmnPath <span class="token operator">=</span> <span class="token string">&quot;./bpmn/*.bpmn,./bpmn/*.json&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KstryFluxDemoApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">KstryFluxDemoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong><code>@EnableKstry</code>æ³¨è§£ä»£è¡¨äº†è¦å¯åŠ¨Kstryå®¹å™¨</strong></p> <p>Â Â Â Â ğŸŸ¢ <code>bpmnPath</code>ï¼š æŒ‡å®šbpmnæ–‡ä»¶ä½ç½®ï¼Œå¤šä¸ªè·¯å¾„å¯ä»¥é€šè¿‡<code>,</code>éš”å¼€ã€‚æ”¯æŒbpmnã€jsonä¸¤ç§æµç¨‹é…ç½®æ–‡ä»¶æ ¼å¼</p> <h2 id="_1-3-ä¸šåŠ¡å®ä½“å®šä¹‰"><a href="#_1-3-ä¸šåŠ¡å®ä½“å®šä¹‰" class="header-anchor">#</a> 1.3 ä¸šåŠ¡å®ä½“å®šä¹‰</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// å­¦ç”ŸåŸºç¡€ä¿¡æ¯</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentBasic</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å­¦ç”Ÿæ•æ„Ÿä¿¡æ¯</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentPrivacy</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> idCard<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> birthday<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å­¦ç”Ÿå…¨é‡ä¿¡æ¯</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> idCard<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> birthday<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å­¦å¹´ä¿¡æ¯</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudyExperience</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> studentId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> classId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> studyYear<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆ†æ•°ä¿¡æ¯</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScoreInfo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> score<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> studentId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> studyYear<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> course<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> classId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">ClassInfo</span> classInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç­çº§ä¿¡æ¯</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassInfo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><h2 id="_1-4-å®šä¹‰å‡ºå…¥å‚åŠæ•°æ®ä¼ é€’ç±»"><a href="#_1-4-å®šä¹‰å‡ºå…¥å‚åŠæ•°æ®ä¼ é€’ç±»" class="header-anchor">#</a> 1.4 å®šä¹‰å‡ºå…¥å‚åŠæ•°æ®ä¼ é€’ç±»</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// å…¥å‚</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@FieldNameConstants</span><span class="token punctuation">(</span>innerTypeName <span class="token operator">=</span> <span class="token string">&quot;F&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryScoreRequest</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> studentId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> needScore<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å‡ºå‚</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@FieldNameConstants</span><span class="token punctuation">(</span>innerTypeName <span class="token operator">=</span> <span class="token string">&quot;F&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryScoreResponse</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Student</span> student<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScoreInfo</span><span class="token punctuation">&gt;</span></span> scoreInfos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¯¹è±¡å½¢å¼å®šä¹‰varæ•°æ®åŸŸ</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@FieldNameConstants</span><span class="token punctuation">(</span>innerTypeName <span class="token operator">=</span> <span class="token string">&quot;F&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryScoreVarScope</span> <span class="token keyword">implements</span> <span class="token class-name">ScopeData</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">StudentBasic</span> studentBasic<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">StudentPrivacy</span> studentPrivacy<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> student<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudyExperience</span><span class="token punctuation">&gt;</span></span> studyExperienceList<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> classIds<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ClassInfo</span><span class="token punctuation">&gt;</span></span> classInfos<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScoreInfo</span><span class="token punctuation">&gt;</span></span> scoreInfos<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ScopeTypeEnum</span> <span class="token function">getScopeDataEnum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>Â Â Â Â ğŸŸ¢ <code>QueryScoreRequest</code>ã€<code>QueryScoreResponse</code>åˆ†åˆ«ä¸ºæµç¨‹æ‰§è¡Œçš„å‡ºå…¥å‚</p> <p>Â Â Â Â ğŸŸ¢ <code>@FieldNameConstants(innerTypeName = &quot;F&quot;)</code>æ˜¯lombokå·¥å…·æ³¨è§£ï¼Œå¯ä»¥è¯»å–ç±»ä¸­çš„å­—æ®µå¹¶è‡ªåŠ¨ç”Ÿæˆä¸å­—æ®µåç›¸åŒçš„ç±»å¸¸é‡ã€‚æ¯”å¦‚<code>QueryScoreRequest</code>ä¸­çš„<code>studentId</code>å˜é‡ï¼Œå› ä¸ºåŠ äº†æ­¤æ³¨è§£ï¼Œ<code>QueryScoreRequest</code>ç±»ä¸­ä¼šå¤šå‡ºä¸€ä¸ªåä¸ºFçš„ç±»ï¼Œé‡Œé¢ä¼šå®šä¹‰<code>public static String studentId = &quot;studentId&quot;;</code>å¸¸é‡å­—æ®µ</p> <p>Â Â Â Â ğŸŸ¢ Kstryæ¡†æ¶ä¸­æœ‰reqã€varã€staã€reså››ä¸ªæ•°æ®åŸŸ</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <strong>req</strong>ï¼šä¿å­˜è¯·æ±‚ä¼ å…¥çš„requestå¯¹è±¡ï¼Œä¾‹å­ä¸­ä¾¿æ˜¯æŒ‡<code>QueryScoreRequest</code></p> <p>Â Â Â Â Â Â Â Â ğŸ”· <strong>var</strong>ï¼šä¿å­˜èŠ‚ç‚¹æ‰§è¡Œå®Œæˆåäº§ç”Ÿçš„å˜é‡ã€‚<code>QueryScoreVarScope</code>å®ç°<code>ScopeData</code>æ¥å£ï¼Œé‡å†™<code>getScopeDataEnum()</code>æ–¹æ³•è¿”å›<code>ScopeTypeEnum.VARIABLE</code>ã€‚æ˜¯ä»¥å¯¹è±¡çš„å½¢å¼å®šä¹‰äº†varæ•°æ®åŸŸ</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <strong>sta</strong>ï¼šå’Œvarä¸€æ ·ä¹Ÿæ˜¯ä¿å­˜èŠ‚ç‚¹æ‰§è¡Œå®Œæˆåäº§ç”Ÿçš„å˜é‡ã€‚åªæ˜¯ä¿å­˜åçš„ç»“æœä¸å¯å˜ã€‚å¯ä»¥ç†è§£æˆvaræ˜¯HasMapï¼Œstaæ˜¯ImmutableMap</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <strong>res</strong>ï¼šä¿å­˜è¯·æ±‚ä¼ å…¥çš„responseå¯¹è±¡ï¼Œä¾‹å­ä¸­ä¾¿æ˜¯æŒ‡<code>QueryScoreResponse</code></p> <h2 id="_1-5-ç¼–å†™æœåŠ¡ç»„ä»¶"><a href="#_1-5-ç¼–å†™æœåŠ¡ç»„ä»¶" class="header-anchor">#</a> 1.5 ç¼–å†™æœåŠ¡ç»„ä»¶</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TaskComponent</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentScoreService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * æ³¨å†Œnameä¸ºï¼šgetStudentBasic æè¿°ä¿¡æ¯ä¸ºï¼šæŸ¥è¯¢å­¦ç”ŸåŸºæœ¬ä¿¡æ¯ çš„æœåŠ¡èŠ‚ç‚¹æ–¹æ³•
     *
     * @param id ä»reqåŸŸä¸­è·å–å˜é‡åä¸ºstudentIdçš„å€¼ï¼Œå¹¶èµ‹å€¼ç»™æ–¹æ³•å…¥å‚id
     * @return å°†æ–¹æ³•è¿”å›ç»“æœé€šçŸ¥åˆ°varåŸŸçš„studentBasicå˜é‡ä¸Š
     */</span>
    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;æŸ¥è¯¢å­¦ç”ŸåŸºæœ¬ä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@NoticeVar</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studentBasic<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">StudentBasic</span> <span class="token function">getStudentBasic</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ReqTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreRequest<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studentId<span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// mock return result</span>
        <span class="token class-name">StudentBasic</span> studentBasic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StudentBasic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentBasic<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentBasic<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;XXçœXXå¸‚XXåŒº&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentBasic<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;å¼ ä¸€&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> studentBasic<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;æŸ¥è¯¢å­¦ç”Ÿæ•æ„Ÿä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@NoticeVar</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studentPrivacy<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">StudentPrivacy</span> <span class="token function">getStudentPrivacy</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ReqTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreRequest<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studentId<span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// mock return result</span>
        <span class="token class-name">StudentPrivacy</span> studentPrivacy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StudentPrivacy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentPrivacy<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentPrivacy<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token string">&quot;1994-01-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentPrivacy<span class="token punctuation">.</span><span class="token function">setIdCard</span><span class="token punctuation">(</span><span class="token string">&quot;133133199401012345&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> studentPrivacy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;è£…é…å­¦ç”Ÿä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@NoticeVar</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>student<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Student</span> <span class="token function">assembleStudentInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studentBasic<span class="token punctuation">)</span> <span class="token class-name">StudentBasic</span> studentBasic<span class="token punctuation">,</span>
                                       <span class="token annotation punctuation">@VarTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studentPrivacy<span class="token punctuation">)</span> <span class="token class-name">StudentPrivacy</span> studentPrivacy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>studentBasic<span class="token punctuation">,</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>studentPrivacy<span class="token punctuation">,</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> student<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;è·å–å­¦ç”Ÿå­¦å¹´åˆ—è¡¨&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@NoticeVar</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studyExperienceList<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudyExperience</span><span class="token punctuation">&gt;</span></span> <span class="token function">getStudyExperienceList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ReqTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreRequest<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studentId<span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// mock return result</span>
        <span class="token keyword">return</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>
                <span class="token class-name">StudyExperience</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studentId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">classId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studyYear</span><span class="token punctuation">(</span><span class="token string">&quot;2013-1-2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">StudyExperience</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studentId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">classId</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studyYear</span><span class="token punctuation">(</span><span class="token string">&quot;2014-1-2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">StudyExperience</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studentId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">classId</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studyYear</span><span class="token punctuation">(</span><span class="token string">&quot;2015-1-2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æœåŠ¡èŠ‚ç‚¹å¯ä»¥å®šä¹‰æŒ‡å®šå¯¹æ•°æ®åŸŸä¸­çš„æŸä¸ªé›†åˆå˜é‡è¿›è¡Œéå†æ‰§è¡Œ
     *      sourceScope = ScopeTypeEnum.VARIABLE  æŒ‡è¦å¯¹varåŸŸçš„å˜é‡è¿›è¡Œéå†
     *      source = QueryScoreVarScope.F.classIds æŒ‡å¯¹varåŸŸä¸­åä¸ºclassIdsçš„é›†åˆå˜é‡è¿›è¡Œéå†
     *      async = true        æŒ‡å¼€å¯å¹¶å‘éå†æ¨¡å¼
     *      strategy = IterateStrategyEnum.BEST_SUCCESS     æŒ‡ä½¿ç”¨bestç­–ç•¥éå†ï¼Œbestç­–ç•¥å¯ä»¥åšåˆ°è¿­ä»£é›†åˆä¸­çš„å…¨éƒ¨é¡¹ï¼Œæ‰§è¡Œå¤±è´¥ä¼šè¢«å¿½ç•¥ï¼Œå°†ä¼šå°½é‡å¤šçš„æ‹¿åˆ°æˆåŠŸé¡¹
     *
     * @param classIdItem  IterDataItem ç±»æ˜¯æ¡†æ¶å†…éƒ¨ç±»å‹ï¼Œç›´æ¥æ”¾åˆ°æœåŠ¡èŠ‚ç‚¹æ–¹æ³•å…¥å‚ä¸Šï¼Œç”¨æ¥æ¥æ”¶éå†é¡¹ä¿¡æ¯
     * @return @NoticeVar(target = QueryScoreVarScope.F.classInfos) æŒ‡å®šè¦å°†è¿”å›ç»“æœé€šçŸ¥åˆ°varåŸŸä¸­çš„classInfoså˜é‡ä¸Šï¼ŒclassInfoså˜é‡æ˜¯Listç±»å‹ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨å°†æ‰€æœ‰å•ä¸ªå…ƒç´ ç»„åˆæˆListè¿”å›ç»™å˜é‡
     */</span>
    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;æŸ¥è¯¢ç­çº§ä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
            iterator <span class="token operator">=</span> <span class="token annotation punctuation">@Iterator</span><span class="token punctuation">(</span>sourceScope <span class="token operator">=</span> <span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">,</span> source <span class="token operator">=</span> <span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>classIds<span class="token punctuation">,</span> async <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> strategy <span class="token operator">=</span> <span class="token class-name">IterateStrategyEnum</span><span class="token punctuation">.</span>BEST_SUCCESS<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@NoticeVar</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>classInfos<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ClassInfo</span> <span class="token function">getClasInfoById</span><span class="token punctuation">(</span><span class="token class-name">IterDataItem</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> classIdItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// mock return result</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> idOptional <span class="token operator">=</span> classIdItem<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClassInfo</span> classInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        classInfo<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>idOptional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        classInfo<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;ç­çº§&quot;</span> <span class="token operator">+</span> idOptional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> classInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;æŸ¥è¯¢å­¦ç”Ÿåˆ†æ•°åˆ—è¡¨&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@NoticeVar</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>scoreInfos<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScoreInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getStudentScoreList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studyExperienceList<span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudyExperience</span><span class="token punctuation">&gt;</span></span> studyExperienceList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// mock return result</span>
        <span class="token keyword">return</span> studyExperienceList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>se <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScoreInfo</span><span class="token punctuation">&gt;</span></span> scoreInfos <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>
                    <span class="token class-name">ScoreInfo</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studentId</span><span class="token punctuation">(</span>se<span class="token punctuation">.</span><span class="token function">getStudentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">classId</span><span class="token punctuation">(</span>se<span class="token punctuation">.</span><span class="token function">getClassId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studyYear</span><span class="token punctuation">(</span>se<span class="token punctuation">.</span><span class="token function">getStudyYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">course</span><span class="token punctuation">(</span><span class="token string">&quot;è¯­æ–‡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">score</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">ScoreInfo</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studentId</span><span class="token punctuation">(</span>se<span class="token punctuation">.</span><span class="token function">getStudentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">classId</span><span class="token punctuation">(</span>se<span class="token punctuation">.</span><span class="token function">getClassId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studyYear</span><span class="token punctuation">(</span>se<span class="token punctuation">.</span><span class="token function">getStudyYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">course</span><span class="token punctuation">(</span><span class="token string">&quot;æ•°å­¦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">score</span><span class="token punctuation">(</span><span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> scoreInfos<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;ç»„è£…æˆç»©åŠç­çº§ä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">assembleScoreClassInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>scoreInfos<span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScoreInfo</span><span class="token punctuation">&gt;</span></span> scoreInfos<span class="token punctuation">,</span>
                                       <span class="token annotation punctuation">@VarTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>classInfos<span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ClassInfo</span><span class="token punctuation">&gt;</span></span> classInfos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">ClassInfo</span><span class="token punctuation">&gt;</span></span> classInfoMap <span class="token operator">=</span> classInfos<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">ClassInfo</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scoreInfos<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>scoreInfo <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">ClassInfo</span> classInfo <span class="token operator">=</span> classInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>scoreInfo<span class="token punctuation">.</span><span class="token function">getClassId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>classInfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            scoreInfo<span class="token punctuation">.</span><span class="token function">setClassInfo</span><span class="token punctuation">(</span>classInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NoticeResult</span>
    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;å„ç»´åº¦ä¿¡æ¯èšåˆ&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">QueryScoreResponse</span> <span class="token function">getQueryScoreResponse</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>student<span class="token punctuation">)</span> <span class="token class-name">Student</span> student<span class="token punctuation">,</span>
                                                    <span class="token annotation punctuation">@VarTaskParam</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>scoreInfos<span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScoreInfo</span><span class="token punctuation">&gt;</span></span> scoreInfos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">QueryScoreResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryScoreResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setStudent</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setScoreInfos</span><span class="token punctuation">(</span>scoreInfos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br></div></div><p><strong><code>@TaskComponent</code>ä½œç”¨ï¼š</strong></p> <p>Â Â Â Â ğŸŸ¢ ä¸ Spring å®¹å™¨ä¸­<code>@Component</code>æ³¨è§£æœ‰ç€ç›¸åŒçš„ä½œç”¨ï¼Œå°†è¢«æ ‡æ³¨çš„ç±»ç»„ä»¶æ‰˜ç®¡è‡³Springå®¹å™¨ä¸­</p> <p>Â Â Â Â ğŸŸ¢ æŒ‡å®šè¯¥ç±»æˆä¸ºäº† Kstry å®¹å™¨å¯è§£æçš„ä»»åŠ¡ç»„ä»¶ï¼Œå¯åœ¨å…¶ä¸­å®šä¹‰æœåŠ¡èŠ‚ç‚¹ï¼ˆè¢«<code>@TaskService</code>æ³¨è§£ä¿®é¥°çš„æ–¹æ³•ç§°ä¸º<strong>æœåŠ¡èŠ‚ç‚¹</strong>ï¼‰</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <code>name</code>ï¼šæŒ‡å®šç»„ä»¶åç§°ï¼Œä¸ bpmn æµç¨‹é…ç½®æ–‡ä»¶ä¸­<code>task-component</code>å±æ€§å¯¹åº”ï¼Œé»˜è®¤ä¸ºé¦–å­—æ¯å°å†™çš„ç±»å</p> <p><strong><code>@TaskService</code>ä½œç”¨ï¼š</strong></p> <p>Â Â Â Â ğŸŸ¢ æŒ‡å®šè¯¥æ–¹æ³•æ˜¯Kstryå®¹å™¨ä¸­çš„æœåŠ¡èŠ‚ç‚¹ï¼Œä¹Ÿæ˜¯åœ¨bpmné…ç½®æ–‡ä»¶ä¸­å¯ç¼–æ’çš„æœ€å°æ‰§è¡Œå•å…ƒï¼Œå¯¹åº”äºbpmné…ç½®æ–‡ä»¶ä¸­çš„<code>bpmn:serviceTask</code>èŠ‚ç‚¹</p> <p>Â Â Â Â ğŸŸ¢ è¯¥æ³¨è§£åªèƒ½å®šä¹‰åœ¨Kstryå®¹å™¨å¯è§£æçš„ä»»åŠ¡ç»„ä»¶ç±»ä¸­ï¼Œå¦åˆ™å°†ä¸è¢«è§£æ</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <code>name</code>ï¼šæŒ‡å®šè¯¥æœåŠ¡èŠ‚ç‚¹çš„åç§°ï¼Œä¸ bpmn é…ç½®æ–‡ä»¶ä¸­çš„<code>task-service</code>å±æ€§è¿›è¡ŒåŒ¹é…å¯¹åº”ï¼Œé»˜è®¤ä¸ºæ–¹æ³•å</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <code>desc</code>ï¼šèŠ‚ç‚¹æè¿°ä¿¡æ¯ã€‚æµç¨‹é…ç½®ä¸­æœªæŒ‡å®šèŠ‚ç‚¹åç§°æ—¶ï¼Œå°è¯•è·å–<code>@TaskService</code>æ³¨è§£çš„<code>desc</code>å±æ€§ä½œä¸ºname</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <code>iterator</code>ï¼šæŒ‡å®šéå†ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢ä»£ç ä¸­çš„æ³¨é‡Šï¼Œä¹Ÿå¯è·³è½¬è‡³åé¢çš„æ–‡æ¡£äº†è§£èµ„æºéå†åŠŸèƒ½è¯¦æƒ…</p> <p><strong><code>@NoticeResult</code>ä½œç”¨ï¼š</strong></p> <p>Â Â Â Â ğŸŸ¢ æŒ‡å®šæ‰§è¡Œç»“æœå°†è¢«é€šçŸ¥åˆ°StoryBusä¸­çš„å“ªäº›ä½œç”¨åŸŸä¸­ï¼Œ<code>@NoticeResult</code>è¯´æ˜ï¼Œè¯¥æ–¹æ³•æ‰§è¡Œç»“æœå°†è¢«é€šçŸ¥åˆ°resultåŸŸï¼Œæœ€ç»ˆä½œä¸ºStoryçš„æ‰§è¡Œç»“æœè¿”å›ç»™è°ƒç”¨æ–¹</p> <p><strong><code>@VarTaskParam</code>ä½œç”¨ï¼š</strong></p> <p>Â Â Â Â ğŸŸ¢ <code>@VarTaskParam</code>æ ‡æ³¨åœ¨æœåŠ¡èŠ‚ç‚¹çš„æ–¹æ³•å‚æ•°ä¸Šï¼Œç”¨æ¥ä»StoryBusçš„varåŸŸè·å–å˜é‡å€¼ï¼Œå¹¶ç›´æ¥èµ‹å€¼ç»™è¢«æ ‡æ³¨çš„å‚æ•°é¡¹</p> <p><strong><code>@ReqTaskParam</code>ä½œç”¨ï¼š</strong></p> <p>Â Â Â Â ğŸŸ¢ <code>@ReqTaskParam</code>æ ‡æ³¨åœ¨æœåŠ¡èŠ‚ç‚¹çš„æ–¹æ³•å‚æ•°ä¸Šï¼Œç”¨æ¥ä»StoryBusçš„reqåŸŸè·å–å˜é‡å€¼ï¼Œå¹¶ç›´æ¥èµ‹å€¼ç»™è¢«æ ‡æ³¨çš„å‚æ•°é¡¹</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <code>reqSelf</code>ï¼šåªæœ‰ä»reqåŸŸè·å–å‚æ•°æ—¶æ‰æœ‰è¿™ä¸ªå±æ€§ï¼Œè¯¥å±æ€§ä»£è¡¨å°†å®¢æˆ·ç«¯ä¼ å…¥çš„requestå¯¹è±¡ç›´æ¥èµ‹å€¼ç»™è¢«æ ‡æ³¨çš„å‚æ•°é¡¹</p> <h2 id="_1-6-å®šä¹‰æœåŠ¡æµç¨‹"><a href="#_1-6-å®šä¹‰æœåŠ¡æµç¨‹" class="header-anchor">#</a> 1.6 å®šä¹‰æœåŠ¡æµç¨‹</h2> <p>Â Â Â Â æ¡†æ¶æ”¯æŒBPMNã€JSONã€ä»£ç ä¸‰ç§æ–‡ä»¶æ ¼å¼çš„æµç¨‹å®šä¹‰ã€‚å…¶ä¸­BPMNã€JSONä¸¤ç§æ ¼å¼å¯ä»¥é€šè¿‡æ–‡ä»¶æ”¾å…¥resourcesç›®å½•ã€é¡¹ç›®å¯åŠ¨æ—¶è§£ææ³¨å†Œã€ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹ä¸‰ç§æ–¹å¼æ¥æ³¨å†Œä½¿ç”¨ã€‚ä¸‰ç§æ³¨å†Œæ–¹å¼åé¢æ–‡æ¡£ä¼šè¯¦ç»†ä»‹ç»ï¼Œå½“å‰å°†åˆ†åˆ«ä»‹ç»å¦‚ä½•é€šè¿‡ä¸‰ç§ä¸åŒçš„æ–‡ä»¶æ ¼å¼æ¥å®šä¹‰ä¸Šè¿°æµç¨‹ã€‚ç›®å‰æ¥è®²ï¼ŒBPMNã€JSONä¸¤ç§æ–‡ä»¶å®šä¹‰æµç¨‹æ—¶ï¼Œåªéœ€çŸ¥é“å°†æµç¨‹é…ç½®æ–‡ä»¶æ”¾åˆ°resourcesç›®å½•å¹¶é…ç½®<code>@EnableKstry(bpmnPath = &quot;./bpmn/*.bpmn,./bpmn/*.json&quot;)</code>ä½¿å¯åŠ¨ç±»å¯ä»¥è§£æåˆ°å³å¯ã€‚</p> <h3 id="_1-6-1-bpmnæ ¼å¼å®šä¹‰æµç¨‹"><a href="#_1-6-1-bpmnæ ¼å¼å®šä¹‰æµç¨‹" class="header-anchor">#</a> 1.6.1 BPMNæ ¼å¼å®šä¹‰æµç¨‹</h3> <p>Â Â Â Â ä¸šåŠ¡æµç¨‹å»ºæ¨¡ç¬¦å·BPMN(Business Process Modeling Notation)æ˜¯BPMI(The Business Process Management Initiative)å¼€å‘çš„ä¸€å¥—å¯è§†åŒ–æµç¨‹å»ºæ¨¡æ ‡å‡†(BPMN)ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯æä¾›ä¸€äº›è¢«æ‰€æœ‰ä¸šåŠ¡ç”¨æˆ·å®¹æ˜“ç†è§£çš„ç¬¦å·ï¼Œæ‹¼è£…ç»„åˆæˆæµç¨‹å›¾ï¼Œè¿›è€Œä½¿ç›¸å…³æ–¹å¯ä»¥ç®€å•ç›´è§‚çš„ä»æµç¨‹çš„è½®å»“åˆ†æåˆ°è¿™äº›æµç¨‹çš„ä¸šåŠ¡å®ç°ã€‚Kstryæ¡†æ¶æ”¯æŒäº†éƒ¨åˆ†BPMNç¬¦å·è¯­æ³•ï¼Œå¯ä»¥æä¸ºæ–¹ä¾¿çš„å®Œæˆç³»ç»Ÿä¸­å¤æ‚ä¸šåŠ¡çš„å¯è§†åŒ–æµç¨‹å®šä¹‰ã€‚å¹¶æä¾›äº†æµç¨‹é…ç½®æ§åˆ¶å°ï¼š<a href="http://kstry.cn/modeler/" target="_blank" rel="noopener noreferrer">é…ç½®å°åœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a data-fancybox="" title="æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯æµç¨‹å®šä¹‰" href="../img2/e25009a28fddcdeed786aff92a414151.png"><img src="/assets/img/e25009a28fddcdeed786aff92a414151.ec6f83fc.png" alt="image-WX20230926"></a></p> <p>Â Â Â Â åœ¨é…ç½®å°ä¸­å®šä¹‰å¦‚ä¸Šæµç¨‹ï¼ˆ<a href="http://" target="_blank" rel="noopener noreferrer">æµç¨‹æ–‡ä»¶åœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºå¯å°†å®šä¹‰å¥½çš„æµç¨‹å¤åˆ¶åˆ°ç²˜è´´æ¿ã€‚ä¹‹ååœ¨é¡¹ç›®çš„<code>resources/bpmn/</code>è·¯å¾„ä¸‹åˆ›å»ºæ‰©å±•åä¸º<code>.bpmn</code>çš„æ–‡ä»¶å¹¶å°†ç²˜è´´æ¿çš„å†…å®¹å¤åˆ¶è¿›æ–‡ä»¶å†…ã€‚æ¯”å¦‚å®šä¹‰æ–‡ä»¶åï¼š<code>student-score-query-process.bpmn</code></p> <p><a data-fancybox="" title="å°†æ–‡ä»¶å¤åˆ¶åˆ°ç²˜è´´æ¿ç¤ºæ„å›¾" href="../img2/286065efa03a6a2cc4531e6dc3dd7e17.png"><img src="/assets/img/286065efa03a6a2cc4531e6dc3dd7e17.c34eb498.png" alt="image-WX20230926"></a></p> <p>Â Â Â Â ä¸Šé¢çš„æµç¨‹å¯ä»¥çœ‹å‡ºï¼ŒBPMNæ–‡ä»¶è™½ç„¶å¯ä»¥å±•ç¤ºæµç¨‹å›¾ä½†å¹¶éæ˜¯å›¾ç‰‡æ–‡ä»¶ï¼Œè€Œæ˜¯æ–‡æœ¬æ–‡ä»¶ã€‚è€Œåœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ä¹Ÿæ˜¯å¤šç”±XMLæ–‡ä»¶çš„æ ¼å¼æ¥è¡¨ç¤ºã€‚æµç¨‹æ–‡ä»¶è¢«å®šä¹‰å‡ºæ¥ä¹‹åä¾¿å¯ä»¥é€šè¿‡å¼•æ“è§£ææ‰§è¡Œäº†ã€‚ä¸‹é¢æ˜¯ä»‹ç»ä¸Šè¿°æµç¨‹å›¾ä¸­çš„ä¸€äº›é…ç½®ç»†èŠ‚ã€‚</p> <p><a data-fancybox="" title="å®šä¹‰æœåŠ¡èŠ‚ç‚¹" href="../img2/3058c865359fd9b4b6bb4d6a71dda682.png"><img src="/assets/img/3058c865359fd9b4b6bb4d6a71dda682.914f46f9.png" alt="image-WX20230926"></a></p> <p>Â Â Â Â ä¸Šå›¾å±•ç¤ºäº†å®šä¹‰ <em>æŸ¥è¯¢å­¦ç”ŸåŸºæœ¬ä¿¡æ¯</em> æœåŠ¡èŠ‚ç‚¹çš„é…ç½®ã€‚<code>task-component</code>çš„å€¼ä¸æœåŠ¡ç»„ä»¶åå³ä»£ç ä¸­çš„ç±»åç›¸å¯¹åº”ï¼ˆnameå±æ€§ä¸ºç©ºæ—¶é»˜è®¤å–çš„æ˜¯ç±»åé¦–å­—æ¯å°å†™ï¼‰ï¼Œ<code>task-service</code>çš„å€¼ä¸æœåŠ¡èŠ‚ç‚¹æ–¹æ³•å³ä»£ç ä¸­çš„æ–¹æ³•åç›¸å¯¹åº”ã€‚å½“<code>task-service</code>çš„å€¼åœ¨å½“å‰åº”ç”¨ä¸­å…¨å±€å”¯ä¸€æ—¶ï¼Œ<code>task-component</code>å±æ€§å€¼å…è®¸ä¸ºç©ºã€‚å¦‚æ­¤é…ç½®ä¾¿å¯ä»¥å°†æµç¨‹é…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡èŠ‚ç‚¹ä¸ä»£ç ä¸­çš„æ–¹æ³•è¿›è¡Œå…³è”ã€‚æµç¨‹æ‰§è¡Œæ—¶æ¯æ‰§è¡Œåˆ°æŸä¸ªèŠ‚ç‚¹æ—¶å®é™…åœ¨ä»£ç ä¸­ä¼šè°ƒç”¨ä¸ä¹‹ç›¸å¯¹åº”çš„æ–¹æ³•ã€‚</p> <p><a data-fancybox="" title="åŒ…å«ç½‘å…³å¼€å¯å¹¶å‘" href="../img2/ec376c940db47622997d830abcdd57ad.png"><img src="/assets/img/ec376c940db47622997d830abcdd57ad.9ec76de9.png" alt="image-WX20230926"></a></p> <p>Â Â Â Â å½“éœ€è¦åŒæ—¶æ‰§è¡Œå¤šä¸ªè€—æ—¶æ“ä½œå¹¶ä¸”æ“ä½œä¹‹é—´æ²¡æœ‰å‰åä¾èµ–å…³ç³»æ—¶ï¼Œå¯é‡‡ç”¨å¹¶å‘æ‰§è¡Œçš„æ‰‹æ®µæ¥åŠ å¿«æ‹¿åˆ°å“åº”ç»“æœçš„æ—¶é—´ã€‚æ¡†æ¶æ”¯æŒåœ¨åŒ…å«ç½‘å…³ã€å¹¶è¡Œç½‘å…³ä¸¤ä¸ªç½‘å…³ä¸Šå¢åŠ <code>open-async=true</code>é…ç½®çš„æ–¹å¼å¼€å¯åé¢å¤šæµç¨‹æ‰§è¡Œçš„å¹¶å‘ã€‚å¯è§ä»ä¸²è¡Œå˜ä¸ºå¹¶è¡Œçš„å‡çº§æˆæœ¬æ˜¯æä½çš„ã€‚</p> <p><a data-fancybox="" title="æµç¨‹ä¸­ä½¿ç”¨è¡¨è¾¾å¼" href="../img2/f76112d617fe69bb052db0df7120a471.png"><img src="/assets/img/f76112d617fe69bb052db0df7120a471.79ba0687.png" alt="image-WX20230926"></a></p> <p>Â Â Â Â ä¸Šè¿°æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯çš„ä¾‹å­ä¸­ä»…éœ€å­¦ç”Ÿæˆç»©ä¿¡æ¯æ—¶æ‰éœ€è¦ä¸‹åŠéƒ¨åˆ†çš„æŸ¥è¯¢åŠ¨ä½œã€‚æ¡†æ¶æ”¯æŒåœ¨æµç¨‹çº¿æ®µä¸Šå®šä¹‰æ¡ä»¶è¡¨è¾¾å¼æ¥åˆ¤æ–­å’Œæ§åˆ¶åç»­çš„æµç¨‹æ˜¯å¦éœ€è¦æ‰§è¡Œã€‚è¡¨è¾¾å¼é€šè¿‡SpringSpELå¼•æ“è§£ææ‰§è¡Œã€‚ä¸ä»…æ”¯æŒç±»ä¼¼<code>var.student.age&gt;20</code>è¿™ç§æ™®é€šè¡¨è¾¾å¼åˆ¤æ–­ï¼Œè¿˜æ”¯æŒ<code>@notBlank(var.student.name)</code>è¿™ç§å¸¸ç”¨å‡½æ•°ï¼Œç”šè‡³åœ¨ç»™å®šå‡½æ•°ä¸æ»¡è¶³ä¸šåŠ¡è¯‰æ±‚æ˜¯è¿˜æ”¯æŒè‡ªå®šä¹‰å‡½æ•°æ¥ä¸°å¯Œæ¡ä»¶è¡¨è¾¾å¼çš„åˆ¤æ–­ï¼Œéœ€è¦äº†è§£è‡ªå®šä¹‰å‡½æ•°ç»†èŠ‚å¯è·³è½¬è‡³ä¸‹é¢æµç¨‹ç¼–æ’éƒ¨åˆ†ã€‚</p> <p><a data-fancybox="" title="æµç¨‹ä¸­ä½¿ç”¨æŒ‡ä»¤" href="../img2/d9e72d44e893680e22eae5c1e2475f48.png"><img src="/assets/img/d9e72d44e893680e22eae5c1e2475f48.512b0c92.png" alt="image-WX20230926"></a></p> <p>Â Â Â Â ä¸Šè¿°æµç¨‹ä¸­æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œ<em>è·å–å­¦ç”Ÿå­¦å¹´åˆ—è¡¨</em> æœåŠ¡èŠ‚ç‚¹æ–¹æ³•è¿”å›é€šçŸ¥åˆ°varæ•°æ®åŸŸçš„æ˜¯ä¸€ä¸ª<code>List&lt;StudyExperience&gt; studyExperienceList</code>å˜é‡å€¼ã€‚è€Œåœ¨åç»­ <em>æŸ¥è¯¢ç­çº§ä¿¡æ¯</em> æœåŠ¡èŠ‚ç‚¹æ–¹æ³•ä¸­éå†çš„æ˜¯<code>var.classIds</code>ã€‚é‚£ä¹ˆ<code>var.classIds</code>è¿™ä¸ªå€¼æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†æ¡†æ¶æä¾›çš„æŒ‡ä»¤èƒ½åŠ›ã€‚<br>
Â Â Â Â å†…éƒ¨å®ç°ä¸­æŒ‡ä»¤å…¶å®å°±æ˜¯æœåŠ¡èŠ‚ç‚¹ï¼Œä¹‹æ‰€ä»¥ä»¥æŒ‡ä»¤çš„å½¢å¼å­˜åœ¨æ˜¯ä¸ºäº†æ–¹ä¾¿æ¡†æ¶ç”¨æˆ·æŠ½è±¡ä¸€äº›å…¬ç”¨æ–¹æ³•ï¼Œåœ¨æ ¸å¿ƒæœåŠ¡æ–¹æ³•æ‰§è¡Œå‰ååšä¸€äº›æ‰€éœ€çš„æ•°æ®å¤„ç†ã€‚æ¯”å¦‚ä¸Šè¿°ä¾‹å­ä¸­<code>studyExperienceList</code>åˆ°<code>classIds</code>çš„è½¬åŒ–å°±ç”¨åˆ°äº†æ¡†æ¶è‡ªå¸¦çš„<code>c-jscript</code>æŒ‡ä»¤ã€‚è¯¥æŒ‡ä»¤çš„åŠŸèƒ½æ˜¯é€šè¿‡è§£ææ‰§è¡Œæµç¨‹å®šä¹‰ä¸­çš„jsè„šæœ¬æ¥æ“ä½œå„åŸŸä¸­çš„æ•°æ®ã€‚ä¸‹é¢æ˜¯å…·ä½“çš„ä½¿ç”¨æ–¹å¼ï¼š</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// task-propertyå±æ€§è®¾ç½®</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;result-converter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;object_to_long_list&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;return-target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;var.classIds&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// c-jscriptæŒ‡ä»¤Content</span>
<span class="token keyword">var</span> classIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> kvar<span class="token punctuation">.</span>studyExperienceList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    classIds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>kvar<span class="token punctuation">.</span>studyExperienceList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>classId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>classIds<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Â Â Â Â åœ¨ <em>è·å–å­¦ç”Ÿå­¦å¹´åˆ—è¡¨</em> æœåŠ¡èŠ‚ç‚¹æ‰§è¡Œå®Œæˆä¹‹åï¼Œå› ä¸ºé…ç½®äº†<code>c-jscript</code>åç½®æŒ‡ä»¤æ‰€ä»¥ä¼šè¿›å…¥åˆ°æŒ‡ä»¤ä¸­æ‰§è¡Œã€‚æŒ‡ä»¤è„šæœ¬ä¼šä»<code>studyExperienceList</code>ä¸­ä¾æ¬¡å–å‡º<code>classId</code>æ”¾åˆ°æ–°å®šä¹‰çš„<code>classIds</code>ä¸­å¹¶åºåˆ—åŒ–æˆStringè¿”å›ã€‚åˆå› ä¸º<code>task-property</code>ä¸­æŒ‡å®šäº†<code>object_to_long_list</code>ç±»å‹è½¬æ¢å™¨ï¼Œå°†Stringç±»å‹è½¬æ¢æˆä¸º<code>List&lt;Long&gt;</code>ç±»å‹ï¼Œæœ€ç»ˆå°†è½¬æ¢åçš„ç»“æœé€šçŸ¥åˆ°varåŸŸçš„<code>classIds</code>å˜é‡ä¸­ã€‚è¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»ä¸‹å„ä¸ªåŠŸèƒ½ç‚¹çš„ä½¿ç”¨åœºæ™¯ï¼Œå¯¹äº<code>task-property</code>å±æ€§ä½œç”¨ã€æŒ‡ä»¤ã€ç±»å‹è½¬æ¢å™¨ç­‰å¯åœ¨åç»­æ–‡æ¡£ä¸­çœ‹åˆ°è¯¦ç»†ä»‹ç»ã€‚</p> <h3 id="_1-6-2-jsonæ ¼å¼å®šä¹‰æµç¨‹"><a href="#_1-6-2-jsonæ ¼å¼å®šä¹‰æµç¨‹" class="header-anchor">#</a> 1.6.2 JSONæ ¼å¼å®šä¹‰æµç¨‹</h3> <p>Â Â Â Â JSONæ ¼å¼æ˜¯ä¸€ç§æç®€çš„æµç¨‹å®šä¹‰æ–¹å¼ã€‚ä¸BPMNæ ¼å¼ç›¸æ¯”ä¼˜åŠ¿åœ¨äºå°æ–‡ä»¶æ—¶ç®€å•æ˜“æ‡‚ã€å®¹æ˜“è½¬æ¢ç”Ÿæˆã€å ç”¨ç©ºé—´å°æ˜“äºä¼ è¾“ç­‰ã€‚è€Œç•¥åŠ¿ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæœ€é‡è¦çš„ä¾¿æ˜¯å½»åº•å¤±å»äº†å¯è§†åŒ–çš„èƒ½åŠ›ï¼Œæµç¨‹èŠ‚ç‚¹å¤šäº†ä¹‹åé˜…è¯»èµ·æ¥å°†ä¼šéå¸¸å›°éš¾ã€‚é‚£ä¹ˆæ¡†æ¶æ”¯æŒJSONæ ¼å¼æµç¨‹å®šä¹‰çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p> <p>Â Â Â Â æ”¯æŒJSONæ ¼å¼æµç¨‹å®šä¹‰çš„æœ€é‡è¦çš„åŸå› å°±æ˜¯å…¶å®¹æ˜“è½¬æ¢ç”Ÿæˆçš„ç‰¹ç‚¹ã€‚å¯è§†åŒ–æµç¨‹é…ç½®å·¥å…·å±‚å‡ºä¸ç©·ï¼Œå„ç§å¼€æºä¹Ÿæ˜¯äº‰å¥‡æ–—è‰³ã€‚BPMNæ ¼å¼ä»…ä»…æ˜¯è¿™ä¼—å¤šå·¥å…·ä¸­çš„ä¸€ç§ï¼Œå› ä¸ºå†å²é—ç•™ã€å…¬å¸è¦æ±‚ã€æ¥å…¥æˆæœ¬ç­‰ä¼—å¤šå› ç´ å½±å“ï¼Œä¸å¯èƒ½è¦æ±‚æ‰€æœ‰ä½¿ç”¨è€…éƒ½å°†BPMNä½œä¸ºæµç¨‹é…ç½®çš„é¦–é€‰ã€‚ä¸ºäº†æ»¡è¶³æ›´å¤šç”¨æˆ·çš„ä¸åŒè¯‰æ±‚ï¼Œå°±éœ€è¦ä¸€ç§ä¸­é—´åè®®ã€‚å¯ä»¥å°†å„ç§æµç¨‹é…ç½®æ–‡ä»¶è½¬æ¢æˆè¿™ç§ä¸­é—´åè®®ï¼Œä»¥ä¾›æ¡†æ¶æ¥ç†è§£å’Œæ‰§è¡Œï¼Œæ— ç–‘JSONæ ¼å¼æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚æœ‰äº†è¿™å±‚åè®®æ— è®ºä½¿ç”¨è€…ä½¿ç”¨äº†ä½•ç§å¯è§†åŒ–æµç¨‹é…ç½®å·¥å…·ï¼Œéƒ½å¯ä»¥å€Ÿæ­¤è¢«Kstryæ¡†æ¶æ‰€ç†è§£å’Œæ‰§è¡Œã€‚</p> <p>Â Â Â Â ä¸‹é¢æ˜¯å¯¹ä¸Šè¿° <em>å­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢æµç¨‹</em> çš„JSONæ ¼å¼å®šä¹‰æè¿°ï¼š</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token property">&quot;process-id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Process_1693841776073&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start-id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;student-score-query-json-process&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;process-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;student-score-query-json-process&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;student-score-query-json-process&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Gateway_0moclik&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;start_event&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Gateway_0moclik&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Activity_1tuuink&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Activity_1lzcrrr&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Flow_1jmfkgr&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;open-async&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// å¼€å¯å¹¶å‘</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;inclusive_gateway&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Activity_1tuuink&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;æŸ¥è¯¢å­¦ç”Ÿ\nåŸºæœ¬ä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Gateway_0avnapl&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;task-component&quot;</span><span class="token operator">:</span> <span class="token string">&quot;studentScoreService&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;task-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getStudentBasic&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_task&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Activity_1lzcrrr&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;æŸ¥è¯¢å­¦ç”Ÿ\næ•æ„Ÿä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Gateway_0avnapl&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;task-component&quot;</span><span class="token operator">:</span> <span class="token string">&quot;studentScoreService&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;task-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getStudentPrivacy&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_task&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Gateway_0avnapl&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Activity_1x55mgq&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;inclusive_gateway&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Activity_1x55mgq&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;è£…é…å­¦ç”Ÿä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Gateway_02qlo7f&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;task-component&quot;</span><span class="token operator">:</span> <span class="token string">&quot;studentScoreService&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;task-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;assembleStudentInfo&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_task&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;flow-expression&quot;</span><span class="token operator">:</span> <span class="token string">&quot;req.needScore&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æµç¨‹çº¿æ®µä¸Šå®šä¹‰æ¡ä»¶è¡¨è¾¾å¼</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Flow_1jmfkgr&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ifï¼ˆneed-score-listï¼‰&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Activity_0q5ad88&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sequence_flow&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Activity_0q5ad88&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;è·å–å­¦ç”Ÿ\nå­¦å¹´åˆ—è¡¨&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Gateway_0qmo5am&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;task-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getStudyExperienceList&quot;</span><span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨æŒ‡ä»¤</span>
      <span class="token property">&quot;c-jscript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;var classIds = [];\nfor (var i = 0; i&lt; kvar.studyExperienceList.length; i++)\n{\n    classIds.push(kvar.studyExperienceList[i].classId);\n}\nreturn JSON.stringify(classIds)&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;task-property&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\n    \&quot;result-converter\&quot;: \&quot;object_to_long_list\&quot;,\n    \&quot;return-target\&quot;: \&quot;var.classIds\&quot;\n}&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_task&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Gateway_0qmo5am&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Activity_1h1otxv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Activity_1v1y60m&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;open-async&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// å¼€å¯å¹¶å‘</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;inclusive_gateway&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Activity_1h1otxv&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;æŸ¥è¯¢ç­çº§ä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Gateway_0t2t6ox&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;task-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getClasInfoById&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_task&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Activity_1v1y60m&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;æŸ¥è¯¢å­¦ç”Ÿ\nåˆ†æ•°åˆ—è¡¨&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Gateway_0t2t6ox&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;task-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getStudentScoreList&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_task&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Gateway_0t2t6ox&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Activity_0itm6m7&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;strict-mode&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// æŒ‡å®šå¹¶è¡Œç½‘å…³ä¸ºéä¸¥æ ¼æ¨¡å¼</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;parallel_gateway&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Activity_0itm6m7&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ç»„è£…å†å¹´æˆç»©åˆ—è¡¨&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Gateway_02qlo7f&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;task-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;assembleScoreClassInfo&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_task&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Gateway_02qlo7f&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Activity_0n1ystm&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;inclusive_gateway&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Activity_0n1ystm&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;å„ç»´åº¦ä¿¡æ¯èšåˆ&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;2e5a5716e4404ca6843abffb807e23b3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;task-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getQueryScoreResponse&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_task&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2e5a5716e4404ca6843abffb807e23b3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next-nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;end_event&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br></div></div><h3 id="_1-6-3-ä»£ç æ–¹å¼å®šä¹‰æµç¨‹"><a href="#_1-6-3-ä»£ç æ–¹å¼å®šä¹‰æµç¨‹" class="header-anchor">#</a> 1.6.3 ä»£ç æ–¹å¼å®šä¹‰æµç¨‹</h3> <p>Â Â Â Â æ— è®ºæ˜¯BPMNæ ¼å¼è¿˜æ˜¯JSONæ ¼å¼ï¼Œåœ¨ä»£ç å¼€å‘å·¥å…·æ¯”å¦‚eclipseã€IDEAä¸­å¦‚æœæ²¡æœ‰å¾ˆå¥½çš„æ’ä»¶æ”¯æŒï¼Œé…ç½®æ–‡ä»¶ä¸ä»£ç ä¾¿æ˜¯å‰²è£‚çš„ã€‚ä½¿ç”¨ä¸¤ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶æ—¶ï¼Œåœ¨å¼€å‘å·¥å…·ä¸­å„ä¸ªæœåŠ¡èŠ‚ç‚¹æ–¹æ³•ä¹‹é—´å°†ä¸å­˜åœ¨ä»»ä½•å…³è”å’Œå¼•ç”¨ã€‚è¿™æ ·ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ä»…ä»…åªçœ‹ä»£ç æ˜¯ä¸çŸ¥é“ä¸šåŠ¡å¦‚ä½•å®ç°çš„ã€å¼€å‘è¿‡ç¨‹ä¸­ä¸èƒ½åƒä¼ ç»Ÿæ–¹æ³•ä¸€æ ·é€šè¿‡å¿«æ·é”®åœ¨ç›¸äº’å¼•ç”¨çš„æ–¹æ³•ä¹‹é—´å¿«é€Ÿè·³è½¬ç­‰ï¼Œç”±æ­¤æ¡†æ¶è¿˜æ”¯æŒäº†ä»£ç æ–¹å¼å®šä¹‰æµç¨‹ã€‚</p> <p>Â Â Â Â å¯ä»¥è‡ªå®šä¹‰æ–¹æ³•è¿”å›<code>ProcessLink</code>æˆ–è€…<code>SubProcessLink</code>æ¥å®šä¹‰æµç¨‹å’Œå­æµç¨‹ã€‚æ–¹æ³•ä¸Šæ ‡æ³¨@Beanæ³¨è§£å°†æµç¨‹å¯¹è±¡æ”¾å…¥Springå®¹å™¨ä¸­å³å¯åœ¨æ‰§è¡Œæ—¶ç”Ÿæ•ˆã€‚å½“æµç¨‹å¤æ‚ä¸æ˜“é˜…è¯»æ—¶è¿˜å¯ä»¥é€šè¿‡æŠ½ç¦»å­æµç¨‹çš„æ–¹å¼å°†æ•´ä¸ªå¤§æµç¨‹åˆ†å±‚æˆä¸åŒçš„å­æµç¨‹æ¥å¸®åŠ©è§„åˆ’å’Œç†è§£ã€‚</p> <p>Â Â Â Â æœåŠ¡èŠ‚ç‚¹æ–¹æ³•å¯ä»¥ä½œä¸ºlambdaè¡¨è¾¾å¼çš„å½¢å¼å‚ä¸è¿›æ•´ä¸ªæµç¨‹çš„ç»„è£…ï¼Œè§£å†³äº†å„ä¸ªæœåŠ¡èŠ‚ç‚¹æ–¹æ³•ä¹‹é—´ä¸å­˜åœ¨ä»»ä½•å…³è”å’Œå¼•ç”¨çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨å¼€å‘å·¥å…·ä¸­ä½¿ç”¨å¿«æ·é”®å¿«é€Ÿè·³è½¬ã€‚ç†Ÿæ‚‰ä»£ç æ–¹å¼çš„æµç¨‹å®šä¹‰åï¼Œé˜…è¯»æ•´ä¸ªæµç¨‹æ—¶è™½ç„¶æ¯”ä¸ä¸ŠBPMNå¯è§†åŒ–é‚£æ ·ç®€æ´æ˜äº†ï¼Œä½†ç†è§£èµ·æ¥ä¹Ÿä¸€å®šæ¯”æ²¡æœ‰ä»»ä½•æ¨¡å—åˆ’åˆ†ä¸€æ°”å‘µæˆçš„ä»£ç æ–¹ä¾¿ä¸å°‘ã€‚</p> <p>Â Â Â Â å¦å¤–æ— è®ºæ˜¯BPMNæ ¼å¼æ–‡ä»¶è¿˜æ˜¯JSONæ ¼å¼æ–‡ä»¶ï¼Œæœ€ç»ˆéƒ½æ˜¯ç”¨ä»£ç æµç¨‹å®šä¹‰çš„æ–¹å¼æ¥è§£æç”Ÿæ•ˆçš„ã€‚æ‰€ä»¥ä½¿ç”¨å…¶ä»–åè®®çš„æµç¨‹é…ç½®å·¥å…·æ—¶ä¹Ÿå¯ä»¥è·³è¿‡JSONæ ¼å¼çš„è½¬åŒ–ï¼Œç›´æ¥ç”¨ä»£ç æ–¹å¼è§£æç”Ÿæˆæµç¨‹ã€‚</p> <p>Â Â Â Â ä¸‹é¢æ˜¯å¯¹ä¸Šè¿° <em>å­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢æµç¨‹</em> çš„ä»£ç æ–¹å¼å®šä¹‰æè¿°ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">studentScoreQueryProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> instructContent <span class="token operator">=</span> <span class="token string">&quot;var classIds = [];&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;for (var i = 0; i&lt; kvar.studyExperienceList.length; i++)&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;{&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;    classIds.push(kvar.studyExperienceList[i].classId);&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;return JSON.stringify(classIds)&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">DefProcess</span><span class="token operator">::</span><span class="token function">studentScoreQueryProcess</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">InclusiveJoinPoint</span> asyncInclusive <span class="token operator">=</span> processLink<span class="token punctuation">.</span><span class="token function">nextInclusive</span><span class="token punctuation">(</span>processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">InclusiveJoinPoint</span> asyncInclusive2 <span class="token operator">=</span> asyncInclusive
            <span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>REQUEST<span class="token punctuation">,</span> <span class="token class-name">QueryScoreRequest<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>needScore<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getStudyExperienceList</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">nextInstruct</span><span class="token punctuation">(</span><span class="token string">&quot;jscript&quot;</span><span class="token punctuation">,</span> instructContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;JSè„šæœ¬&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;result-converter\&quot;: \&quot;object_to_long_list\&quot;,\&quot;return-target\&quot;: \&quot;var.classIds\&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">nextInclusive</span><span class="token punctuation">(</span>processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
                    processLink<span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notStrictMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
                            asyncInclusive2<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getClasInfoById</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            asyncInclusive2<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getStudentScoreList</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">assembleScoreClassInfo</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
                            asyncInclusive<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getStudentBasic</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            asyncInclusive<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getStudentPrivacy</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">assembleStudentInfo</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getQueryScoreResponse</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_1-7-è°ƒç”¨æ‰§è¡Œ"><a href="#_1-7-è°ƒç”¨æ‰§è¡Œ" class="header-anchor">#</a> 1.7 è°ƒç”¨æ‰§è¡Œ</h2> <p>Â Â Â Â æ¡†æ¶çš„æ‰§è¡Œä¾æ‰˜äºStoryEngineå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šéšç€æ¡†æ¶åˆå§‹åŒ–è¿›ç¨‹è¢«æ‰˜ç®¡è‡³Springå®¹å™¨ä¸­ã€‚æ‰€ä»¥ä½¿ç”¨èµ·æ¥ä¼šå¾ˆæ–¹ä¾¿ï¼Œåªéœ€æŒ‰ç…§æ™®é€šSpring Beançš„æ–¹å¼æ³¨å…¥å³å¯ã€‚StoryEngineå¯¹è±¡æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œ<code>fire</code>ã€<code>fireAsync</code>ã€<code>serialize</code>æ‰€å®ç°åŠŸèƒ½åˆ†åˆ«æ˜¯åŒæ­¥æ‰§è¡Œæµç¨‹ã€å¼‚æ­¥æ‰§è¡Œæµç¨‹ã€å°†å®¹å™¨ä¸­çš„æµç¨‹åºåˆ—åŒ–æˆJSONã€‚</p> <h3 id="_1-7-1-åŒæ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ"><a href="#_1-7-1-åŒæ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ" class="header-anchor">#</a> 1.7.1 åŒæ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/student&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StoryEngine</span> storyEngine<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/query&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">QueryScoreResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">studentQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">QueryScoreRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryScoreRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setStudentId</span><span class="token punctuation">(</span><span class="token number">77L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setNeedScore</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">QueryScoreResponse</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span>
                <span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreResponse</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šè¿”å›ç±»å‹</span>
                <span class="token punctuation">.</span><span class="token function">recallStoryHook</span><span class="token punctuation">(</span><span class="token class-name">WebUtil</span><span class="token operator">::</span><span class="token function">recallStoryHook</span><span class="token punctuation">)</span> <span class="token comment">// æµç¨‹ç»“æŸçš„å›æº¯</span>
                <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šç›‘æ§ç±»å‹</span>
                <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šreqåŸŸå‚æ•°</span>
                <span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryScoreVarScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®švaråŸŸæ•°æ®è½½ä½“ï¼Œå¯ä¸æŒ‡å®šä½¿ç”¨é»˜è®¤å€¼</span>
                <span class="token punctuation">.</span><span class="token function">startId</span><span class="token punctuation">(</span><span class="token string">&quot;student-score-query-process&quot;</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šå¼€å§‹äº‹ä»¶ID</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">QueryScoreResponse</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getResultDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> success<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">D</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">D</span><span class="token punctuation">&gt;</span></span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">D</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">D</span><span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">D</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">D</span><span class="token punctuation">&gt;</span></span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">D</span><span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">recallStoryHook</span><span class="token punctuation">(</span><span class="token class-name">RecallStory</span> recallStory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MonitorTracking</span> monitorTracking <span class="token operator">=</span> recallStory<span class="token punctuation">.</span><span class="token function">getMonitorTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NodeTracking</span><span class="token punctuation">&gt;</span></span> storyTracking <span class="token operator">=</span> monitorTracking<span class="token punctuation">.</span><span class="token function">getStoryTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> storyTracking<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>nt <span class="token operator">-&gt;</span> <span class="token class-name">GlobalUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;{}({}ms)&quot;</span><span class="token punctuation">,</span> nt<span class="token punctuation">.</span><span class="token function">getNodeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nt<span class="token punctuation">.</span><span class="token function">getSpendTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Story startId: {}, service node spend list: {}&quot;</span><span class="token punctuation">,</span> recallStory<span class="token punctuation">.</span><span class="token function">getStartId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> collect<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><p>Â Â Â Â StoryRequestæ˜¯æ‰§è¡Œæµç¨‹çš„å…¥å‚ï¼ŒåŒ…å«äº†å…¨éƒ¨æ‰€éœ€çš„å‚æ•°ã€‚æ ·ä¾‹ä¸­<code>recallStoryHook</code>çš„ä½œç”¨æ˜¯åœ¨æµç¨‹æ‰§è¡Œå®Œä¹‹åæ— è®ºæˆåŠŸæˆ–æ˜¯å¤±è´¥éƒ½ä¼šè¿›è¡Œä¸€æ¬¡å›è°ƒï¼Œå›è°ƒå‡½æ•°ä½¿ç”¨RecallStoryä½œä¸ºå…¥å‚ï¼Œå¯è·å–ï¼šå„ä¸ªä½œç”¨åŸŸå˜é‡ã€è§’è‰²ã€æœ€ç»ˆè¿”å›ç»“æœã€é“¾è·¯è¿½è¸ªå™¨ç­‰ã€‚åœ¨ä¸Šè¿°æ ·ä¾‹ä¸­æŒ‡å®šäº†<code>WebUtil::recallStoryHook</code>ä½œç”¨æ˜¯æ‰“å°å„ä¸ªæœåŠ¡èŠ‚ç‚¹çš„æ‰§è¡Œè€—æ—¶ã€‚æ¯”å¦‚ï¼š</p> <div class="language-log line-numbers-mode"><pre class="language-log"><code><span class="token property">Story startId:</span> student<span class="token operator">-</span>score<span class="token operator">-</span>query<span class="token operator">-</span>process<span class="token punctuation">,</span> service node spend list<span class="token operator">:</span> æŸ¥è¯¢å­¦ç”Ÿæ•æ„Ÿä¿¡æ¯<span class="token operator">(</span><span class="token number">0ms</span><span class="token operator">)</span><span class="token punctuation">,</span>æŸ¥è¯¢å­¦ç”ŸåŸºæœ¬ä¿¡æ¯<span class="token operator">(</span><span class="token number">0ms</span><span class="token operator">)</span><span class="token punctuation">,</span>è·å–å­¦ç”Ÿå­¦å¹´åˆ—è¡¨<span class="token operator">(</span><span class="token number">0ms</span><span class="token operator">)</span><span class="token punctuation">,</span>JSè„šæœ¬<span class="token operator">(</span><span class="token number">12ms</span><span class="token operator">)</span><span class="token punctuation">,</span>è£…é…å­¦ç”Ÿä¿¡æ¯<span class="token operator">(</span><span class="token number">0ms</span><span class="token operator">)</span><span class="token punctuation">,</span>æŸ¥è¯¢å­¦ç”Ÿåˆ†æ•°åˆ—è¡¨<span class="token operator">(</span><span class="token number">0ms</span><span class="token operator">)</span><span class="token punctuation">,</span>æŸ¥è¯¢ç­çº§ä¿¡æ¯<span class="token operator">(</span><span class="token number">0ms</span><span class="token operator">)</span><span class="token punctuation">,</span>ç»„è£…å†å¹´æˆç»©åˆ—è¡¨<span class="token operator">(</span><span class="token number">0ms</span><span class="token operator">)</span><span class="token punctuation">,</span>å„ç»´åº¦ä¿¡æ¯èšåˆ<span class="token operator">(</span><span class="token number">0ms</span><span class="token operator">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Â Â Â Â å¦ä¸€ä¸ªéœ€è¦ç®€å•ä»‹ç»ä¸‹çš„æ˜¯<code>trackingType</code>ç”¨æ¥æŒ‡å®šé“¾è·¯è¿½è¸ªçº§åˆ«ã€‚<code>SERVICE_DETAIL</code>çš„å«ä¹‰æ˜¯æ‰“å°å„ä¸ªæœåŠ¡èŠ‚ç‚¹æ‰§è¡Œæ—¶çš„ç»†èŠ‚è¯¦æƒ…ã€‚æ¯”å¦‚ä¸‹é¢æ˜¯ <em>è£…é…å­¦ç”Ÿä¿¡æ¯</em> æœåŠ¡èŠ‚ç‚¹çš„æ‰§è¡Œä¿¡æ¯</p> <div class="language-log line-numbers-mode"><pre class="language-log"><code><span class="token operator">{</span>
  <span class="token string">&quot;endTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-09-30T17:42:53.752762000&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;index&quot;</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
  <span class="token string">&quot;methodName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;assembleStudentInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;nodeId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Activity_1x55mgq-12&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;nodeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;è£…é…å­¦ç”Ÿä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;nodeType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SERVICE_TASK&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;noticeTracking&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">{</span>    <span class="token operator">/</span><span class="token operator">/</span> é€šçŸ¥åˆ°varåŸŸçš„æ•°æ®ä¿¡æ¯
    <span class="token string">&quot;converter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BASIC_CONVERTER&quot;</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> ä½¿ç”¨åˆ°çš„ç±»å‹è½¬æ¢å™¨åç§°
    <span class="token string">&quot;scopeType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VARIABLE&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sourceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;student&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;targetName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;student&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;targetType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cn.kstry.flux.demo.facade.student.QueryScoreVarScope&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;address\&quot;:\&quot;XXçœXXå¸‚XXåŒº\&quot;,\&quot;birthday\&quot;:\&quot;1994-01-01\&quot;,\&quot;id\&quot;:77,\&quot;idCard\&quot;:\&quot;133133199401012345\&quot;,\&quot;name\&quot;:\&quot;å¼ ä¸€\&quot;}&quot;</span>
  <span class="token operator">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;paramTracking&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">{</span>   <span class="token operator">/</span><span class="token operator">/</span> æœåŠ¡èŠ‚ç‚¹æ–¹æ³•æ‰§è¡Œå…¥å‚ä¿¡æ¯
    <span class="token string">&quot;scopeType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VARIABLE&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sourceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;studentBasic&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;targetName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;studentBasic&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;targetType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cn.kstry.flux.demo.dto.student.StudentBasic&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;address\&quot;:\&quot;XXçœXXå¸‚XXåŒº\&quot;,\&quot;id\&quot;:77,\&quot;name\&quot;:\&quot;å¼ ä¸€\&quot;}&quot;</span>
  <span class="token operator">}</span><span class="token punctuation">,</span> <span class="token operator">{</span>
    <span class="token string">&quot;scopeType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VARIABLE&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sourceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;studentPrivacy&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;targetName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;studentPrivacy&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;targetType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cn.kstry.flux.demo.dto.student.StudentPrivacy&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;birthday\&quot;:\&quot;1994-01-01\&quot;,\&quot;id\&quot;:77,\&quot;idCard\&quot;:\&quot;133133199401012345\&quot;}&quot;</span>
  <span class="token operator">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;spendTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">&quot;startTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-09-30T17:42:53.752442000&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;targetName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cn.kstry.flux.demo.service.student.StudentScoreService&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;threadId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kstry-task-thread-pool-1&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;toNodeIds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Activity_0n1ystm-32&quot;</span><span class="token punctuation">]</span>
<span class="token operator">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_1-7-2-å¼‚æ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ"><a href="#_1-7-2-å¼‚æ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ" class="header-anchor">#</a> 1.7.2 å¼‚æ­¥æ–¹å¼è°ƒç”¨æ‰§è¡Œ</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/student&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/scoreQuery&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&lt;</span><span class="token class-name">QueryScoreResponse</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">scoreQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">QueryScoreRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryScoreRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setStudentId</span><span class="token punctuation">(</span><span class="token number">66L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setNeedScore</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">QueryScoreResponse</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span>
                <span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">QueryScoreResponse</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šè¿”å›ç±»å‹</span>
                <span class="token punctuation">.</span><span class="token function">recallStoryHook</span><span class="token punctuation">(</span><span class="token class-name">WebUtil</span><span class="token operator">::</span><span class="token function">recallStoryHook</span><span class="token punctuation">)</span> <span class="token comment">// æµç¨‹ç»“æŸçš„å›æº¯</span>
                <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šç›‘æ§ç±»å‹</span>
                <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šreqåŸŸå‚æ•°</span>
                <span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryScoreVarScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®švaråŸŸæ•°æ®è½½ä½“ï¼Œå¯ä¸æŒ‡å®šä½¿ç”¨é»˜è®¤å€¼</span>
                <span class="token punctuation">.</span><span class="token function">startId</span><span class="token punctuation">(</span><span class="token string">&quot;student-score-query-process&quot;</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šå¼€å§‹äº‹ä»¶ID</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">QueryScoreResponse</span><span class="token punctuation">&gt;</span></span> fireAsync <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fireAsync</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">WebUtil</span><span class="token punctuation">.</span><span class="token function">dataDecorate</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> fireAsync<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">resultDecorate</span><span class="token punctuation">(</span><span class="token class-name">Object</span> req<span class="token punctuation">,</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> defErrorCode <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">doOnSuccess</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;req: {}, result success: {}&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onErrorResume</span><span class="token punctuation">(</span>err <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">BusinessException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;req: {}, task-service: {}, result error: &quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">,</span> <span class="token class-name">GlobalUtil</span><span class="token punctuation">.</span><span class="token function">transferNotEmpty</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token class-name">BusinessException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTaskIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;req: {}, result error: &quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">tryGetCode</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> defErrorCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span>defErrorCode<span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">dataDecorate</span><span class="token punctuation">(</span><span class="token class-name">Object</span> req<span class="token punctuation">,</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">resultDecorate</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token keyword">instanceof</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>Â Â Â Â å¼‚æ­¥æµç¨‹æ‰§è¡Œä¸­ï¼Œ<code>fireAsync</code>è¿”å›å€¼æ˜¯<code>Mono</code>ç±»å‹ã€‚Fluxå’ŒMonoéƒ½æ˜¯Java Reactorå“åº”å¼ä¸­çš„é‡è¦æ¦‚å¿µï¼Œç›®å‰Kstryä»…é‡‡ç”¨äº†Monoä½œä¸ºå¼‚æ­¥æµç¨‹è°ƒç”¨åçš„è¿”å›ç»“æœã€‚åœ¨è¯¦ç»†äº†è§£Monoä¹‹å‰ï¼Œå¯ä»¥ç®€å•çš„å°†å…¶ç†è§£ä¸ºåŠŸèƒ½æ›´åŠ å¼ºå¤§çš„CompletableFutureã€‚ä½¿ç”¨Monoå¯ä»¥æ³¨å†Œæµç¨‹ç»“æŸä¹‹åè¢«æ‰§è¡Œçš„æ­£å¸¸æˆ–å¼‚å¸¸çš„å›è°ƒæ“ä½œã€‚è€Œæ›´å¤šçš„åˆ™æ˜¯åƒä¸Šé¢ä¾‹å­ä¸­ä¸€æ ·å’Œç±»ä¼¼SpringFluxè¿™ç§å“åº”å¼æ¡†æ¶åšæ— ç¼è¡”æ¥ï¼Œæ¥å¯¹å¤–æä¾›WEBæœåŠ¡ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/doc/specification/process_choreography.html">
        äºŒã€æµç¨‹ç¼–æ’
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fc8f11ce.js" defer></script><script src="/assets/js/2.6d18f2ff.js" defer></script><script src="/assets/js/5.a021e58e.js" defer></script>
  </body>
</html>
