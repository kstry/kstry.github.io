<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kstryä¸šåŠ¡æ¶æ„é¦–é€‰æ¡†æ¶</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="Kstryä½¿ç”¨æ–‡æ¡£">
    
    <link rel="preload" href="/assets/css/0.styles.9634fd34.css" as="style"><link rel="preload" href="/assets/js/app.fc8f11ce.js" as="script"><link rel="preload" href="/assets/js/2.6d18f2ff.js" as="script"><link rel="preload" href="/assets/js/3.84f41dcf.js" as="script"><link rel="prefetch" href="/assets/js/10.976139c2.js"><link rel="prefetch" href="/assets/js/11.cee08e74.js"><link rel="prefetch" href="/assets/js/12.b8c547b5.js"><link rel="prefetch" href="/assets/js/13.63a0d034.js"><link rel="prefetch" href="/assets/js/14.8cab9faf.js"><link rel="prefetch" href="/assets/js/15.349558f5.js"><link rel="prefetch" href="/assets/js/16.0d2fbd26.js"><link rel="prefetch" href="/assets/js/17.af43253d.js"><link rel="prefetch" href="/assets/js/4.32e6db9d.js"><link rel="prefetch" href="/assets/js/5.a021e58e.js"><link rel="prefetch" href="/assets/js/6.8b7c2b97.js"><link rel="prefetch" href="/assets/js/7.c487ae2f.js"><link rel="prefetch" href="/assets/js/8.81adceba.js"><link rel="prefetch" href="/assets/js/9.c1a65384.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9634fd34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="http://cdn.kstry.cn/doc/img/title-field.png" alt="Kstryä¸šåŠ¡æ¶æ„é¦–é€‰æ¡†æ¶" class="logo"> <span class="site-name can-hide">Kstryä¸šåŠ¡æ¶æ„é¦–é€‰æ¡†æ¶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><a href="/doc/understandkstry/use_case_demo.html" class="nav-link">
  ä½¿ç”¨åœºæ™¯
</a></div><div class="nav-item"><a href="/doc/specification/quick_start.html" class="nav-link">
  ä½¿ç”¨æ–‡æ¡£
</a></div><div class="nav-item"><a href="http://kstry.cn/modeler" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é…ç½®å°
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/doc/release/kstry-release.html" class="nav-link">
  å‘å¸ƒè®°å½•
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ¨è" class="dropdown-title"><span class="title">æ¨è</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ¨è" class="mobile-dropdown-title"><span class="title">æ¨è</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://waitmoon.com/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è§„åˆ™å¼•æ“â€”ice
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/kstry/kstry-core" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/kstry/kstry-core" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><a href="/doc/understandkstry/use_case_demo.html" class="nav-link">
  ä½¿ç”¨åœºæ™¯
</a></div><div class="nav-item"><a href="/doc/specification/quick_start.html" class="nav-link">
  ä½¿ç”¨æ–‡æ¡£
</a></div><div class="nav-item"><a href="http://kstry.cn/modeler" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é…ç½®å°
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/doc/release/kstry-release.html" class="nav-link">
  å‘å¸ƒè®°å½•
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ¨è" class="dropdown-title"><span class="title">æ¨è</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ¨è" class="mobile-dropdown-title"><span class="title">æ¨è</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://waitmoon.com/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è§„åˆ™å¼•æ“â€”ice
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/kstry/kstry-core" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/kstry/kstry-core" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/doc/specification/quick_start" class="sidebar-heading clickable open"><span>ä½¿ç”¨æ–‡æ¡£</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/specification/quick_start.html" class="sidebar-link">ä¸€ã€å¿«é€Ÿå¼€å§‹</a></li><li><a href="/doc/specification/process_choreography.html" aria-current="page" class="active sidebar-link">äºŒã€æµç¨‹ç¼–æ’</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-1-é¡ºåºæµè¿çº¿" class="sidebar-link">2.1 é¡ºåºæµè¿çº¿</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-1-1-ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼" class="sidebar-link">2.1.1 ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-1-2-æ¡ä»¶è¡¨è¾¾å¼å‡½æ•°" class="sidebar-link">2.1.2 æ¡ä»¶è¡¨è¾¾å¼å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-1-3-æ¡ä»¶è¡¨è¾¾å¼æ‰§è¡Œé¡ºåº" class="sidebar-link">2.1.3 æ¡ä»¶è¡¨è¾¾å¼æ‰§è¡Œé¡ºåº</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-2-å¹¶è¡Œç½‘å…³" class="sidebar-link">2.2 å¹¶è¡Œç½‘å…³</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-3-æ’ä»–ç½‘å…³" class="sidebar-link">2.3 æ’ä»–ç½‘å…³</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-4-åŒ…å«ç½‘å…³" class="sidebar-link">2.4 åŒ…å«ç½‘å…³</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-5-å­æµç¨‹" class="sidebar-link">2.5 å­æµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-5-1-å­æµç¨‹ä½¿ç”¨" class="sidebar-link">2.5.1 å­æµç¨‹ä½¿ç”¨</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-5-2-å­æµç¨‹æ‹¦æˆªå™¨" class="sidebar-link">2.5.2 å­æµç¨‹æ‹¦æˆªå™¨</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-5-3-å­æµç¨‹æ§åˆ¶" class="sidebar-link">2.5.3 å­æµç¨‹æ§åˆ¶</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-6-èŠ‚ç‚¹æ§åˆ¶" class="sidebar-link">2.6 èŠ‚ç‚¹æ§åˆ¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-6-1-å…è®¸æœåŠ¡ä¸ºç©º" class="sidebar-link">2.6.1 å…è®¸æœåŠ¡ä¸ºç©º</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-6-2-è®¾ç½®è¶…æ—¶æ—¶é—´" class="sidebar-link">2.6.2 è®¾ç½®è¶…æ—¶æ—¶é—´</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-6-3-èŠ‚ç‚¹å¼‚å¸¸é‡è¯•" class="sidebar-link">2.6.3 èŠ‚ç‚¹å¼‚å¸¸é‡è¯•</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-6-4-èŠ‚ç‚¹å¼‚å¸¸é™çº§" class="sidebar-link">2.6.4 èŠ‚ç‚¹å¼‚å¸¸é™çº§</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-6-5-å¿½ç•¥æ‰§è¡Œæ—¶å¼‚å¸¸" class="sidebar-link">2.6.5 å¿½ç•¥æ‰§è¡Œæ—¶å¼‚å¸¸</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-6-6-å„æœºåˆ¶ç”Ÿæ•ˆé¡ºåº" class="sidebar-link">2.6.6 å„æœºåˆ¶ç”Ÿæ•ˆé¡ºåº</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-7-æµç¨‹éå†" class="sidebar-link">2.7 æµç¨‹éå†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-7-1-éå†å±æ€§é…ç½®" class="sidebar-link">2.7.1 éå†å±æ€§é…ç½®</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-7-2-éå†æœåŠ¡èŠ‚ç‚¹" class="sidebar-link">2.7.2 éå†æœåŠ¡èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-7-3-éå†å­æµç¨‹èŠ‚ç‚¹" class="sidebar-link">2.7.3 éå†å­æµç¨‹èŠ‚ç‚¹</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-8-æœåŠ¡èŠ‚ç‚¹æ‹¦æˆªå™¨" class="sidebar-link">2.8 æœåŠ¡èŠ‚ç‚¹æ‹¦æˆªå™¨</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-9-è‡ªå®šä¹‰æŒ‡ä»¤" class="sidebar-link">2.9 è‡ªå®šä¹‰æŒ‡ä»¤</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-9-1-å®šä¹‰æŒ‡ä»¤" class="sidebar-link">2.9.1 å®šä¹‰æŒ‡ä»¤</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-9-2-ä½¿ç”¨æŒ‡ä»¤" class="sidebar-link">2.9.2 ä½¿ç”¨æŒ‡ä»¤</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-10-è„šæœ¬æŒ‡ä»¤" class="sidebar-link">2.10 è„šæœ¬æŒ‡ä»¤</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-10-1-å®ç°è„šæœ¬æŒ‡ä»¤" class="sidebar-link">2.10.1 å®ç°è„šæœ¬æŒ‡ä»¤</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-10-2-é»˜è®¤è„šæœ¬åŠŸèƒ½" class="sidebar-link">2.10.2 é»˜è®¤è„šæœ¬åŠŸèƒ½</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-11-ä»£ç æ–¹å¼å®šä¹‰æµç¨‹" class="sidebar-link">2.11 ä»£ç æ–¹å¼å®šä¹‰æµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-11-1-ä¸»æµç¨‹å®šä¹‰" class="sidebar-link">2.11.1 ä¸»æµç¨‹å®šä¹‰</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-11-2-å­æµç¨‹å®šä¹‰" class="sidebar-link">2.11.2 å­æµç¨‹å®šä¹‰</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-11-3-è§£ææ–‡ä»¶å®šä¹‰æµç¨‹" class="sidebar-link">2.11.3 è§£ææ–‡ä»¶å®šä¹‰æµç¨‹</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-12-åŠ¨æ€æµç¨‹é…ç½®" class="sidebar-link">2.12 åŠ¨æ€æµç¨‹é…ç½®</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-12-1-ä½¿ç”¨åŠ¨æ€æµç¨‹" class="sidebar-link">2.12.1 ä½¿ç”¨åŠ¨æ€æµç¨‹</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-12-2-ä½¿ç”¨åŠ¨æ€å­æµç¨‹" class="sidebar-link">2.12.2 ä½¿ç”¨åŠ¨æ€å­æµç¨‹</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-12-3-åŠ¨æ€ä¸é™æ€æµç¨‹å…³ç³»" class="sidebar-link">2.12.3 åŠ¨æ€ä¸é™æ€æµç¨‹å…³ç³»</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-13-ä½¿ç”¨å¼‚æ­¥æµç¨‹" class="sidebar-link">2.13 ä½¿ç”¨å¼‚æ­¥æµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-13-1-å¼€å¯å¼‚æ­¥" class="sidebar-link">2.13.1 å¼€å¯å¼‚æ­¥</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-13-2-å¼‚æ­¥åŒ–ç”Ÿå‘½å‘¨æœŸ" class="sidebar-link">2.13.2 å¼‚æ­¥åŒ–ç”Ÿå‘½å‘¨æœŸ</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-13-3-çº¿ç¨‹åˆ‡æ¢é’©å­" class="sidebar-link">2.13.3 çº¿ç¨‹åˆ‡æ¢é’©å­</a></li><li class="sidebar-sub-header"><a href="/doc/specification/process_choreography.html#_2-13-4-reactoræ¨¡å‹" class="sidebar-link">2.13.4 Reactoræ¨¡å‹</a></li></ul></li></ul></li><li><a href="/doc/specification/data_transfer.html" class="sidebar-link">ä¸‰ã€æ•°æ®æµè½¬</a></li><li><a href="/doc/specification/rbac_model.html" class="sidebar-link">å››ã€RBACæ¨¡å¼</a></li><li><a href="/doc/specification/use_variable.html" class="sidebar-link">äº”ã€å˜é‡</a></li><li><a href="/doc/specification/link_tracing.html" class="sidebar-link">å…­ã€é“¾è·¯è¿½è¸ª</a></li><li><a href="/doc/specification/appendix.html" class="sidebar-link">é™„å½•</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>æµç¨‹ç¼–æ’å¯ä»¥è®©ç³»ç»Ÿæä¾›çš„æœåŠ¡èƒ½åŠ›åšåˆ°å¯è§†åŒ–ï¼Œä¸šåŠ¡é€»è¾‘ä¸€ç›®äº†ç„¶ã€‚BPMNå›¾å½¢ä¸­æ”¯æŒæ™®é€šæµç¨‹å›¾å’Œæ³³é“å›¾</p></div> <p><strong>æ™®é€šæµç¨‹å›¾ï¼š</strong></p> <p><a data-fancybox="" title="æ™®é€šæµç¨‹å›¾" href="http://cdn.kstry.cn/doc/img/image-20211219163540179.png"><img src="http://cdn.kstry.cn/doc/img/image-20211219163540179.png" alt="image-20211219163540179"></a></p> <p><strong>æ³³é“å›¾ï¼š</strong></p> <p><a data-fancybox="" title="æ³³é“å›¾" href="http://cdn.kstry.cn/doc/img/image-20211219163429668.png"><img src="http://cdn.kstry.cn/doc/img/image-20211219163429668.png" alt="image-20211219163429668"></a></p> <h2 id="_2-1-é¡ºåºæµè¿çº¿"><a href="#_2-1-é¡ºåºæµè¿çº¿" class="header-anchor">#</a> 2.1 é¡ºåºæµè¿çº¿</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Kstryæ¡†æ¶æ²¿ç”¨äº†BPMNåè®®ä¸­çš„æ¦‚å¿µï¼Œæµç¨‹å›¾ä¸­èŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´éœ€è¦ä»¥æœ‰å‘çº¿æ®µè¿æ¥ï¼Œä»¥æ­¤æ¥å®šä¹‰ç»„ä»¶é—´çš„å‰åè°ƒç”¨å…³ç³»ã€‚åˆ¤æ–­æ˜¯å¦ç»§ç»­æ‰§è¡Œä¸‹ä¸€èŠ‚ç‚¹çš„æ¡ä»¶è¡¨è¾¾å¼ä¹Ÿæ˜¯å®šä¹‰åœ¨è¿™é‡Œçš„</p></div> <h3 id="_2-1-1-ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼"><a href="#_2-1-1-ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼" class="header-anchor">#</a> 2.1.1 ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼</h3> <p><strong>BPMNå›¾ç¤ºå¦‚ä¸‹ï¼š</strong></p> <p><a data-fancybox="" title="å¼€å§‹äº‹ä»¶æµç¨‹åˆ¤æ–­" href="../img2/d063abb195251c78b57c4135f9585366.png"><img src="/assets/img/d063abb195251c78b57c4135f9585366.2d8a3375.png" alt="WX20231009"></a></p> <blockquote><p><strong>ä»£ç æ–¹å¼å®šä¹‰ä¸Šè¿°æµç¨‹ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">startEventSequenceFlowProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">startEventSequenceFlowProcess</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token string">&quot;var.type == 1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">plusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token string">&quot;var.type == 2&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">multiplyCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></blockquote> <p><strong>å®šä¹‰æœåŠ¡ç»„ä»¶å¹¶æµ‹è¯•ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TaskComponent</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalculateService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NoticeResult</span>
    <span class="token annotation punctuation">@TaskService</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">plusCalculate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NoticeResult</span>
    <span class="token annotation punctuation">@TaskService</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">multiplyCalculate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * type = 1 æ—¶æ‰§è¡ŒåŠ æ³•
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPlusCalculateByType1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">InScopeData</span> varScopeData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InScopeData</span><span class="token punctuation">(</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span><span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span>varScopeData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startId</span><span class="token punctuation">(</span><span class="token string">&quot;start-event-sequence-flow-test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * type = 2 æ—¶æ‰§è¡Œä¹˜æ³•
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMultiplyCalculateByType2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">InScopeData</span> varScopeData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InScopeData</span><span class="token punctuation">(</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span><span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span>varScopeData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startId</span><span class="token punctuation">(</span><span class="token string">&quot;start-event-sequence-flow-test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>Â Â Â Â ğŸŸ¢ å¦‚ä¸Šæ‰€ç¤ºå®šä¹‰äº†<code>CalculateService</code>æœåŠ¡ç»„ä»¶ï¼Œé‡Œé¢åˆ†åˆ«åŒ…å«ä¸€ä¸ªåŠ æ³•å’Œä¹˜æ³•è¿ç®—ã€‚ä¸¤æœåŠ¡èŠ‚ç‚¹å‰çš„è¿çº¿åˆ†åˆ«å®šä¹‰äº†<code>var.type == 1</code>å’Œ<code>var.type == 2</code>ä¸¤ä¸ªè¡¨è¾¾å¼ï¼Œå½“typeè¢«åˆ†åˆ«æŒ‡å®š1ã€2æ—¶ï¼Œç¨‹åºä¼šæ‰§è¡Œå¯¹åº”çš„åŠ æ³•æˆ–ä¹˜æ³•è¿ç®—</p> <p>Â Â Â Â ğŸŸ¢ Kstry å¼•æ“ä¸­æ¡ä»¶è¡¨è¾¾å¼è§£æå™¨æœ‰ä¸‰ä¸ªï¼Œbooleanè§£æå™¨ã€è§’è‰²é‰´æƒè§£æå™¨ã€Spelè¡¨è¾¾å¼è§£æå™¨</p> <p>Â Â Â Â Â Â Â Â ğŸ”· å¦‚æœæ˜¯ç›´æ¥è¾“å…¥booleanå€¼ï¼Œæ¯”å¦‚ trueã€yã€noç­‰ä¼šè¢«è®¤å®šä¸º boolean å€¼ï¼Œä½¿ç”¨ boolean è§£æå™¨è§£æåˆ¤æ–­</p> <p>Â Â Â Â Â Â Â Â ğŸ”· å¦‚æœç¬¦åˆæƒé™å®šä¹‰çš„æ ¼å¼ï¼Œä½¿ç”¨è§’è‰²é‰´æƒè§£æå™¨è§£æåˆ¤æ–­ï¼Œåé¢è®²åˆ°è§’è‰²æƒé™æ—¶ä¼šå†è¯¦ç»†ä»‹ç»</p> <p>Â Â Â Â Â Â Â Â ğŸ”· å‰ä¸¤è€…éƒ½ä¸ç¬¦åˆæ—¶åˆ™ä½¿ç”¨Spelè¡¨è¾¾å¼è§£æå™¨ï¼Œè§£æå¼•æ“æ˜¯ Spring çš„ Spel è§£æå™¨ï¼Œè¡¨è¾¾å¼æ ¼å¼è§£æå¤±è´¥æ—¶ä¼šæŠ¥é”™ã€‚è§£æç»“æœä¸€å®šå¾—æ˜¯Booleanå€¼</p> <p>Â Â Â Â ğŸŸ¢ äº‹ä»¶ï¼ˆEventï¼‰ã€æœåŠ¡èŠ‚ç‚¹ï¼ˆServiceTaskï¼‰ã€ç½‘å…³ï¼ˆGatewayï¼‰éƒ½å¯ä»¥ä»å½“å‰èŠ‚ç‚¹å¼•å‡ºå¤šä¸ªæ”¯è·¯ï¼ˆä¹Ÿå«å…è®¸æœ‰å¤šä¸ªå‡ºåº¦ï¼‰ï¼Œä½†æ˜¯<strong>åªæœ‰å¹¶è¡Œç½‘å…³ã€åŒ…å«ç½‘å…³ã€ç»“æŸäº‹ä»¶å¯ä»¥æ¥æ”¶å¤šä¸ªå…¥åº¦</strong>ï¼Œå…¶ä»–èŠ‚ç‚¹æœ‰å¤šä¸ªå…¥åº¦æ—¶ä¼šå‡ºç°é…ç½®æ–‡ä»¶è§£æå¤±è´¥çš„æŠ¥é”™</p> <p>Â Â Â Â ğŸŸ¢ æœåŠ¡èŠ‚ç‚¹ï¼ˆServiceTaskï¼‰ã€äº‹ä»¶ï¼ˆEventï¼‰åé¢çš„å‡ºåº¦å¦‚æœæ²¡æœ‰å®šä¹‰è¡¨è¾¾å¼æ—¶ï¼Œé»˜è®¤ä¸ºtrueã€‚ä¸åŒç±»å‹çš„ç½‘å…³ï¼ˆGatewayï¼‰ç‰¹ç‚¹ä¸åŒï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»</p> <h3 id="_2-1-2-æ¡ä»¶è¡¨è¾¾å¼å‡½æ•°"><a href="#_2-1-2-æ¡ä»¶è¡¨è¾¾å¼å‡½æ•°" class="header-anchor">#</a> 2.1.2 æ¡ä»¶è¡¨è¾¾å¼å‡½æ•°</h3> <p>Â Â Â Â åœ¨æµç¨‹å®šä¹‰ä¸­ï¼Œå¦‚æœé‡åˆ°äº†æ¯”è¾ƒå¤æ‚çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œä»…ä»…ä½¿ç”¨æ™®é€šæ¡ä»¶è¡¨è¾¾å¼æ— æ³•æ»¡è¶³è¯‰æ±‚æ—¶ï¼Œå°±éœ€è¦è€ƒè™‘ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼å‡½æ•°äº†ã€‚å‡è®¾éœ€è¦å°†ä¸Šè¿°ä¾‹å­ä¸­çš„<code>var.type == 1</code>æ”¹æˆä½¿ç”¨Javaä¸­çš„<code>Objects.equals()</code>å‡½æ•°æ¥è¿›è¡Œåˆ¤æ–­ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼æ¥å®šä¹‰ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomExpressionFunction</span> <span class="token keyword">implements</span> <span class="token class-name">ExpressionAliasRegister</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ExpressionAlias</span><span class="token punctuation">&gt;</span></span> <span class="token function">registerAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token string">&quot;eq&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;equals&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä¸Šè¿°å®šä¹‰å®Œæˆä¹‹åï¼Œ<code>var.type == 1</code>è¡¨è¾¾å¼å°±å¯ä»¥æ”¹æˆ<code>@eq(var.type, 1)</code>äº†ã€‚è¡¨è¾¾å¼å‡½æ•°ä½¿ç”¨æ ¼å¼æ˜¯ï¼š<code>@{å‡½æ•°åˆ«å}({æ–¹æ³•å…¥å‚...})</code></p> <p>Â Â Â Â ğŸŸ¢ ä»»æ„å®šä¹‰ä¸€ä¸ªç±»å®ç°<code>ExpressionAliasRegister</code>æ¥å£ï¼Œå¹¶å°†è¯¥ç±»æ”¾åˆ°Springå®¹å™¨ä¸­</p> <p>Â Â Â Â ğŸŸ¢ å®ç°<code>ExpressionAliasRegister</code>æ¥å£åéœ€è¦å®ç°<code>registerAlias()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª<code>ExpressionAlias</code>å¯¹è±¡çš„é›†åˆ</p> <p>Â Â Â Â ğŸŸ¢ <code>ExpressionAlias</code>å¯¹è±¡æ„é€ å‡½æ•°æœ‰ä¸‰ä¸ªå…¥å‚ï¼Œå«ä¹‰ä¾æ¬¡æ˜¯ï¼šä½¿ç”¨å‡½æ•°æ—¶çš„åˆ«åã€ä½¿ç”¨ä»£ç ä¸­çš„å“ªä¸ªç±»ã€ä½¿ç”¨ç±»ä¸­çš„å“ªä¸ªé™æ€æ–¹æ³•çš„æ–¹æ³•å <strong>ï¼ˆéœ€è¦æ³¨æ„ä¸€å®šå¾—æ˜¯ç±»ä¸­é™æ€çš„Publicæ–¹æ³•ï¼‰</strong></p> <p>Â Â Â Â ğŸŸ¢ è¡¨è¾¾å¼å‡½æ•°æ”¯æŒå¹¶åˆ—å’ŒåµŒå¥—ï¼Œç±»ä¼¼è¿™ç§<code>@eq(@toInt(@toString(var.type)), @toInt('1')) &amp;&amp; @noneNull(var.type)</code>æŠ½é£çš„è¡¨è¾¾å¼ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„</p> <p>Â Â Â Â ğŸŸ¢ <strong>å¯ä»¥å®šä¹‰ä¸ä¸šåŠ¡å¼ºç›¸å…³çš„è¡¨è¾¾å¼å‡½æ•°æ¥è¿›è¡Œè·¯ç”±åˆ¤æ–­ã€‚å½“ç„¶è¡¨è¾¾å¼å‡½æ•°çš„åŠŸèƒ½ä¹‹å¼ºå¤§å¹¶ä¸ä»…ä»…å±€é™åœ¨æ¡ä»¶åˆ¤æ–­ä¸Šï¼Œç”šè‡³å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å‡½æ•°æ¥æ”¶æ•°æ®åŸŸä¸­çš„å¯¹è±¡æ¥è¿›è¡Œæ“ä½œã€‚</strong> æ¯”å¦‚ç±»å‹è½¬æ¢ã€åŠ å·¥å¯¹è±¡ä¸­çš„æŸäº›å­—æ®µç­‰</p> <p>Â Â Â Â ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæ¡†æ¶æä¾›äº†ä¸€äº›é»˜è®¤çš„è¡¨è¾¾å¼å‡½æ•°ï¼Œåœ¨éœ€è¦è¿™äº›å‡½æ•°æ—¶æ— éœ€é¢å¤–å®šä¹‰å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚é»˜è®¤è¡¨è¾¾å¼å‡½æ•°çš„å®šä¹‰ä¹ŸåŒæ ·ä½¿ç”¨äº†ä¸Šè¿°çš„æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒæºç ä¸­çš„<code>BasicExpressionAliasRegister</code>æ¥äº†è§£å…·ä½“æ”¯æŒäº†å“ªäº›é»˜è®¤å‡½æ•°ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BasicExpressionAliasRegister</span> <span class="token keyword">implements</span> <span class="token class-name">ExpressionAliasRegister</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ExpressionAlias</span><span class="token punctuation">&gt;</span></span> <span class="token function">registerAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>
                <span class="token comment">// object util</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>equals<span class="token punctuation">,</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;equals&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>notEquals<span class="token punctuation">,</span> <span class="token class-name">ExpressionAliasUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;notEquals&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>isNull<span class="token punctuation">,</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isNull&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>notNull<span class="token punctuation">,</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;nonNull&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>anyNull<span class="token punctuation">,</span> <span class="token class-name">ExpressionAliasUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;anyNull&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>noneNull<span class="token punctuation">,</span> <span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;allNotNull&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

                <span class="token comment">// string util</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>isBlank<span class="token punctuation">,</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isBlank&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>notBlank<span class="token punctuation">,</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isNotBlank&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>noneBlank<span class="token punctuation">,</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isNoneBlank&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>allBlank<span class="token punctuation">,</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isAllBlank&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>anyBlank<span class="token punctuation">,</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isAnyBlank&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>toString<span class="token punctuation">,</span> <span class="token class-name">ExpressionAliasUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;toString&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

                <span class="token comment">// number util</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>isNumber<span class="token punctuation">,</span> <span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isCreatable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>toInt<span class="token punctuation">,</span> <span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;toInt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>toLong<span class="token punctuation">,</span> <span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;toLong&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>toDouble<span class="token punctuation">,</span> <span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;toDouble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>toFloat<span class="token punctuation">,</span> <span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;toFloat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>toByte<span class="token punctuation">,</span> <span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;toByte&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>toShort<span class="token punctuation">,</span> <span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;toShort&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

                <span class="token comment">// bool util</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>toBool<span class="token punctuation">,</span> <span class="token class-name">BooleanUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;toBoolean&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>isTrue<span class="token punctuation">,</span> <span class="token class-name">BooleanUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isTrue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>isFalse<span class="token punctuation">,</span> <span class="token class-name">BooleanUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isFalse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>notFalse<span class="token punctuation">,</span> <span class="token class-name">BooleanUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isNotFalse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>notTrue<span class="token punctuation">,</span> <span class="token class-name">BooleanUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isNotTrue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

                <span class="token comment">// common util</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>max<span class="token punctuation">,</span> <span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;max&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>min<span class="token punctuation">,</span> <span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;min&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>isEmpty<span class="token punctuation">,</span> <span class="token class-name">ExpressionAliasUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;isEmpty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>notEmpty<span class="token punctuation">,</span> <span class="token class-name">ExpressionAliasUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;notEmpty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>contains<span class="token punctuation">,</span> <span class="token class-name">ExpressionAliasUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;contains&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token class-name">ExpressionAliasUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;size&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExpressionAlias</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span>validId<span class="token punctuation">,</span> <span class="token class-name">ExpressionAliasUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;validId&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>Â Â Â Â å½“é€šè¿‡ä»£ç æ–¹å¼å®šä¹‰æµç¨‹æ—¶ï¼Œæ¡†æ¶è¿˜æä¾›äº†<code>Exp</code>ç±»æ¥è¾…åŠ©å®šä¹‰æ¡ä»¶è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ä¸Šé¢çš„æµç¨‹å°±å¯ä»¥å†™æˆä¸‹é¢è¿™ç§</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">startEventSequenceFlowProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">startEventSequenceFlowProcess</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">plusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">multiplyCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Â Â Â Â è‡ªå®šä¹‰å‡½æ•°æ—¶ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰å·¥å…·ç±»ç»§æ‰¿<code>Exp</code>æ¥æ‰©å±•æ”¯æŒ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * æ‰©å±•å·¥å…·ç±»
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Ex</span> <span class="token keyword">extends</span> <span class="token class-name">Exp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Ex</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Ex</span> <span class="token function">customEquals</span><span class="token punctuation">(</span><span class="token class-name">String</span> left<span class="token punctuation">,</span> <span class="token class-name">String</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>expression <span class="token operator">=</span> <span class="token class-name">GlobalUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;{}@eq({}, {})&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">bu</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Ex</span><span class="token punctuation">&gt;</span></span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Ex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">startEventSequenceFlowProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">startEventSequenceFlowProcess</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">bu</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">customEquals</span><span class="token punctuation">(</span><span class="token string">&quot;var.type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">plusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">bu</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">customEquals</span><span class="token punctuation">(</span><span class="token string">&quot;var.type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">multiplyCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_2-1-3-æ¡ä»¶è¡¨è¾¾å¼æ‰§è¡Œé¡ºåº"><a href="#_2-1-3-æ¡ä»¶è¡¨è¾¾å¼æ‰§è¡Œé¡ºåº" class="header-anchor">#</a> 2.1.3 æ¡ä»¶è¡¨è¾¾å¼æ‰§è¡Œé¡ºåº</h3> <p>Â Â Â Â æ”¯æŒ<code>o{æ•°å­—}: è¡¨è¾¾å¼</code>(æ¯”å¦‚ï¼š<code>o1: var.type == 1</code> )ï¼Œæ¥å®šä¹‰å„ä¸ªæ”¯è·¯ä¸Šè¡¨è¾¾å¼çš„æ‰§è¡Œé¡ºåºï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚<strong>æœªæŒ‡å®šé¡ºåºæ—¶è¡¨è¾¾å¼é»˜è®¤ä¸ºæœ€ä½ä¼˜å…ˆçº§</strong></p> <p><a data-fancybox="" title="æ¡ä»¶è¡¨è¾¾å¼æŒ‡å®šæ‰§è¡Œé¡ºåº" href="../img2/42c62ea012598b30abebc0bfc4786141.png"><img src="/assets/img/42c62ea012598b30abebc0bfc4786141.875e0fd5.png" alt="42c62ea012598b30abebc0bfc4786141"></a></p> <p>Â Â Â Â  ä¸Šå›¾ç”±äºæŒ‡å®šäº†æµç¨‹è¡¨è¾¾å¼ä¼˜å…ˆçº§ä¸º1ï¼Œæ‰€ä»¥ä¹˜æ³•è®¡ç®—æœåŠ¡èŠ‚ç‚¹å‰çš„è¡¨è¾¾å¼ä¼šå…ˆè¢«æ‰§è¡Œï¼Œä¹‹åæ‰ä¼šæ˜¯åŠ æ³•è®¡ç®—æœåŠ¡èŠ‚å‰çš„è¡¨è¾¾å¼ã€‚</p> <p>Â Â Â Â  å†ä¸€ä¸ªåœºæ™¯æ’ä»–ç½‘å…³å‡ºåº¦è¿çº¿ä¸Šçš„è¡¨è¾¾å¼ï¼Œåªè¦æœ‰ä¸€ä¸ªæ‰§è¡Œç»“æœä¸ºtrueï¼Œå…¶ä»–å‡ºåº¦åé¢çš„æµç¨‹éƒ½ä¸ä¼šå†æ‰§è¡Œäº†ï¼ŒåŒæ ·çš„ä¸ä»–ä»¬ç›¸å…³çš„æ¡ä»¶è¡¨è¾¾å¼ä¹Ÿä¸ä¼šå†æ‰§è¡Œã€‚æ­¤æ—¶å°±å¯èƒ½éœ€è¦æŒ‡å®šå“ªä¸ªæ¡ä»¶å…ˆåˆ¤æ–­ã€‚èŠ‚ç‚¹å¤šä¸ªå‡ºåº¦è¡¨è¾¾å¼åˆ†åˆ«è®¾ç½®æ‰§è¡Œé¡ºåºå°±ç›¸å½“äºæ˜¯ä»£ç ä¸­çš„<code>if... else if... else if... else</code></p> <h2 id="_2-2-å¹¶è¡Œç½‘å…³"><a href="#_2-2-å¹¶è¡Œç½‘å…³" class="header-anchor">#</a> 2.2 å¹¶è¡Œç½‘å…³</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>ç¨‹åºä¸­ç»å¸¸ä¼šé‡åˆ°ä¸€äº›é€šè¿‡å¹¶å‘è°ƒç”¨å„ç±»æ¥å£æ¥åŠ è½½å„ç±»èµ„æºä¿¡æ¯çš„ä¾‹å­ï¼Œé€šè¿‡å¹¶å‘æ“ä½œå¯ä»¥è·å–æ›´çŸ­çš„å“åº”æ—¶é•¿ã€‚åœ¨Kstryæ¡†æ¶ä¸­åªè¦åä¸€ä¸ªèŠ‚ç‚¹çš„å…¥å‚å’Œå‰ä¸€ä¸ªèŠ‚ç‚¹çš„å‡ºå‚æ²¡æœ‰å‰åä¾èµ–å…³ç³»å°±å¯ä»¥é€šè¿‡å¹¶è¡Œç½‘å…³é…ç½®å¹¶è¡Œ</p></div> <p><strong>BPMNå›¾ç¤ºå¦‚ä¸‹ï¼š</strong></p> <p><a data-fancybox="" title="å¹¶è¡Œç½‘å…³æ¼”ç¤º" href="../img2/ea9b796b911997a82d0058487f0e8deb.png"><img src="/assets/img/ea9b796b911997a82d0058487f0e8deb.e88ff160.png" alt="ea9b796b911997a82d0058487f0e8deb"></a></p> <blockquote><p><strong>ä»£ç æ–¹å¼å®šä¹‰ä¸Šè¿°æµç¨‹ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">testParallelGatewayDemoProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">testParallelGatewayDemoProcess</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ParallelJoinPoint</span> parallelJoinPoint <span class="token operator">=</span> processLink<span class="token punctuation">.</span><span class="token function">nextParallel</span><span class="token punctuation">(</span>processLink<span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink<span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
            parallelJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">FlowDemoService</span><span class="token operator">::</span><span class="token function">getStudentInfo</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            parallelJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">FlowDemoService</span><span class="token operator">::</span><span class="token function">getClassInfo</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></blockquote> <p><strong>å®šä¹‰æœåŠ¡ç»„ä»¶ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@NoticeVar</span>
<span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;è·å–å­¦ç”Ÿä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Student</span> <span class="token function">getStudentInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span> <span class="token class-name">Long</span> studentId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    student<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>studentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    student<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span> <span class="token operator">+</span> studentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> student<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@NoticeVar</span>
<span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>desc <span class="token operator">=</span> <span class="token string">&quot;è·å–ç­çº§ä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ClassInfo</span> <span class="token function">getClassInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span> <span class="token class-name">Long</span> classId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClassInfo</span> classInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    classInfo<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>classId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    classInfo<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span> <span class="token operator">+</span> classId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> classInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>æµ‹è¯•æ‰§è¡Œï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testParallelGatewayDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// var åŸŸåˆå§‹åŒ–æ•°æ®</span>
    <span class="token class-name">InScopeData</span> varScopeData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InScopeData</span><span class="token punctuation">(</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>studentId<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>classId<span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ„é€ request</span>
    <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token function">resultType</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span>varScopeData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startId</span><span class="token punctuation">(</span><span class="token string">&quot;start-event-parallel-gateway-demo&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">resultBuilder</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Object</span> r<span class="token punctuation">,</span> <span class="token class-name">ScopeDataQuery</span> query<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// r: æµç¨‹æ‰§è¡Œå®Œè¿”å›çš„ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰</span>
                <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> objMap <span class="token operator">=</span> <span class="token class-name">Maps</span><span class="token punctuation">.</span><span class="token function">newHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                objMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>student<span class="token punctuation">,</span> query<span class="token punctuation">.</span><span class="token function">getVarData</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                objMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>classInfo<span class="token punctuation">,</span> query<span class="token punctuation">.</span><span class="token function">getVarData</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>classInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> objMap<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ‰§è¡Œ</span>
    <span class="token class-name">TaskResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>classInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>Â Â Â Â ğŸŸ¢ ä½¿ç”¨å¹¶è¡Œç½‘å…³æ—¶ï¼Œä¸€èˆ¬ä¼šæœ‰å‰åä¸¤ä¸ªå¹¶è¡Œç½‘å…³èŠ‚ç‚¹ä¸€èµ·å‡ºç°ï¼Œå‰é¢å°†ä¸€ä¸ªåˆ†æ”¯æ‹†è§£æˆå¤šä¸ªï¼Œåé¢å°†å¤šä¸ªåˆ†æ”¯è¿›è¡Œèšåˆ</p> <p>Â Â Â Â ğŸŸ¢ å¹¶è¡Œç½‘å…³æ”¯æŒå¼€å¯å¼‚æ­¥æµç¨‹ã€‚æœªå¼€å¯å¼‚æ­¥æµç¨‹æ—¶ï¼Œå¹¶è¡Œç½‘å…³æ‹†åˆ†å‡ºçš„å¤šä¸ªåˆ†æ”¯è¿˜æ˜¯ä¸€ä¸ªçº¿ç¨‹é€ä¸€æ‰§è¡Œï¼Œå¼€å¯å¼‚æ­¥æµç¨‹åï¼Œæ¯ä¸ªåˆ†æ”¯éƒ½ä¼šè¢«æ„å»ºæˆå¼‚æ­¥ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œ</p> <p>Â Â Â Â ğŸŸ¢ å½“å¹¶è¡Œç½‘å…³åè¦æ‰§è¡Œçš„åˆ†æ”¯æ•°é‡ä¸º1æ—¶ï¼Œå¼€å¯å¹¶å‘çš„æ“ä½œæ— æ•ˆï¼Œè¿˜ä¼šæ˜¯å½“å‰çº¿ç¨‹åŒæ­¥æ‰§è¡Œåé¢ä¸€ä¸ªåˆ†æ”¯çš„ä»»åŠ¡</p> <p>Â Â Â Â ğŸŸ¢ å¹¶è¡Œç½‘å…³åé¢çš„å‡ºåº¦å¦‚æœæœ‰è¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼ä¼šè¢«å¿½ç•¥ï¼Œæ— è®ºè®¾ç½®ä¸å¦éƒ½ä¸ä¼šè§£æï¼Œéƒ½ä¼šé»˜è®¤ä¸ºtrue</p> <p>Â Â Â Â ğŸŸ¢ <strong>å¹¶è¡Œç½‘å…³è¦æ±‚æ‰€æœ‰å…¥åº¦å…¨éƒ¨æ‰§è¡Œå®Œæ‰èƒ½å‘ä¸‹ç»§ç»­</strong>ï¼Œå¦åˆ™å°†ä¸€ç›´ç­‰å¾…ã€‚å¦‚æœå¹¶è¡Œç½‘å…³å…¥åº¦ä¸­ç”±äºè¡¨è¾¾å¼æ‰§è¡Œç»“æœä¸ºfalseç­‰åŸå› å¯¼è‡´ä¸å¯è¾¾æ—¶ä¼šæœ‰ç±»ä¼¼æŠ¥é”™ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[K1040008] A process branch that cannot reach the ParallelGateway appears! sequence flow: SEQUENCE_FLOW:[id: c9c35988942e4ac79bab9a5689522887-7, name: ], parallel gateway: PARALLEL_GATEWAY:[id: 154a637311c646b1ad54e969eaa52b41-10, name: null]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Â Â Â Â ğŸŸ¢ è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§æ–¹å¼ï¼š</p> <p>Â Â Â Â Â Â Â Â ğŸ”· å°†å¹¶è¡Œç½‘å…³æ”¹ä¸ºåŒ…å«ç½‘å…³ï¼ŒåŒ…å«ç½‘å…³ä¸è¦æ±‚æ‰€æœ‰å…¥åº¦åˆ†æ”¯éƒ½å¿…é¡»è¢«æ‰§è¡Œï¼Œå¹¶ä¸”è¿˜æ‹¥æœ‰å¹¶è¡Œç½‘å…³å¼€å¯å¹¶å‘ã€æ±‡èšå¹¶è¡Œåˆ†æ”¯ç­‰ç‰¹æ€§</p> <p>Â Â Â Â Â Â Â Â ğŸ”· å¦‚ä¸‹å›¾ï¼Œå…³é—­å¹¶è¡Œç½‘å…³çš„ä¸¥æ ¼æ¨¡å¼ï¼š<code>strict-mode=false</code>ã€‚å…³é—­ä¸¥æ ¼æ¨¡å¼çš„å¹¶è¡Œç½‘å…³ï¼Œä¸å†é™åˆ¶ç½‘å…³å…¥åº¦å¿…é¡»éƒ½è¢«æ‰§è¡Œã€‚å…³é—­ä¸¥æ ¼æ¨¡å¼çš„å¹¶è¡Œç½‘å…³ä¸åŒ…å«ç½‘å…³ä¹Ÿå¹¶éæ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚å› ä¸ºå¹¶è¡Œç½‘å…³åé¢å‡ºåº¦çš„æ¡ä»¶è¡¨è¾¾å¼æ˜¯è¢«å¿½ç•¥çš„ï¼Œä½†æ˜¯åŒ…å«ç½‘å…³åé¢å‡ºåº¦çš„æ¡ä»¶è¡¨è¾¾å¼æ˜¯ä¼šè¢«è§£ææ‰§è¡Œèµ·åˆ°å†³ç­–ä½œç”¨çš„</p> <p><a data-fancybox="" title="å¹¶è¡Œç½‘å…³è®¾ç½®æˆéä¸¥æ ¼æ¨¡å¼" href="../img2/c7566eadd23cf8f33b54a6bec6b210e8.png"><img src="/assets/img/c7566eadd23cf8f33b54a6bec6b210e8.8e9bc50b.png" alt="c7566eadd23cf8f33b54a6bec6b210e8"></a></p> <h2 id="_2-3-æ’ä»–ç½‘å…³"><a href="#_2-3-æ’ä»–ç½‘å…³" class="header-anchor">#</a> 2.3 æ’ä»–ç½‘å…³</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>ç¨‹åºä¸­ç»å¸¸ä¼šä½¿ç”¨<code>if... else if... else if... else...</code>çš„é€»è¾‘ã€‚Kstryæ¡†æ¶ä¸­å¯ä»¥ä½¿ç”¨æ’ä»–ç½‘å…³å®ç°å®Œå…¨ç›¸åŒçš„é€»è¾‘ã€‚â€œæ’ä»–â€é¡¾åæ€ä¹‰ï¼Œç½‘å…³åé¢æœ€ç»ˆåªæœ‰ä¸€ä¸ªåˆ†æ”¯è¢«æ‰§è¡Œï¼Œå…¶ä»–åˆ†æ”¯éƒ½ä¼šè¢«ä¸­æ–­</p></div> <p><strong>BPMNå›¾ç¤ºå¦‚ä¸‹ï¼š</strong></p> <p><a data-fancybox="" title="æ’ä»–ç½‘å…³æ¼”ç¤º" href="../img2/77160e7ab6d657b90d0604442caaf9f9.png"><img src="/assets/img/77160e7ab6d657b90d0604442caaf9f9.0be516a6.png" alt="77160e7ab6d657b90d0604442caaf9f9"></a></p> <blockquote><p>ä»‹ç»é¡ºåºæµè¿çº¿æ—¶æœ‰æåŠï¼Œæ¡†æ¶æ”¯æŒo{æ•°å­—}: è¡¨è¾¾å¼(æ¯”å¦‚ï¼š<code>O1: @equals(var.factor, '+')</code> )ï¼Œæ¥å®šä¹‰å„ä¸ªæ”¯è·¯ä¸Šè¡¨è¾¾å¼çš„æ‰§è¡Œé¡ºåºï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚æœªæŒ‡å®šé¡ºåºæ—¶è¡¨è¾¾å¼é»˜è®¤ä¸ºæœ€ä½ä¼˜å…ˆçº§</p></blockquote> <blockquote><p><strong>ä»£ç æ–¹å¼å®šä¹‰ä¸Šè¿°æµç¨‹ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">testExclusiveGatewayDemoProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">testExclusiveGatewayDemoProcess</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ProcessLink</span> exclusive <span class="token operator">=</span> processLink<span class="token punctuation">.</span><span class="token function">nextExclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exclusive<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'+'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">plusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exclusive<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'*'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">multiplyCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exclusive<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">minusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></blockquote> <p><strong>å®šä¹‰æœåŠ¡ç»„ä»¶ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@NoticeResult</span>
<span class="token annotation punctuation">@TaskService</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">plusCalculate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@NoticeResult</span>
<span class="token annotation punctuation">@TaskService</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">multiplyCalculate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@NoticeResult</span>
<span class="token annotation punctuation">@TaskService</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">minusCalculate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token annotation punctuation">@VarTaskParam</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>æµ‹è¯•æ‰§è¡Œï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testExclusiveGatewayDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// var åŸŸåˆå§‹åŒ–æ•°æ®</span>
    <span class="token class-name">InScopeData</span> varScopeData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InScopeData</span><span class="token punctuation">(</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ„é€ request</span>
    <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span><span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span>varScopeData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startId</span><span class="token punctuation">(</span><span class="token string">&quot;start-event-exclusive-gateway-demo&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ‰§è¡Œ é»˜è®¤</span>
    <span class="token class-name">TaskResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ‰§è¡Œ +</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>factor<span class="token punctuation">,</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ‰§è¡Œ *</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>factor<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>Â Â Â Â ğŸŸ¢ ä¹‹å‰æœ‰æåˆ°è¿‡<strong>åªæœ‰å¹¶è¡Œç½‘å…³ã€åŒ…å«ç½‘å…³ã€ç»“æŸäº‹ä»¶å¯ä»¥æ¥æ”¶å½’å¹¶å¤šä¸ªå…¥åº¦</strong>ï¼Œæ˜¾ç„¶æ’ä»–ç½‘å…³å¹¶ä¸åœ¨æ­¤åˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´æ’ä»–ç½‘å…³åªèƒ½æ¥æ”¶ä¸€ä¸ªå…¥åº¦ï¼Œä¸å…è®¸å¤šä¸ªç®­å¤´æŒ‡å‘åŒä¸€ä¸ªæ’ä»–ç½‘å…³</p> <p>Â Â Â Â ğŸŸ¢ æ’ä»–ç½‘å…³å…¥åº¦åªèƒ½æœ‰ä¸€ä¸ªï¼Œå‡ºåº¦å¯ä»¥å¤šä¸ªã€‚å‡ºåº¦ä¸Šé¢çš„æ¡ä»¶è¡¨è¾¾å¼ä¼šè¢«è§£ææ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰æ¡ä»¶è¡¨è¾¾å¼æ—¶ä¼šé»˜è®¤æ˜¯true</p> <p>Â Â Â Â ğŸŸ¢ æ’ä»–ç½‘å…³æœ‰å¤šä¸ªå‡ºåº¦è¡¨è¾¾å¼è¢«è§£ææˆtrueæ—¶ï¼Œä¼šé€‰æ‹©ç¬¬ä¸€ä¸ªä¸ºtrueçš„åˆ†æ”¯ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œå…¶ä»–çš„å°†ä¼šè¢«å¿½ç•¥ã€‚å›¾ç¤ºä¸­å‡ºåº¦çš„å‰åå¹¶ä¸ä»£è¡¨ç¨‹åºè§£ææ—¶å‡ºåº¦ä¸Šè¡¨è¾¾å¼åˆ¤æ–­æ‰§è¡Œçš„å…ˆåé¡ºåºï¼Œéœ€è¦æŒ‡å®šé¡ºåºæ—¶å¯ä»¥ä½¿ç”¨<code>o{æ•°å­—}: è¡¨è¾¾å¼</code></p> <p>Â Â Â Â ğŸŸ¢ å½“å…¨éƒ¨å‡ºåº¦ä¸Šçš„è¡¨è¾¾å¼éƒ½è§£æä¸ºfalseæ—¶ä¼šæŠ›å‡ºå¼‚å¸¸å¹¶ç»“æŸæµç¨‹ï¼Œå¼‚å¸¸ä¿¡æ¯`ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[K1040008] Match to the next process node as empty! current node identity: EXCLUSIVE_GATEWAY:[id: eeec292f8c5e47919238eb9acd031ce5-3, name: null], desired list of possible nodes for later execution: SERVICE_TASK:[id: 1a5bda10f58a41f1a0c80bbcdcfc9b59-5, name: null, component: calculateService, service: plusCalculate], SERVICE_TASK:[id: bb2806a1ec3f4464a3333cde5c7feabf-8, name: null, component: calculateService, service: multiplyCalculate], SERVICE_TASK:[id: c108dc8d31bf4a71bebf97fedf66432e-11, name: null, component: calculateService, service: minusCalculate]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Â Â Â Â ğŸŸ¢ ç”±äºæ’ä»–ç½‘å…³æœ€ç»ˆæ‰§è¡Œçš„åªæœ‰ä¸€æ¡é“¾è·¯ï¼Œæ‰€ä»¥æ’ä»–ç½‘å…³æ˜¯ä¸æ”¯æŒå¼€å¯å¼‚æ­¥çš„ï¼Œå› ä¸ºæ²¡å•¥æ„ä¹‰</p> <h2 id="_2-4-åŒ…å«ç½‘å…³"><a href="#_2-4-åŒ…å«ç½‘å…³" class="header-anchor">#</a> 2.4 åŒ…å«ç½‘å…³</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>åŒ…å«ç½‘å…³æ˜¯å¹¶è¡Œç½‘å…³å’Œæ’ä»–ç½‘å…³çš„ç»“åˆã€‚åŒ…å«ç½‘å…³å¯ä»¥åƒæ’ä»–ç½‘å…³ä¸€æ ·æ‰§è¡Œåé¢å‡ºåº¦ä¸Šçš„è¡¨è¾¾å¼ï¼Œè¿˜ä¸åƒæ’ä»–ç½‘å…³ä¸€æ ·æœ‰æœ€å¤šæ‰§è¡Œä¸€ä¸ªåˆ†æ”¯çš„é™åˆ¶ã€‚åŒ…å«ç½‘å…³å¯ä»¥åƒå¹¶è¡Œç½‘å…³ä¸€æ ·èšåˆåˆ†æ”¯ã€å¼€å¯åç»­åˆ†æ”¯çš„å¹¶å‘ï¼Œè¿˜ä¸ä¼šåƒå¹¶è¡Œç½‘å…³ä¸€æ ·è¦æ±‚å…¨éƒ¨å…¥åº¦éƒ½å¿…é¡»è¢«æ‰§è¡Œ</p></div> <p><strong>BPMNå›¾ç¤ºå¦‚ä¸‹ï¼š</strong></p> <p><a data-fancybox="" title="åŒ…å«ç½‘å…³æ¼”ç¤º" href="../img2/ea543c4264453eeed6c96169c83655ec.png"><img src="/assets/img/ea543c4264453eeed6c96169c83655ec.e674e8af.png" alt="ea543c4264453eeed6c96169c83655ec"></a></p> <blockquote><p><strong>ä»£ç æ–¹å¼å®šä¹‰ä¸Šè¿°æµç¨‹ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">testInclusiveGatewayDemoProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">testInclusiveGatewayDemoProcess</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">InclusiveJoinPoint</span> inclusiveJoinPoint <span class="token operator">=</span> processLink<span class="token punctuation">.</span><span class="token function">nextInclusive</span><span class="token punctuation">(</span>processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
            inclusiveJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'+'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">plusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            inclusiveJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'*'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">multiplyCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            inclusiveJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'-'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">minusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></blockquote> <p><strong>æµ‹è¯•æ‰§è¡Œï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInclusiveGatewayDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// var åŸŸåˆå§‹åŒ–æ•°æ®</span>
    <span class="token class-name">InScopeData</span> varScopeData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InScopeData</span><span class="token punctuation">(</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ„é€ request</span>
    <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span><span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span>varScopeData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startId</span><span class="token punctuation">(</span><span class="token string">&quot;start-event-inclusive-gateway-demo&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ‰§è¡Œ -</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>factor<span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ‰§è¡Œ +</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>factor<span class="token punctuation">,</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ‰§è¡Œ *</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>factor<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>Â Â Â Â ğŸŸ¢ åŒ…å«ç½‘å…³ä¸å¹¶è¡Œç½‘å…³ä¸€æ ·ï¼Œæ”¯æŒå¼€å¯å¼‚æ­¥æµç¨‹ï¼Œæ”¯æŒæ¥æ”¶å¤šä¸ªå…¥åº¦</p> <p>Â Â Â Â ğŸŸ¢ åŒ…å«ç½‘å…³æ²¡æœ‰æ‰€æœ‰å…¥åº¦å¿…é¡»è¢«æ‰§è¡Œçš„é™åˆ¶ï¼Œç­‰å¾…å…¨éƒ¨å…¥åº¦æ‰§è¡Œå®Œæˆæˆ–è€…å¾—çŸ¥å…¶ä¸­å¯èƒ½æœ‰éƒ¨åˆ†å…¥åº¦ä¸æ»¡è¶³æ¡ä»¶ä¸å†æ‰§è¡Œåï¼Œä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ</p> <p>Â Â Â Â ğŸŸ¢ åŒ…å«ç½‘å…³åé¢å‡ºåº¦å¯ä»¥è®¾ç½®æ¡ä»¶è¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼è§£æè§„åˆ™ä¸æ’ä»–ç½‘å…³å‡ºåº¦è§£æè§„åˆ™ç›¸åŒï¼Œä½†æ²¡æœ‰æœ€å¤šæ‰§è¡Œä¸€ä¸ªåˆ†æ”¯çš„é™åˆ¶ï¼Œåªè¦å‡ºåº¦ä¸Šçš„è¡¨è¾¾å¼è§£æä¸ºtrueéƒ½ä¼šè¢«æ‰§è¡Œ</p> <p>Â Â Â Â ğŸŸ¢ å¦‚æœéœ€è¦æŒ‡å®šåŒ…å«ç½‘å…³å‰é¢å…¥åº¦ä»»åŠ¡å®Œæˆå‡ ä¸ªä¾¿å¯ç»§ç»­å‘ä¸‹æ‰§è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>completed-count</code>å±æ€§</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <code>completed-count</code>è®¾ç½®æ—¶è¦æ±‚å¿…é¡»å°äºç­‰äºåŒ…å«ç½‘å…³å…¥åº¦æ•°é‡ï¼Œå¦åˆ™å¯åŠ¨æ—¶æŠ¥é”™ï¼š<code>[K1030005] completed-count cannot be greater than comingList size!</code></p> <p>Â Â Â Â Â Â Â Â ğŸ”· å‡è®¾ä¸€ä¸ªåŒ…å«ç½‘å…³å…¥åº¦æ˜¯3ï¼Œ<code>completed-count</code>æŒ‡å®š2ï¼Œæ‰§è¡Œæ—¶å½“ç½‘å…³å‰é¢æœ‰ä¸¤ä¸ªå…¥åº¦å®Œæˆæ—¶ä¾¿å¯ä»¥ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚å¦‚æœæœ€ç»ˆåªæœ‰1ä¸ªå…¥åº¦èƒ½å®Œæˆåˆ™ä¼šæŠ›å‡º<code>[K1040008] The actual completed flow does not meet the requirements of completedCount!</code>å¼‚å¸¸ç»“æŸæµç¨‹</p> <p>Â Â Â Â Â Â Â Â ğŸ”· æœªæŒ‡å®š<code>completed-count</code>å±æ€§æ—¶ï¼Œé»˜è®¤æ˜¯ç­‰å¾…å…¨éƒ¨å…¥åº¦åé¦ˆåˆ°è¾¾æˆ–ä¸èƒ½åˆ°è¾¾ä¿¡å·æ‰ä¼šç»§ç»­æµç¨‹ï¼Œå¦‚æœæœ€ç»ˆæ²¡æœ‰ä¸€ä¸ªå…¥åº¦åˆ°è¾¾ç½‘å…³æµç¨‹ä¹Ÿä¼šè¢«å¼‚å¸¸ç»ˆæ­¢</p> <p>Â Â Â Â ğŸŸ¢ åŒ…å«ç½‘å…³æ”¯æŒå®šä¹‰<code>midway-start-id</code>å±æ€§æ¥æŒ‡å®šä¸­é€”å¼€å§‹èŠ‚ç‚¹IDï¼Œç»“åˆrequestä¸­ä¼ å…¥çš„<code>midwayStartId</code>å±æ€§å€¼<strong>å¯ä»¥ä½¿æµç¨‹ä»ä¸­é—´èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œ</strong></p> <p><a data-fancybox="" title="æŒ‡å®šmidway-start-idå±æ€§" href="../img2/d69c55115d24c536a59abdbb89465715.png"><img src="/assets/img/d69c55115d24c536a59abdbb89465715.57592784.png" alt="d69c55115d24c536a59abdbb89465715"></a></p> <p>è°ƒç”¨æ—¶æ—¶æŒ‡å®š<code>midwayStartId</code>å±æ€§ï¼Œè®©ä¸Šè¿°æµç¨‹ä»åŒ…å«ç½‘å…³å¼€å§‹æ‰§è¡Œ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInclusiveMidwayStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// var åŸŸåˆå§‹åŒ–æ•°æ®</span>
    <span class="token class-name">InScopeData</span> varScopeData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InScopeData</span><span class="token punctuation">(</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ„é€ request</span>
    <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span><span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">midwayStartId</span><span class="token punctuation">(</span><span class="token string">&quot;9a350816bf823d30e5ca2865dd3a147f&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>ALL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span>varScopeData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startId</span><span class="token punctuation">(</span><span class="token string">&quot;start-event-inclusive-gateway-demo&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ‰§è¡Œ -</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>factor<span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Â Â Â Â Â Â Â Â ğŸ”· å­æµç¨‹ä¸­çš„åŒ…å«ç½‘å…³ä¸èƒ½å®šä¹‰<code>midway-start-id</code>å±æ€§ï¼Œå³åªæœ‰ä¸»æµç¨‹ä¸­æ‰èƒ½ä»ä¸­é—´èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œ</p> <p>Â Â Â Â Â Â Â Â ğŸ”· å¦‚æœrequestä¸­æŒ‡å®šäº†<code>midwayStartId</code>ä½†åœ¨å®é™…æ‰§è¡Œæ—¶å´æ²¡æœ‰æ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ä¼šæŠ¥é”™ï¼ŒæœªæŒ‡å®š<code>midwayStartId</code>æ—¶é»˜è®¤ä»startEventå¼€å§‹æ‰§è¡Œ</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <strong>ä¸€å®šéœ€è¦æ³¨æ„ï¼ï¼ï¼æŒ‡å®š<code>midwayStartId</code>å±æ€§ä»æµç¨‹ä¸­é—´å¼€å§‹æ‰§è¡Œçš„åŒ…å«ç½‘å…³åé¢å‡ºç°çš„æ‰€æœ‰åŒ…å«ç½‘å…³ã€å¹¶è¡Œç½‘å…³ã€æ’ä»–ç½‘å…³å‰é¢çš„å…¥åº¦è¦ä¿è¯ç»è¿‡æ­¤åŒ…å«ç½‘å…³éƒ½æ˜¯å¯è¾¾çš„ï¼Œä¸ç„¶ä¼šå‡ºç°å› ä¸ºç­‰å¾…æ°¸ä¸å¯è¾¾æµç¨‹å¯¼è‡´è°ƒç”¨è¶…æ—¶çš„é—®é¢˜ï¼ï¼ï¼</strong></p> <p>Â Â Â Â Â Â Â Â ğŸ”· ä¸‹å›¾æ‰€ç¤ºçš„æµç¨‹ä¸­å‡ºç°çš„åŒ…å«ç½‘å…³å°±ä¸èƒ½é…ç½®<code>midway-start-id</code>ã€‚å› ä¸ºä»åŒ…å«ç½‘å…³å¼€å§‹åï¼Œç»“æŸèŠ‚ç‚¹ä¸‹æ–¹çš„å…¥åº¦æ˜¯æ°¸ä¸å¯è¾¾çš„ï¼Œä¼šå‡ºç°ç­‰å¾…è¶…æ—¶å¼‚å¸¸</p> <p><a data-fancybox="" title="é”™è¯¯æµç¨‹" href="../img2/f601e5f121daf90c1cc0105be69b5785.png"><img src="/assets/img/f601e5f121daf90c1cc0105be69b5785.f316228b.png" alt="f601e5f121daf90c1cc0105be69b5785"></a></p> <h2 id="_2-5-å­æµç¨‹"><a href="#_2-5-å­æµç¨‹" class="header-anchor">#</a> 2.5 å­æµç¨‹</h2> <h3 id="_2-5-1-å­æµç¨‹ä½¿ç”¨"><a href="#_2-5-1-å­æµç¨‹ä½¿ç”¨" class="header-anchor">#</a> 2.5.1 å­æµç¨‹ä½¿ç”¨</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>æ¡†æ¶æ”¯æŒå®šä¹‰å­æµç¨‹ã€‚å¯ä»¥ç”¨æ¥è¿›è¡Œå¤æ‚æµç¨‹çš„æ‹†åˆ†ã€é€šç”¨æµç¨‹çš„å¤ç”¨ã€æµç¨‹äº‹åŠ¡ç®¡ç†ç­‰ã€‚å­æµç¨‹å¯ä»¥åšåˆ°é€»è¾‘çš„æŠ½ç¦»ï¼Œä»¥ä¾¿ä¹‹åè¿›è¡Œå•ç‹¬ç»´æŠ¤å‡çº§ã€‚è¿™æ ·ä¹Ÿä½¿åŸæ¥æ¯”è¾ƒå¤æ‚çš„æµç¨‹å›¾å¾—åˆ°äº†ç®€åŒ–ï¼Œç†è§£èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿</p></div> <p><strong>BPMNå›¾ç¤ºå¦‚ä¸‹ï¼š</strong></p> <p><a data-fancybox="" title="å­æµç¨‹æ¼”ç¤º" href="../img2/a5c4cb55480a1209ebe56b9e5de76458.png"><img src="/assets/img/a5c4cb55480a1209ebe56b9e5de76458.c033ba88.png" alt="a5c4cb55480a1209ebe56b9e5de76458"></a></p> <p><strong>æ³¨æ„ï¼å›¾ä¸­<code>SUB_PROCESS_ID_001</code>å…³è”IDï¼Œæ˜¯å­æµç¨‹çš„IDï¼Œä¸æ˜¯å­æµç¨‹ä¸­å¼€å§‹äº‹ä»¶çš„ID</strong></p> <blockquote><p><strong>ä»£ç æ–¹å¼å®šä¹‰ä¸Šè¿°æµç¨‹ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * å®šä¹‰å­æµç¨‹
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SubProcessLink</span> <span class="token function">calculateSubProcessDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">SubProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">calculateSubProcessDemo</span><span class="token punctuation">,</span> link <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">InclusiveJoinPoint</span> inclusiveJoinPoint <span class="token operator">=</span> link<span class="token punctuation">.</span><span class="token function">nextInclusive</span><span class="token punctuation">(</span>link<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        link<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
                inclusiveJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'+'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">plusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                inclusiveJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'*'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">multiplyCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                inclusiveJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'-'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">minusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">testCalculateSubProcessDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">testCalculateSubProcessDemo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink
            <span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">setCalculateNumber</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">params</span><span class="token punctuation">(</span><span class="token string">&quot;{'a': 11, 'b': 6}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">nextSubProcess</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">calculateSubProcessDemo</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¼•ç”¨å­æµç¨‹</span>
            <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></blockquote> <p><strong>æµ‹è¯•æ‰§è¡Œï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSubProcessDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰§è¡Œ *</span>
    <span class="token class-name">InScopeData</span> varScopeData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InScopeData</span><span class="token punctuation">(</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>factor<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ„é€ request</span>
    <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span><span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span>varScopeData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startId</span><span class="token punctuation">(</span><span class="token string">&quot;start-test-event-sub-process-demo&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">TaskResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä»£ç æ–¹å¼å®šä¹‰æµç¨‹</span>
    varScopeData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CommonFields<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>factor<span class="token punctuation">,</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span><span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">varScopeData</span><span class="token punctuation">(</span>varScopeData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startProcess</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">testCalculateSubProcessDemo</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>Â Â Â Â ğŸŸ¢ å­æµç¨‹æœ‰ç‹¬ç«‹äºçˆ¶æµç¨‹ä¹‹å¤–çš„å¼€å§‹äº‹ä»¶ã€ç»“æŸäº‹ä»¶</p> <p>Â Â Â Â ğŸŸ¢ å­æµç¨‹æ˜¯æ”¯æŒåµŒå¥—çš„ï¼ŒAå­æµç¨‹å¯ä»¥ä¾èµ–Bå­æµç¨‹ï¼Œä½†æ˜¯è‡ªèº«ä¾èµ–è‡ªèº«æ˜¯éæ³•çš„</p> <p>Â Â Â Â ğŸŸ¢ å­æµç¨‹ä¸­çš„åŒ…å«ç½‘å…³ã€å¹¶è¡Œç½‘å…³ä¹Ÿæ”¯æŒå¼€å¯å¼‚æ­¥æ¨¡å¼</p> <p>Â Â Â Â ğŸŸ¢ BPMNæ–‡ä»¶ä¸­å®šä¹‰<code>bpmn:callActivity</code>å¼•ç”¨å­æµç¨‹ï¼Œä»£ç å®šä¹‰ä¸­ä½¿ç”¨<code>.nextSubProcess(Xxx).build()</code>å¼•ç”¨å­æµç¨‹ã€‚ç¨‹åºè¿è¡Œåˆ°æ­¤æ—¶ä¼šè·³è½¬è‡³å­æµç¨‹æ‰§è¡Œï¼Œå­æµç¨‹æ‰§è¡Œå®Œæˆåæ‰ä¼šè·³è½¬å›ä¸»æµç¨‹ç»§ç»­æ‰§è¡Œ</p> <h3 id="_2-5-2-å­æµç¨‹æ‹¦æˆªå™¨"><a href="#_2-5-2-å­æµç¨‹æ‹¦æˆªå™¨" class="header-anchor">#</a> 2.5.2 å­æµç¨‹æ‹¦æˆªå™¨</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>ä¸šåŠ¡åŠ¨ä½œå¤ç”¨ã€å¤æ‚ä¸šåŠ¡åŠ¨ä½œæŠ½ç¦»å¹¶å•ç‹¬ç»´æŠ¤ã€ç¬¬ä¸‰æ–¹æä¾›çš„ä¸€äº›æœåŠ¡èƒ½åŠ›ç­‰ï¼Œéƒ½éœ€è¦å®šä¹‰å­æµç¨‹æ¥è¿›è¡Œä¸šåŠ¡é—´éš”ç¦»ã€‚è¢«åˆ’åˆ†å‡ºæ¥çš„å­æµç¨‹å¯ä»¥è¢«çœ‹ä½œä¸€ä¸ªæ•´ä½“è¢«å•ç‹¬ç»´æŠ¤ã€‚æ¡†æ¶æä¾›äº†å®šä¹‰å­æµç¨‹æ‹¦æˆªå™¨çš„èƒ½åŠ›ï¼Œå¯ä»¥åœ¨å­æµç¨‹æ‰§è¡Œå‰ã€æ‰§è¡Œåã€å‡ºç°å¼‚å¸¸ï¼ˆé“¾è·¯ä¸­å‡ºç°å¼‚å¸¸æˆ–è€…è¶…æ—¶ï¼‰æ—¶è‡ªå®šä¹‰æ“ä½œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å®šä¹‰æ— è®ºæ˜¯å¦å‡ºç°å¼‚å¸¸éƒ½ä¸€å®šä¼šæ‰§è¡Œçš„æœ€ç»ˆé€šçŸ¥</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StatisticsInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">SubProcessInterceptor</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * å­æµç¨‹æ‹¦æˆªå™¨çš„åˆ‡å…¥ç‚¹
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">pointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Sets</span><span class="token punctuation">.</span><span class="token function">newHashSet</span><span class="token punctuation">(</span><span class="token string">&quot;Event_1h3q9xl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Event_08xh60r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡ŒæŒ‡å®šçš„æ˜¯å­æµç¨‹ä¸­çš„å¼€å§‹äº‹ä»¶ID</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">beforeProcessor</span><span class="token punctuation">(</span><span class="token class-name">ScopeDataOperator</span> dataOperator<span class="token punctuation">,</span> <span class="token class-name">Role</span> role<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¼€å§‹ç»Ÿè®¡</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹ç»Ÿè®¡...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterProcessor</span><span class="token punctuation">(</span><span class="token class-name">ScopeDataOperator</span> dataOperator<span class="token punctuation">,</span> <span class="token class-name">Role</span> role<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç»Ÿè®¡ç»“æŸ</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ç»Ÿè®¡ç»“æŸ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">errorProcessor</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> exception<span class="token punctuation">,</span> <span class="token class-name">ScopeDataOperator</span> dataOperator<span class="token punctuation">,</span> <span class="token class-name">Role</span> role<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç»Ÿè®¡å¼‚å¸¸</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ç»Ÿè®¡å¼‚å¸¸...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finallyProcessor</span><span class="token punctuation">(</span><span class="token class-name">ScopeDataOperator</span> dataOperator<span class="token punctuation">,</span> <span class="token class-name">Role</span> role<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å…œåº•é€»è¾‘</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å…œåº•é€»è¾‘...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>Â Â Â Â ğŸŸ¢ å®šä¹‰å®ç°<code>SubProcessInterceptor</code>æ¥å£çš„å­æµç¨‹æ‹¦æˆªå™¨ï¼Œå¹¶äº¤ç»™Springå®¹å™¨ç®¡ç†ï¼Œæ‹¦æˆªå™¨å³å¯ç”Ÿæ•ˆ</p> <p>Â Â Â Â ğŸŸ¢ <code>pointcut()</code> æ–¹æ³•éœ€è¦è¢«å®ç°ï¼Œè¿”å›å­æµç¨‹ä¸­å¼€å§‹äº‹ä»¶IDçš„Seté›†åˆï¼Œä»¥æ­¤å‘ŠçŸ¥æ¡†æ¶å“ªäº›å­æµç¨‹éœ€è¦è¢«æ‹¦æˆªå™¨å¤„ç†</p> <p>Â Â Â Â ğŸŸ¢ ä¸åŒæµç¨‹å…±åŒå¼•ç”¨ä¸€ä¸ªå­æµç¨‹æ—¶ï¼Œæ‹¦æˆªå™¨å¦‚æœè¦åŒºåˆ†ä¸åŒçš„ä¸»æµç¨‹ <code>pointcut()</code> æ–¹æ³•å°±æ— æ³•æ”¯æŒäº†ã€‚æ­¤æ—¶éœ€è¦å®ç°<code>getSubProcessIdentity()</code>æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ª<code>SubProcessIdentity</code>å¯¹è±¡çš„Seté›†åˆã€‚æ¡†æ¶ç”¨<code>SubProcessIdentity</code>å¯¹è±¡é›†åˆæ¥åˆ¤æ–­å½“å‰æ‹¦æˆªå™¨æ˜¯å¦ç”Ÿæ•ˆã€‚<code>SubProcessIdentity</code>æœ‰ä¸¤ç§æ„é€ å‚æ•°ï¼š</p> <p>Â Â Â Â Â Â Â Â ğŸ”· ä¼ å…¥å­æµç¨‹çš„<code>startEventId</code>ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­æ‹¦æˆªå™¨å®šä¹‰çš„<code>startEventId</code>ä¸å­æµç¨‹çš„<code>startEventId</code>ç›¸åŒæ—¶å½“å‰æ‹¦æˆªå™¨ç”Ÿæ•ˆ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">SubProcessIdentity</span><span class="token punctuation">(</span><span class="token class-name">String</span> startEventId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>startEventId<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Â Â Â Â Â Â Â Â ğŸ”· ä¼ å…¥å­æµç¨‹çš„<code>startEventId</code>å’Œ<code>storyId</code>ï¼ˆæœ€å¤–å±‚æµç¨‹ä¸­çš„<code>startEventId</code>ï¼‰ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­<code>startEventId</code>å’Œ<code>storyId</code>éƒ½åŒ¹é…æˆåŠŸæ—¶å½“å‰æ‹¦æˆªå™¨ç”Ÿæ•ˆ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">SubProcessIdentity</span><span class="token punctuation">(</span><span class="token class-name">String</span> startEventId<span class="token punctuation">,</span> <span class="token class-name">String</span> storyId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">TaskServiceUtil</span><span class="token punctuation">.</span><span class="token function">joinName</span><span class="token punctuation">(</span>startEventId<span class="token punctuation">,</span> storyId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">IdentityTypeEnum</span><span class="token punctuation">.</span>SUB_PROCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Â Â Â Â ğŸŸ¢ <code>beforeProcessor</code>æ˜¯å­æµç¨‹çš„å‰ç½®é€šçŸ¥æ–¹æ³•ï¼Œæ‹¦æˆªå™¨åŒ¹é…æˆåŠŸåï¼Œè¿›å…¥å­æµç¨‹ä¹‹å‰è¢«æ‰§è¡Œã€‚ç”¨æ¥å®ç°ä¸€äº›å­æµç¨‹æ‰§è¡Œä¹‹å‰çš„ä¸šåŠ¡åŠ¨ä½œã€‚å®ƒè¿”å›ä¸€ä¸ªbooleanå˜é‡ã€‚trueä»£è¡¨è¿›å…¥å­æµç¨‹ï¼Œfasleä»£è¡¨è·³è¿‡å­æµç¨‹ç»§ç»­æ‰§è¡Œä¸‹ä¸€èŠ‚ç‚¹</p> <p>Â Â Â Â ğŸŸ¢ <code>afterProcessor</code>æ˜¯å­æµç¨‹çš„åç½®é€šçŸ¥ï¼Œæ‹¦æˆªå™¨åŒ¹é…æˆåŠŸï¼Œå­æµç¨‹æ‰§è¡Œå®Œæˆä¹‹åä¼šæ‰§è¡Œå…¶ä¸­å®šä¹‰çš„ä¸šåŠ¡åŠ¨ä½œ</p> <p>Â Â Â Â ğŸŸ¢ <code>errorProcessor</code>æ˜¯å­æµç¨‹çš„å¼‚å¸¸é€šçŸ¥ï¼Œæ‹¦æˆªå™¨åŒ¹é…æˆåŠŸåï¼Œå­æµç¨‹æ‰§è¡Œä¸­å‡ºç°å¼‚å¸¸æˆ–è¶…æ—¶æ—¶ä¼šæ‰§è¡Œå…¶ä¸­å®šä¹‰çš„ä¸šåŠ¡åŠ¨ä½œ</p> <p>Â Â Â Â ğŸŸ¢ <code>finallyProcessor</code>æ˜¯å­æµç¨‹çš„æœ€ç»ˆé€šçŸ¥ï¼Œæ‹¦æˆªå™¨åŒ¹é…æˆåŠŸåï¼Œæ— è®ºå­æµç¨‹æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œåªè¦è¿›å…¥äº†å­æµç¨‹æœ€ç»ˆä¸€å®šä¼šæ‰§è¡Œå…¶ä¸­å®šä¹‰çš„ä¸šåŠ¡åŠ¨ä½œ</p> <p>Â Â Â Â ğŸŸ¢ <code>getOrder()</code>å¯ä»¥æ§åˆ¶å¤šä¸ªæ‹¦æˆªå™¨ç”Ÿæ•ˆçš„å‰åé¡ºåºã€‚ä¸Springä¸­çš„Orderç›¸åŒï¼Œè¿”å›çš„å˜é‡å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚æ²¡æœ‰å¤å†™è¯¥æ–¹æ³•æ—¶é»˜è®¤è¿”å›1000</p> <h3 id="_2-5-3-å­æµç¨‹æ§åˆ¶"><a href="#_2-5-3-å­æµç¨‹æ§åˆ¶" class="header-anchor">#</a> 2.5.3 å­æµç¨‹æ§åˆ¶</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>å¹¶éæ‰€æœ‰å­æµç¨‹éƒ½æ˜¯ä¸šåŠ¡çš„æ ¸å¿ƒé€»è¾‘ï¼Œä¹Ÿå¹¶éæ‰€æœ‰å­æµç¨‹æ‰§è¡Œæ—¶é—´éƒ½ä¸çˆ¶æµç¨‹ç›¸åŒã€‚æ‰€ä»¥æ¡†æ¶æä¾›äº†ç»™å­æµç¨‹è®¾ç½®ä¸¥æ ¼æ¨¡å¼å’Œè¶…æ—¶æ—¶é—´çš„å…¥å£</p></div> <p><a data-fancybox="" title="å­æµç¨‹å‚æ•°è®¾ç½®" href="../img2/82fd682de5086dc5a85165bad37d51b4.png"><img src="/assets/img/82fd682de5086dc5a85165bad37d51b4.84a72d9a.png" alt="82fd682de5086dc5a85165bad37d51b4"></a></p> <p>Â Â Â Â ğŸŸ¢ <code>timeout</code>ä»¥msä¸ºå•ä½ã€‚å½“<code>timeout</code>å­˜åœ¨ä¸”å¤§äºç­‰äº0æ—¶ï¼Œå³å¯æ§åˆ¶å…è®¸å­æµç¨‹æ‰§è¡Œçš„æœ€å¤§è¶…æ—¶æ—¶é—´ã€‚è¾¾åˆ°æœ€å¤§è¶…æ—¶æ—¶é—´ä¹‹åï¼Œå¦‚æœå­æµç¨‹è¿˜æœªç»“æŸå°±ä¼šæŠ›å‡ºè¶…æ—¶å¼‚å¸¸</p> <p>Â Â Â Â ğŸŸ¢ <code>strict-mode</code>æœªè¢«æ˜¾ç¤ºè®¾ç½®æ—¶é»˜è®¤ä¸ºtrueï¼Œå­æµç¨‹å‡ºç°å¼‚å¸¸æˆ–æ‰§è¡Œè¶…æ—¶æ—¶ä¼šç»“æŸæ•´ä¸ªæµç¨‹ã€‚<code>strict-mode</code>è¢«è®¾ç½®æˆfalseåï¼Œå¦‚æœå­æµç¨‹å‡ºç°å¼‚å¸¸æˆ–æ‰§è¡Œè¶…æ—¶ï¼Œå¼‚å¸¸å°†ä¼šè¢«å¿½ç•¥ï¼Œå½“å‰å­æµç¨‹å’Œæ‰€å±å½“å‰å­æµç¨‹çš„å­æµç¨‹å°†ä¼šè¢«ä¸­æ–­ã€‚ä¹‹åç»§ç»­æ‰§è¡Œå­æµç¨‹åé¢çš„æœåŠ¡èŠ‚ç‚¹</p> <h2 id="_2-6-èŠ‚ç‚¹æ§åˆ¶"><a href="#_2-6-èŠ‚ç‚¹æ§åˆ¶" class="header-anchor">#</a> 2.6 èŠ‚ç‚¹æ§åˆ¶</h2> <h3 id="_2-6-1-å…è®¸æœåŠ¡ä¸ºç©º"><a href="#_2-6-1-å…è®¸æœåŠ¡ä¸ºç©º" class="header-anchor">#</a> 2.6.1 å…è®¸æœåŠ¡ä¸ºç©º</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>é»˜è®¤æƒ…å†µä¸‹åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œç¨‹åºä¸­å¿…é¡»è¦æœ‰ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹æ–¹æ³•ä¸ä¹‹ç›¸å¯¹åº”ï¼Œå¦åˆ™å®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚è¿™ä¸ªé™åˆ¶å¯ä»¥é€šè¿‡æœåŠ¡èŠ‚ç‚¹é…ç½®æ¥ç»•è¿‡</p></div> <p>åœ¨ç¨‹åºä¸­ç¼ºå¤±ä¸æœåŠ¡èŠ‚ç‚¹ç›¸å¯¹åº”çš„æ–¹æ³•æ—¶ï¼Œä¼šå‡ºç°ä¸¤ç§æƒ…å†µçš„æŠ¥é”™ï¼š</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// æŠ¥é”™ä¸€</span>
<span class="token punctuation">[</span>K1040004<span class="token punctuation">]</span> No available TaskService matched! service task identity<span class="token operator">:</span> SERVICE_TASK<span class="token operator">:</span><span class="token punctuation">[</span>id<span class="token operator">:</span> Activity_0ph90s5<span class="token punctuation">,</span> name<span class="token operator">:</span> å‡æ³•è®¡ç®—<span class="token punctuation">,</span> component<span class="token operator">:</span> calculateService<span class="token punctuation">,</span> service<span class="token operator">:</span> minusCalculate2<span class="token punctuation">]</span>

<span class="token comment">// æŠ¥é”™äºŒ</span>
<span class="token punctuation">[</span>K1030002<span class="token punctuation">]</span> TaskComponent cannot be empty! identity<span class="token operator">:</span> SERVICE_TASK<span class="token operator">:</span><span class="token punctuation">[</span>id<span class="token operator">:</span> Activity_0ph90s5<span class="token punctuation">,</span> name<span class="token operator">:</span> å‡æ³•è®¡ç®—<span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span> service<span class="token operator">:</span> minusCalculate2<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Â Â Â Â ğŸŸ¢ æœåŠ¡èŠ‚ç‚¹åœ¨åŒæ—¶å®šä¹‰äº†<code>task-component</code>å’Œ<code>task-service</code>ä¸¤ä¸ªå±æ€§æ—¶ï¼Œå¦‚æœåœ¨ç¨‹åºä¸­æ²¡æœ‰ä¸ä¹‹ç›¸å¯¹åº”çš„æœåŠ¡èŠ‚ç‚¹æ–¹æ³•ï¼Œå¯åŠ¨æ—¶ä¼šå‡ºç°æŠ¥é”™ä¸€</p> <p>Â Â Â Â ğŸŸ¢ å¦‚æœæœåŠ¡èŠ‚ç‚¹åªå®šä¹‰äº†<code>task-service</code>ä¸€ä¸ªå±æ€§çš„è¯ï¼Œå¦‚æœæ²¡æœ‰ä¸ä¹‹ç›¸å¯¹åº”çš„æœåŠ¡èŠ‚ç‚¹æ–¹æ³•ï¼Œå¯åŠ¨æ—¶ä¼šå‡ºç°æŠ¥é”™äºŒ</p> <p>Â Â Â Â å¯é€šè¿‡èŠ‚ç‚¹è®¾ç½®ï¼š<code>allow-absent=true</code>ï¼Œæ¥è§£å†³ä¸Šé¢çš„é—®é¢˜ã€‚è¯¥å±æ€§è¡¨ç¤ºï¼šå…è®¸æœåŠ¡èŠ‚ç‚¹åœ¨ç¨‹åºä¸­æ‰¾ä¸åˆ°ä¸ä¹‹å¯¹åº”çš„æœåŠ¡èŠ‚ç‚¹æ–¹æ³•ã€‚æ‰¾ä¸åˆ°æ—¶ä¸ä¼šæŠ¥é”™ï¼Œä¼šè·³è¿‡ç»§ç»­æ‰§è¡Œ</p> <p><a data-fancybox="" title="æœåŠ¡èŠ‚ç‚¹æ–¹æ³•å…è®¸ä¸ºç©º" href="../img2/880956347ce40f4e7072307b1b54068b.png"><img src="/assets/img/880956347ce40f4e7072307b1b54068b.5830096f.png" alt="880956347ce40f4e7072307b1b54068b"></a></p> <h3 id="_2-6-2-è®¾ç½®è¶…æ—¶æ—¶é—´"><a href="#_2-6-2-è®¾ç½®è¶…æ—¶æ—¶é—´" class="header-anchor">#</a> 2.6.2 è®¾ç½®è¶…æ—¶æ—¶é—´</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>æ¡†æ¶å…è®¸é€šè¿‡è®¾ç½®æœåŠ¡èŠ‚ç‚¹çš„è¶…æ—¶æ—¶é—´å‚æ•°ï¼Œæ¥è§„å®šå½“å‰æœåŠ¡èŠ‚ç‚¹æ–¹æ³•è¢«å…è®¸æ‰§è¡Œçš„æœ€å¤§æ—¶é•¿</p></div> <p><a data-fancybox="" title="è®¾ç½®è¶…æ—¶æ—¶é—´" href="../img2/2e32af28c0ea97b98d0147154cc6d034.png"><img src="/assets/img/2e32af28c0ea97b98d0147154cc6d034.d475fc7b.png" alt="2e32af28c0ea97b98d0147154cc6d034"></a></p> <p>Â Â Â Â ğŸŸ¢ è¶…æ—¶æ—¶é—´çš„å•ä½æ˜¯msï¼Œé»˜è®¤å€¼-1ä»£è¡¨ä¸è®¾ç½®è¶…æ—¶æ—¶é—´</p> <p>Â Â Â Â ğŸŸ¢ é™¤é…ç½®æ–‡ä»¶å¤–è¿˜å¯ä»¥é€šè¿‡ç¼–ç çš„æ–¹å¼å®šä¹‰èŠ‚ç‚¹æ–¹æ³•çš„è¶…æ—¶æ—¶é—´<code>@TaskService(invoke = @Invoke(timeout = 1000))</code></p> <p>Â Â Â Â ğŸŸ¢ é…ç½®æ–‡ä»¶ã€ä»£ç ä¸­åŒæ—¶æŒ‡å®šè¶…æ—¶æ—¶é—´å±æ€§æ—¶ï¼Œå·²é…ç½®æ–‡ä»¶ä¸­çš„æ—¶é—´ä¸ºå‡†ï¼Œä»£ç å®šä¹‰çš„å€¼å°†ä¼šè¢«å¿½ç•¥</p> <h3 id="_2-6-3-èŠ‚ç‚¹å¼‚å¸¸é‡è¯•"><a href="#_2-6-3-èŠ‚ç‚¹å¼‚å¸¸é‡è¯•" class="header-anchor">#</a> 2.6.3 èŠ‚ç‚¹å¼‚å¸¸é‡è¯•</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>æœåŠ¡èŠ‚ç‚¹æ–¹æ³•æ‰§è¡Œå¼‚å¸¸æˆ–è€…è¶…æ—¶åï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šå¼‚å¸¸é‡è¯•æ¬¡æ•°æ¥é‡æ–°æ‰§è¡Œç›®æ ‡æ–¹æ³•</p></div> <p><a data-fancybox="" title="èŠ‚ç‚¹å¼‚å¸¸é‡è¯•" href="../img2/472b5c036e2397c14eb32686203ebbf9.png"><img src="/assets/img/472b5c036e2397c14eb32686203ebbf9.d0b1b79b.png" alt="472b5c036e2397c14eb32686203ebbf9"></a></p> <p>Â Â Â Â ğŸŸ¢ æœåŠ¡èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥æ—¶é»˜è®¤é‡è¯•æ¬¡æ•°ä¸º0ä»£è¡¨ä¸é‡è¯•ã€‚å‡è®¾å½“é‡è¯•æ¬¡æ•°è¢«è®¾ç½®æˆ2æ—¶ï¼Œä»£è¡¨å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œå°†è¿›è¡Œ2æ¬¡é‡è¯•ã€‚æœ€å¤§æ‰§è¡Œæ¬¡æ•°æ˜¯3æ¬¡</p> <p>Â Â Â Â ğŸŸ¢ é™¤é…ç½®æ–‡ä»¶å¤–è¿˜å¯ä»¥é€šè¿‡ç¼–ç çš„æ–¹å¼å®šä¹‰èŠ‚ç‚¹æ–¹æ³•çš„å¼‚å¸¸é‡è¯•<code>@TaskService(invoke = @Invoke(retry = 2))</code></p> <p>Â Â Â Â ğŸŸ¢ æµç¨‹é…ç½®ä¸­ä¹Ÿå¯æŒ‡å®šæœåŠ¡èŠ‚ç‚¹å¤±è´¥é‡è¯•æ¬¡æ•°å±æ€§ï¼Œæµç¨‹é…ç½®æŒ‡å®šåï¼Œæ³¨è§£æ–¹å¼å°†ä¼šå¤±æ•ˆ</p> <p>Â Â Â Â ğŸŸ¢ è¶…æ—¶æ—¶é—´ã€é‡è¯•æ¬¡æ•°ä¸¤ä¸ªå±æ€§ä¸€èµ·ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ä¸€ä¸‹ä¸¤è€…å åŠ èµ·æ¥çš„æ—¶é—´æ˜¯å¦åœ¨å…è®¸çš„èŒƒå›´å†…</p> <p>Â Â Â Â ğŸŸ¢ <code>@Invoke</code>æ³¨è§£ä¸­é™¤äº†<code>retry</code>è¿™ä¸ªå±æ€§å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªå±æ€§æ˜¯å’Œé‡è¯•æ¬¡æ•°è”ç”¨çš„</p> <p>Â Â Â Â Â Â Â Â ğŸ”·  <code>retryIncludeExp</code>ï¼šæŠ›å‡ºå¼‚å¸¸åŒ…å«æŒ‡å®šå¼‚å¸¸æ—¶ï¼Œè¿›è¡Œé‡è¯•ã€‚é»˜è®¤æƒ…å†µä¸‹åˆ—è¡¨ä¸ºç©ºï¼Œä»»ä½•å¼‚å¸¸éƒ½å°†é‡è¯•</p> <p>Â Â Â Â Â Â Â Â ğŸ”·  <code>retryExcludeExp</code>ï¼šæŠ›å‡ºå¼‚å¸¸ä¸åŒ…å«æŒ‡å®šå¼‚å¸¸æ—¶ï¼Œè¿›è¡Œé‡è¯•ã€‚é»˜è®¤æƒ…å†µä¸‹åˆ—è¡¨ä¸ºç©ºï¼Œä»»ä½•å¼‚å¸¸éƒ½å°†é‡è¯•</p> <h3 id="_2-6-4-èŠ‚ç‚¹å¼‚å¸¸é™çº§"><a href="#_2-6-4-èŠ‚ç‚¹å¼‚å¸¸é™çº§" class="header-anchor">#</a> 2.6.4 èŠ‚ç‚¹å¼‚å¸¸é™çº§</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>æœåŠ¡èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥æˆ–è¶…æ—¶åï¼Œå¹¶ä¸”æœªè®¾ç½®é‡è¯•æ¬¡æ•°æˆ–è€…é‡è¯•ä¹Ÿå¤±è´¥æ—¶ã€‚å¦‚æœè®¾ç½®äº†é™çº§æ–¹æ³•ï¼Œæ­¤æ—¶é™çº§æ–¹æ³•å°†ä¼šè¢«æ‰§è¡Œ</p></div> <p><strong>å®šä¹‰æœåŠ¡èŠ‚ç‚¹æ–¹æ³•å’Œé™çº§æ–¹æ³•</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@NoticeResult</span>
<span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>invoke <span class="token operator">=</span> <span class="token annotation punctuation">@Invoke</span><span class="token punctuation">(</span>retry <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> demotion <span class="token operator">=</span> <span class="token string">&quot;pr:calculateService@calculateErrorDemotion&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">calculateError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * å®šä¹‰é™çº§æ–¹æ³•
 */</span>
<span class="token annotation punctuation">@TaskService</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">calculateErrorDemotion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>å®šä¹‰æµç¨‹</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">testCalculateErrorDemotionProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">testCalculateErrorDemotionProcess</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    processLink<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">calculateError</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>æµ‹è¯•æ‰§è¡Œ</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCalculateErrorDemotion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ„é€ request</span>
    <span class="token class-name">StoryRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> fireRequest <span class="token operator">=</span> <span class="token class-name">ReqBuilder</span><span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">trackingType</span><span class="token punctuation">(</span><span class="token class-name">TrackingTypeEnum</span><span class="token punctuation">.</span>SERVICE_DETAIL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startProcess</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">testCalculateErrorDemotionProcess</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> storyEngine<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>fireRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Â Â Â Â  å®ä¾‹ä¸­é€šè¿‡<code>demotion = &quot;pr:calculateService@calculateErrorDemotion&quot;</code>æŒ‡å®šæœåŠ¡èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥æˆ–è¶…æ—¶åçš„é™çº§æ–¹æ³•ã€‚å¼‚å¸¸å‘ç”Ÿåä¼šæ ¹æ®è¡¨è¾¾å¼ä»å®¹å™¨ä¸­æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡èŠ‚ç‚¹æ‰§è¡Œã€‚å¦‚æœdemotioné…ç½®æ ¼å¼æœ‰é—®é¢˜ï¼Œæˆ–è€…é™çº§ä½¿ç”¨çš„æœåŠ¡èŠ‚ç‚¹æ–¹æ³•æœªæ‰¾åˆ°æ—¶é™çº§ç­–ç•¥å°†ä¸ä¼šç”Ÿæ•ˆ</p> <p>Â Â Â Â  é™çº§æ–¹æ³•è¡¨è¾¾å¼æ ¼å¼æ˜¯ï¼š<code>pr:{task-component}@{task-service}</code>æˆ–è€…<code>pr:{task-component}@{task-service}@{ability}</code>ã€‚abilityæ˜¯<code>@TaskService</code>æ³¨è§£çš„å±æ€§ï¼Œç”¨æ¥è¡¨ç¤ºæœåŠ¡èŠ‚ç‚¹çš„å­èƒ½åŠ›ï¼Œåé¢RBACæ¨¡å¼æ—¶ä¼šè¯¦ç»†ä»‹ç»</p> <p><strong>Â Â Â Â  é™çº§è¡¨è¾¾å¼ä¸¾ä¾‹ï¼š</strong></p> <p>Â Â Â Â ğŸŸ¢ <code>pr:risk-control@check-img</code> æœåŠ¡ç»„ä»¶åæ˜¯ <code>risk-control</code> ä¸”èŠ‚ç‚¹æ–¹æ³•åæ˜¯ <code>check-img</code></p> <p>Â Â Â Â ğŸŸ¢ <code>pr:risk-control@check-img@triple</code> æœåŠ¡ç»„ä»¶åæ˜¯ <code>risk-control</code> ä¸”èŠ‚ç‚¹æ–¹æ³•åæ˜¯ <code>check-img</code> ä¸”èƒ½åŠ›ç‚¹åæ˜¯ <code>triple</code></p> <h3 id="_2-6-5-å¿½ç•¥æ‰§è¡Œæ—¶å¼‚å¸¸"><a href="#_2-6-5-å¿½ç•¥æ‰§è¡Œæ—¶å¼‚å¸¸" class="header-anchor">#</a> 2.6.5 å¿½ç•¥æ‰§è¡Œæ—¶å¼‚å¸¸</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡èŠ‚ç‚¹æ–¹æ³•åœ¨æ‰§è¡Œå¤±è´¥æˆ–è€…è¶…æ—¶æ—¶ç¨‹åºä¼šæŠ›å‡ºå¼‚å¸¸ç»“æŸæ•´ä¸ªæµç¨‹ã€‚æ¡†æ¶æä¾›äº†é…ç½®å±æ€§å¯ä»¥å±è”½å½“å‰æœåŠ¡èŠ‚ç‚¹æ–¹æ³•çš„è¿è¡Œæ—¶å¼‚å¸¸ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p></div> <p>Â Â Â Â å¯é€šè¿‡ç»™èŠ‚ç‚¹å¢åŠ ï¼š<code>strict-mode=false</code>å±æ€§ï¼Œæ¥å…³é—­æœåŠ¡èŠ‚ç‚¹çš„ä¸¥æ ¼æ¨¡å¼ï¼ˆå¹¶è¡Œç½‘å…³ä¹Ÿæœ‰ä¸€ä¸ªä¸¥æ ¼æ¨¡å¼ï¼Œè¦åˆ†æ¸…ä¸¤è€…ä½œç”¨çš„ä¸åŒï¼‰ï¼Œè·³è¿‡å¼‚å¸¸ï¼Œè®©æµç¨‹å¾—ä»¥ç»§ç»­å‘ä¸‹æ‰§è¡Œ</p> <p><a data-fancybox="" title="å±è”½è¿è¡Œæ—¶å¼‚å¸¸" href="../img2/a3a350db7669c75358b94c39d4198849.png"><img src="/assets/img/a3a350db7669c75358b94c39d4198849.4b55bd1c.png" alt="a3a350db7669c75358b94c39d4198849"></a></p> <p>Â Â Â Â ğŸŸ¢ é™¤é…ç½®æ–‡ä»¶å¤–è¿˜å¯ä»¥é€šè¿‡ç¼–ç çš„æ–¹å¼å®šä¹‰èŠ‚ç‚¹æ–¹æ³•çš„éä¸¥æ ¼æ¨¡å¼<code>@TaskService(invoke = @Invoke(strictMode = false))</code></p> <p>Â Â Â Â ğŸŸ¢ é…ç½®æ–‡ä»¶ã€ä»£ç ä¸¤è€…åŒæ—¶ä¸ºä¸¥æ ¼æ¨¡å¼æ—¶æ‰ä¼šæ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œæœ‰ä»»ä¸€ä¸ªæ˜¯éä¸¥æ ¼æ¨¡å¼æ—¶ï¼Œä»»åŠ¡å°±æ˜¯éä¸¥æ ¼æ¨¡å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸¤ç§éƒ½æ˜¯ä¸¥æ ¼æ¨¡å¼</p> <h3 id="_2-6-6-å„æœºåˆ¶ç”Ÿæ•ˆé¡ºåº"><a href="#_2-6-6-å„æœºåˆ¶ç”Ÿæ•ˆé¡ºåº" class="header-anchor">#</a> 2.6.6 å„æœºåˆ¶ç”Ÿæ•ˆé¡ºåº</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>ä»¥ä¸Šä»‹ç»äº†å¤šç§èŠ‚ç‚¹æ§åˆ¶çš„æ‰‹æ®µï¼Œè¦æƒ³åˆç†ä½¿ç”¨çš„è¯ï¼Œå°±éœ€è¦äº†è§£å„ä¸ªæœºåˆ¶çš„ç”Ÿæ•ˆé¡ºåºåŠå‰åå…³è”</p></div> <p>Â Â Â Â 1ï¸âƒ£ å¦‚æœé…ç½®äº†å¤§äº-1çš„è¶…æ—¶æ—¶é—´ï¼Œç›®æ ‡æ–¹æ³•è°ƒç”¨ä¼šå­˜åœ¨è¶…æ—¶æ—¶é—´çš„é™åˆ¶ï¼Œç»™å®šæ—¶é—´å†…æœªæˆåŠŸè¿”å›ä¼šæŠ›å‡ºè¶…æ—¶å¼‚å¸¸</p> <p>Â Â Â Â 2ï¸âƒ£ æœåŠ¡èŠ‚ç‚¹æ–¹æ³•åœ¨å‡ºç°è¶…æ—¶å¼‚å¸¸æˆ–æ‰§è¡Œå¼‚å¸¸æ—¶ï¼Œä¼šåˆ¤æ–­æ˜¯å¦è®¾ç½®äº†é‡è¯•æ¬¡æ•°ï¼Œå¦‚æœé‡è¯•æ¬¡æ•°å¤§äº0ï¼Œä¼šè¿›è¡Œç›¸åº”æ¬¡æ•°çš„é‡è¯•æ“ä½œ</p> <p>Â Â Â Â 3ï¸âƒ£ æœªæŒ‡å®šé‡è¯•æ¬¡æ•°æˆ–æŒ‡å®šæ¬¡æ•°çš„é‡è¯•éƒ½å¤±è´¥åï¼Œå¦‚æœæŒ‡å®šäº†é™çº§æ–¹æ³•ï¼Œåˆ™ä¼šåœ¨æ­¤æ—¶è°ƒç”¨é™çº§æ–¹æ³•</p> <p>Â Â Â Â 4ï¸âƒ£ ä»¥ä¸Šè°ƒç”¨å…¨éƒ¨éƒ½å¤±è´¥åï¼Œä¼šåˆ¤æ–­å½“å‰æœåŠ¡èŠ‚ç‚¹æ˜¯å¦ä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œå¦‚æœæ˜¯éä¸¥æ ¼æ¨¡å¼ï¼Œå¼‚å¸¸å°†ä¼šè¢«å¿½ç•¥ï¼Œæµç¨‹ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ</p> <h2 id="_2-7-æµç¨‹éå†"><a href="#_2-7-æµç¨‹éå†" class="header-anchor">#</a> 2.7 æµç¨‹éå†</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>åœ¨æ—¥å¸¸ç ”å‘å·¥ä½œä¸­ï¼Œä¸éš¾é‡åˆ°ä¸€äº›éœ€è¦å¯¹æ•°æ®é›†åˆè¿›è¡Œéå†å¤„ç†çš„å·¥ä½œã€‚æ¯”å¦‚é›†åˆä¸­çš„æ¯é¡¹æ•°æ®ä¾æ¬¡ä½¿ç”¨ç»™å®šçš„è®¡ç®—è§„åˆ™è¿›è¡Œéå†è®¡ç®—ã€‚å†æ¯”å¦‚ç”µå•†åœºæ™¯ä¸­è®¢å•åˆ—è¡¨ã€å•†å“åˆ—è¡¨ã€SKUåˆ—è¡¨ç­‰ï¼Œåœ¨è¿”å›ç»™å‰ç«¯ç•Œé¢æ¸²æŸ“å±•ç¤ºå‰éƒ½éœ€è¦å¯¹åˆ—è¡¨çš„æ¯ä¸€é¡¹è¿›è¡Œç›¸å…³èµ„æºçš„åŠ è½½è®¡ç®—å’Œèµ‹å€¼ã€‚åœ¨ä»¥ä¸Šåœºæ™¯ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªç›¸åŒçš„ç‰¹ç‚¹ï¼Œå°±æ˜¯è™½ç„¶è®¡ç®—è§„åˆ™å¤æ‚ä¸”åœºæ™¯å¤šæ ·ï¼Œä½†æ˜¯ä½œç”¨åˆ°é›†åˆä¸­æ¯é¡¹æ•°æ®çš„è§„åˆ™éƒ½æ˜¯ä¸€è‡´ä¸”ç»Ÿä¸€çš„</p> <p>Kstryæä¾›èƒ½åŠ›ï¼šå¯¹é€‰å®šé›†åˆä¸­çš„æ¯ä¸€é¡¹æ•°æ®åœ¨æœåŠ¡èŠ‚ç‚¹ã€å­æµç¨‹ä¸¤ä¸ªç»´åº¦è¿›è¡ŒæŒ‡å®šè§„åˆ™çš„åŠ å·¥è®¡ç®—</p></div> <h3 id="_2-7-1-éå†å±æ€§é…ç½®"><a href="#_2-7-1-éå†å±æ€§é…ç½®" class="header-anchor">#</a> 2.7.1 éå†å±æ€§é…ç½®</h3> <p><a data-fancybox="" title="è¿­ä»£å±æ€§é…ç½®" href="../img2/07274707655320bb71a6dbbe6821035a.png"><img src="/assets/img/07274707655320bb71a6dbbe6821035a.482fbd57.png" alt="07274707655320bb71a6dbbe6821035a"></a></p> <p><strong><code>ite-source</code>ï¼š</strong> æŒ‡å®šæ•°æ®é›†åˆèµ„æºçš„ä½ç½®ï¼Œæ ¼å¼ä¸ºæ­£å¸¸çš„å–å€¼è¡¨è¾¾å¼ï¼Œå¦‚ï¼š<code>req.numList</code>ã€‚ç”šè‡³è¿˜å¯ä»¥å¯¹é›†åˆä¸­å¯¹è±¡çš„æŸä¸ªå­—æ®µåšéå†ï¼Œæ¯”å¦‚ï¼š<code>$.studyExperienceList[*].classId</code>ï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„æœ€å‰é¢çš„<code>$</code>ä¸€å®šè¦æœ‰ï¼Œå…¶å–å€¼é€»è¾‘å¯ä»¥å‚è€ƒfastjsonçš„<code>JSONPath</code>ä½¿ç”¨</p> <p>Â Â Â Â ğŸŸ¢ åªæœ‰æŒ‡å®šæ­£ç¡®æ ¼å¼çš„<code>ite-source</code>å±æ€§ï¼Œæ‰ä¼šå¼€å¯éå†åŠ¨ä½œ</p> <p>Â Â Â Â ğŸŸ¢ <code>ite-source</code>æŒ‡å®šçš„èµ„æºä¸€å®šæ˜¯å®ç°<code>java.lang.Iterable</code>æ¥å£æˆ–è€…æ•°ç»„æ ¼å¼ï¼Œå¦åˆ™ä¸ä¼šå¼€å¯éå†åŠ¨ä½œ</p> <p>Â Â Â Â ğŸŸ¢ å¦‚æœæŒ‡å®šçš„é›†åˆèµ„æºæœªæ‰¾åˆ°ï¼Œåˆ™å¯¹åº”çš„æœåŠ¡èŠ‚ç‚¹æˆ–è€…å­ä»»åŠ¡å°†ç›´æ¥è·³è¿‡ä¸å†æ‰§è¡Œ</p> <p><strong><code>ite-strategy</code>ï¼š</strong> æŒ‡å®šéå†ç­–ç•¥ï¼Œæœ‰ä¸‰ä¸ªå–å€¼</p> <p>Â Â Â Â ğŸŸ¢ <code>all</code>ï¼šä¸æŒ‡å®šæ—¶çš„é»˜è®¤ç­–ç•¥ï¼Œé›†åˆä¸­å…¨éƒ¨å…ƒç´ åœ¨éå†ä¸­éƒ½éœ€è¦è·å–åˆ°æ­£ç¡®çš„ç»“æœï¼Œåªè¦æœ‰ä¸€ä¸ªä¸æ»¡è¶³ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ˜¯å¦ç»“æŸæµç¨‹å—<code>strict-mode</code>å½±å“ã€‚</p> <p>Â Â Â Â ğŸŸ¢ <code>best</code>ï¼šé›†åˆä¸­å…¨éƒ¨å…ƒç´ è¿›è¡Œéå†ï¼Œå°½é‡å¤šçš„æ‹¿åˆ°æ­£ç¡®ç»“æœï¼Œå¦‚æœæœ‰æ•°æ®é¡¹æ‰§è¡ŒæœŸé—´æŠ›å‡ºå¼‚å¸¸ï¼Œæµç¨‹ä¼šå¿½ç•¥å¼‚å¸¸ä¸ä¼šç»“æŸ</p> <p>Â Â Â Â ğŸŸ¢ <code>any</code>ï¼šé›†åˆä¸­åªè¦æœ‰ä¸€é¡¹æ•°æ®æ‰§è¡ŒæˆåŠŸï¼Œå°±ä¼šç»“æŸéå†è¿‡ç¨‹</p> <p><strong><code>ite-async</code>ï¼š</strong> éå†åŠ¨ä½œæ˜¯å¦å¹¶å‘è¿›è¡Œ</p> <p><strong><code>ite-stride</code>ï¼š</strong> éå†æ­¥é•¿ã€‚ç”¨æ¥æŒ‡å®šæ¯æ¬¡éå†æ—¶ä»é›†åˆæˆ–è€…æ•°ç»„ä¸­æ‹¿å–å¤šå°‘ä¸ªå…ƒç´ ã€‚é»˜è®¤ä¸º1ä»£è¡¨é€ä¸ªéå†ã€‚æœ€åä¸€æ¬¡éå†é›†åˆä¸­æ•°æ®é¡¹æ•°é‡å°äºæ­¥é•¿æ—¶ä¼šå…¨éƒ¨è¿”å›</p> <p><strong><code>ite-align-index</code>ï¼š</strong> è¿­ä»£æ—¶ï¼Œæ˜¯å¦å°†è¿”å›å€¼ã€å…¥å‚ä¸¤é›†åˆä¸­çš„ç´¢å¼•è¿›è¡Œä¸€ä¸€å¯¹åº”ï¼Œæ¯”å¦‚ï¼šå…¥å‚5ä¸ªå…ƒç´ ï¼Œç»è¿‡å¤„ç†åå‡ºå‚æœ‰ä¸‰ä¸ªå…ƒç´ æœ‰å€¼ï¼Œå¦å¤–ä¸¤ä¸ªä¸ºnullã€‚é€‰æ‹©å‡ºå…¥å‚å¯¹é½ï¼Œè¿”å›ç»“æœå°†æ˜¯åŒ…å«æœ‰nullçš„5ä¸ªå…ƒç´ çš„Listï¼Œåä¹‹å°†è¿”å›åŒ…å«æœ‰ä¸‰ä¸ªç»“æœå…ƒç´ çš„Listã€‚é»˜è®¤falseæ„æŒ‡ä¸è¿›è¡Œç´¢å¼•å¯¹é½</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>å®šä¹‰æœåŠ¡èŠ‚ç‚¹æ–¹æ³•æ—¶ï¼Œä»¥ä¸Šå±æ€§å‡å¯ä»¥åœ¨@TaskServiceæ³¨è§£ä¸­æŒ‡å®š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>
    iterator <span class="token operator">=</span> <span class="token annotation punctuation">@Iterator</span><span class="token punctuation">(</span>sourceScope <span class="token operator">=</span> <span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>VARIABLE<span class="token punctuation">,</span> source <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> async <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> strategy <span class="token operator">=</span> <span class="token class-name">IterateStrategyEnum</span><span class="token punctuation">.</span>BEST_SUCCESS<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä»£ç ã€é…ç½®æ–‡ä»¶å‡æŒ‡å®šåŒä¸€å€¼æ—¶ï¼Œä»¥é…ç½®æ–‡ä»¶ä¸­çš„å€¼ä¸ºå‡†</p></div> <h3 id="_2-7-2-éå†æœåŠ¡èŠ‚ç‚¹"><a href="#_2-7-2-éå†æœåŠ¡èŠ‚ç‚¹" class="header-anchor">#</a> 2.7.2 éå†æœåŠ¡èŠ‚ç‚¹</h3> <blockquote><p>å¯¹é›†åˆä¸­çš„ä¸€ç»„æ•°æ®æ±‚å¹³æ–¹</p></blockquote> <p><strong>å®šä¹‰æœåŠ¡èŠ‚ç‚¹æ–¹æ³•</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TaskComponent</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;calculate-service&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalculateService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * æ±‚å¹³æ–¹å†æ”¾å›
     */</span>
    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;batch-square2&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@NoticeScope</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;squareResult&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> scope <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>RESULT<span class="token punctuation">,</span> <span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>STABLE<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">batchSquare2</span><span class="token punctuation">(</span><span class="token class-name">ScopeDataOperator</span> dataOperator<span class="token punctuation">,</span> <span class="token class-name">IterDataItem</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿­ä»£é¡¹å¯ä»¥ä»dataOperatorä¸­å–ï¼Œå¦‚æœæ­¥é•¿&gt;1æ—¶ï¼Œè·å–åˆ°çš„å°†æ˜¯Listç±»å‹</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> iterDataItem <span class="token operator">=</span> dataOperator<span class="token punctuation">.</span><span class="token function">iterDataItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä¹Ÿå¯ä»¥å°†IterDataItemå¯¹è±¡æ”¾åˆ°å…¥å‚ä¸Šï¼Œè¿­ä»£é¡¹ä¼šè‡ªåŠ¨è¢«æ³¨å…¥åˆ°è¿™ä¸ªå¯¹è±¡ä¸­</span>
        <span class="token class-name">AssertUtil</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>iterDataItem<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span>  <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>IterDataItemä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š</p> <p>Â Â Â Â ğŸŸ¢ <code>data</code>ï¼šæ­¥é•¿ä¸º1æ—¶ï¼Œæ‹¿åˆ°è¿­ä»£ä¸­çš„æ¯ä¸€ä¸ªéå†é¡¹</p> <p>Â Â Â Â ğŸŸ¢ <code>dataList</code>ï¼šæ­¥é•¿&gt;1æ—¶ï¼Œæ‹¿åˆ°è¿­ä»£ä¸­çš„æ¯ä¸€ä¸ªéå†é¡¹é›†åˆ</p> <p>Â Â Â Â ğŸŸ¢ <code>batchItem</code>ï¼šæ­¥é•¿æ˜¯å¦ä¸º1ã€‚æ­¥é•¿ä¸º1æ—¶è¿”å›falseï¼Œæ­¥é•¿&gt;1æ—¶è¿”å›true</p> <p>Â Â Â Â ğŸŸ¢ <code>index</code>ï¼šéå†ä¸­çš„æ¯ä¸€é¡¹æ‰€åœ¨åŸæ¥é›†åˆä¸­çš„ä½ç½®ç´¢å¼•ï¼Œä»0å¼€å§‹</p> <p>Â Â Â Â ğŸŸ¢ <code>size</code>ï¼šæœ€ç»ˆéœ€è¦è¿­ä»£çš„æ¬¡æ•°</p> <p>å¦‚æœåœ¨éå†èŠ‚ç‚¹ä¸­è®¾ç½®äº†è¶…æ—¶æ—¶é—´ã€é‡è¯•æ¬¡æ•°ã€é™çº§æ–¹æ³•ç­‰ï¼Œä¼šå¯¹æ¯ä¸€ä¸ªéå†é¡¹ç”Ÿæ•ˆï¼ŒèŠ‚ç‚¹çš„ä¸¥æ ¼æ¨¡å¼å±æ€§å¯¹æ•´ä¸ªéå†åŠ¨ä½œç”Ÿæ•ˆã€‚</p> <div class="custom-block danger"><p class="custom-block-title">æ³¨æ„ï¼š</p> <p>å½“éå†æ­¥é•¿&gt;1æ—¶ï¼ŒæœåŠ¡èŠ‚ç‚¹æ–¹æ³•è¿”å›å€¼éœ€è¦æ˜¯Listç±»å‹</p></div> <h3 id="_2-7-3-éå†å­æµç¨‹èŠ‚ç‚¹"><a href="#_2-7-3-éå†å­æµç¨‹èŠ‚ç‚¹" class="header-anchor">#</a> 2.7.3 éå†å­æµç¨‹èŠ‚ç‚¹</h3> <blockquote><p>å¦‚æœä¸€ä¸ªé›†åˆä¸­çš„æ•°æ®éƒ½éœ€è¦è¿›è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œå¯ä»¥è€ƒè™‘å°†è¿™äº›æ“ä½œå®šä¹‰æˆå­æµç¨‹ï¼Œç„¶åæŒ‡å®šå­æµç¨‹çš„éå†å±æ€§æ¥ä¾æ¬¡å¤„ç†è¿™ä¸ªé›†åˆä¸­æ•°æ®</p></blockquote> <p><a data-fancybox="" title="éå†å­æµç¨‹" href="../img2/11255a9dca07f908318ff0ff45c342a2.png"><img src="/assets/img/11255a9dca07f908318ff0ff45c342a2.a293d9a7.png" alt="11255a9dca07f908318ff0ff45c342a2"></a></p> <p>Â Â Â Â ğŸŸ¢ å­æµç¨‹éå†å±æ€§å¯ä»¥è®¾ç½®åœ¨å­æµç¨‹ä¸Šé¢å¯¹å…¨éƒ¨è°ƒç”¨å­æµç¨‹çš„ä¸»æµç¨‹éƒ½ç”Ÿæ•ˆï¼Œä¹Ÿå¯ä»¥è®¾ç½®åœ¨è°ƒç”¨å­æµç¨‹çš„<code>CallActivity</code>èŠ‚ç‚¹ä¸Šï¼Œä»…å¯¹å½“å‰ä¸»æµç¨‹ç”Ÿæ•ˆ</p> <p>Â Â Â Â ğŸŸ¢ æ¡†æ¶ä¸­å­æµç¨‹éå†å±æ€§çš„å®ç°åŸç†ï¼Œæ˜¯åœ¨æµç¨‹è§£ææ—¶å°†å­æµç¨‹ä¸Šéå†ç›¸å…³çš„å±æ€§è®¾ç½®åˆ°äº†æµç¨‹ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹ä¸Šã€‚æ‰€ä»¥å®é™…çš„æ‰§è¡Œæ•ˆæœå¹¶ä¸æ˜¯æµç¨‹çš„ä¸€ééæ‰§è¡Œã€‚è€Œæ˜¯æµç¨‹ä¸­çš„AèŠ‚ç‚¹å…¨éƒ¨éå†æ‰§è¡Œå®Œä¹‹åï¼Œå†è¿›è¡ŒBèŠ‚ç‚¹çš„éå†æ‰§è¡Œä¾æ¬¡ç±»æ¨ã€‚</p> <h2 id="_2-8-æœåŠ¡èŠ‚ç‚¹æ‹¦æˆªå™¨"><a href="#_2-8-æœåŠ¡èŠ‚ç‚¹æ‹¦æˆªå™¨" class="header-anchor">#</a> 2.8 æœåŠ¡èŠ‚ç‚¹æ‹¦æˆªå™¨</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>æ¡†æ¶æä¾›äº†æœåŠ¡èŠ‚ç‚¹æ‹¦æˆªå™¨ï¼Œç”¨æ¥å¯¹æµç¨‹ä¸­éœ€è¦æ‰§è¡Œçš„æœåŠ¡èŠ‚ç‚¹è¿›è¡Œæ‹¦æˆªå’Œæ§åˆ¶</p></div> <p><strong>æ‹¦æˆªå™¨å®šä¹‰</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceNodeInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">TaskInterceptor</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * æ¥å£æœ‰é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥ä¸å®ç°è¯¥æ–¹æ³•
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Ordered</span><span class="token punctuation">.</span>HIGHEST_PRECEDENCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æ¥å£æœ‰é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥ä¸å®ç°è¯¥æ–¹æ³•
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">IterData</span> iterData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ScopeDataOperator</span> dataOperator <span class="token operator">=</span> iterData<span class="token punctuation">.</span><span class="token function">getDataOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Iter</span> iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServiceNodeResource</span> serviceNode <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">getServiceNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ScopeDataOperator</span> dataOperator <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">getDataOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Role</span> role <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">getRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> data <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ComponentName: {}, ServiceName: {}, AbilityName: {}, data: {}&quot;</span><span class="token punctuation">,</span> serviceNode<span class="token punctuation">.</span><span class="token function">getComponentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> serviceNode<span class="token punctuation">.</span><span class="token function">getServiceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> serviceNode<span class="token punctuation">.</span><span class="token function">getAbilityName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>Â Â Â Â ğŸŸ¢ åˆ›å»ºå®ç°äº†<code>TaskInterceptor</code>æ¥å£çš„ç±»å®ä¾‹å¹¶æ”¾å…¥Springå®¹å™¨ä¸­ï¼ŒæœåŠ¡èŠ‚ç‚¹æ‹¦æˆªå™¨ä¾¿ä¼šç”Ÿæ•ˆ</p> <p>Â Â Â Â ğŸŸ¢ <code>TaskInterceptor</code>æ¥å£æä¾›ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <code>getOrder()</code>ï¼šç”¨æ¥æŒ‡å®šæ‹¦æˆªå™¨åˆ—è¡¨é¡ºåºï¼Œæ¥å£æœ‰é»˜è®¤å®ç°å¯ä»¥ä¸é‡å†™ï¼Œé»˜è®¤è¿”å›0</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <code>match(IterData iterData)</code>ï¼šç”¨æ¥åˆ¤æ–­å½“å‰æ‹¦æˆªå™¨æ˜¯å¦ç”Ÿæ•ˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡èŠ‚ç‚¹æ‹¦æˆªå™¨å¯¹å…¨éƒ¨æœåŠ¡èŠ‚ç‚¹ç”Ÿæ•ˆï¼Œè¯¥æ–¹æ³•å¯ä»¥è¿‡æ»¤æ‰æ— éœ€ç”Ÿæ•ˆçš„æ‹¦æˆªå™¨ã€‚æ¥å£æœ‰é»˜è®¤å®ç°å¯ä»¥ä¸é‡å†™ï¼Œé»˜è®¤è¿”å›ï¼štrue</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <code>invoke(Iter iter)</code>ï¼šæ‹¦æˆªå™¨å®é™…ç”Ÿæ•ˆçš„æ–¹æ³•ã€‚æä¾›<code>Iter</code>å…¥å‚ï¼Œå¯ä»¥å‡­æ­¤å¯¹è±¡æ‰§è¡Œä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨æˆ–ç›®æ ‡èŠ‚ç‚¹ï¼Œè·å–<code>Role</code>ã€<code>ScopeDataOperator</code>ã€<code>ServiceNodeResource</code></p> <p>Â Â Â Â ğŸŸ¢ æœåŠ¡èŠ‚ç‚¹æ‹¦æˆªå™¨åœ¨èŠ‚ç‚¹ç­–ç•¥åŠ¨ä½œçš„æœ€å¤–å±‚ã€‚ä¹Ÿå°±æ˜¯è¯´å‡ºç°é‡è¯•ã€é™çº§ã€è¿­ä»£ç­‰åŠ¨ä½œæ—¶æœåŠ¡èŠ‚ç‚¹ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œä½†æ˜¯æ‹¦æˆªå™¨åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœéœ€è¦åœ¨æœåŠ¡èŠ‚ç‚¹æ–¹æ³•è¢«è°ƒç”¨æ—¶è¿›è¡Œæ‹¦æˆªï¼Œå¯ä»¥ä½¿ç”¨Spring AOPï¼Œå› ä¸ºç±»ç»„ä»¶æœ¬èº«å°±æ˜¯Springä¸­çš„å®ä¾‹</p> <h2 id="_2-9-è‡ªå®šä¹‰æŒ‡ä»¤"><a href="#_2-9-è‡ªå®šä¹‰æŒ‡ä»¤" class="header-anchor">#</a> 2.9 è‡ªå®šä¹‰æŒ‡ä»¤</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>ä¸€äº›åœºæ™¯ä¸­éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ“ä½œæ¯”å¦‚æ’åºã€è¿‡æ»¤ã€è®¡ç®—ç­‰ã€‚è¿™äº›æ“ä½œæœåŠ¡èŠ‚ç‚¹å¯ä»¥å®Œæˆï¼Œä½†å®ƒä¸€èˆ¬æ˜¯ä»¥æ»¡è¶³ä¸šåŠ¡åŠ¨ä½œä¸ºç›®æ ‡ï¼Œç”¨æ¥å®šä¹‰å®Œæˆè¿™ç§æ´—æ•°æ®çš„å·¥ä½œå¤ªè¿‡äºç¹é‡ï¼Œç„¶è€Œæ•°æ®åŠ å·¥åˆä¸å¾—ä¸åšã€‚æ¡†æ¶æä¾›äº†è‡ªå®šä¹‰æŒ‡ä»¤çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰é€šç”¨çš„å·¥å…·ï¼Œåœ¨æµç¨‹ä¸­ç›´æ¥ä½¿ç”¨</p></div> <p>Â Â Â Â è‡ªå®šä¹‰æŒ‡ä»¤æ˜¯åœ¨æœåŠ¡èŠ‚ç‚¹çš„åŸºç¡€ä¸Šåˆ›å»ºçš„ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹ã€‚åªæ˜¯æ­¤æ—¶çš„æœåŠ¡èŠ‚ç‚¹æä¾›äº†ä¸€å¥—æ›´é€šç”¨æ›´ä¾¿æ·çš„ä½¿ç”¨æ–¹å¼ï¼Œè¢«å®šä¹‰ç”¨æ¥è§£å†³ä¸€äº›ä¸ä¸šåŠ¡æ— å…³çš„é€šç”¨æ€§é—®é¢˜ã€‚è¿™ç§æ›´é€šç”¨æ›´ä¾¿æ·çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯è‡ªå®šä¹‰æŒ‡ä»¤ã€‚</p> <h3 id="_2-9-1-å®šä¹‰æŒ‡ä»¤"><a href="#_2-9-1-å®šä¹‰æŒ‡ä»¤" class="header-anchor">#</a> 2.9.1 å®šä¹‰æŒ‡ä»¤</h3> <blockquote><p>ç”¨æ¥å¯¹StoryBusä¸­çš„é›†åˆè¿›è¡Œæ’åº</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TaskComponent</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;InstructService&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InstructService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@TaskInstruct</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;sort&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;instruct-service-sort&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">InstructContent</span> instructContent<span class="token punctuation">,</span> <span class="token class-name">ScopeDataOperator</span> operator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SortContent</span> sortContent <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>instructContent<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SortContent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataOptional <span class="token operator">=</span> operator<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span>sortContent<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dataOptional<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span>dataOptional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> dataOptional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sortContent<span class="token punctuation">.</span>asc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token punctuation">)</span> <span class="token class-name">PropertyUtils</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> sortContent<span class="token punctuation">.</span><span class="token function">getSortFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token punctuation">)</span> <span class="token class-name">PropertyUtils</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> sortContent<span class="token punctuation">.</span><span class="token function">getSortFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        operator<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>sortContent<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SortContent</span> <span class="token punctuation">{</span>

        <span class="token comment">/**
         * è¦æ’åºæ•°æ®çš„ä½ç½®
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> source<span class="token punctuation">;</span>

        <span class="token comment">/**
         * æ ¹æ®å¯¹è±¡çš„å“ªä¸ªå­—æ®µæ¥æ’åº
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> sortFieldName<span class="token punctuation">;</span>

        <span class="token comment">/**
         * æ’åºåçš„é›†åˆæ”¾åœ¨ä»€ä¹ˆåœ°æ–¹
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> target<span class="token punctuation">;</span>

        <span class="token comment">/**
         * æ˜¯å¦æ˜¯å‡åº
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">boolean</span> asc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>Â Â Â Â ğŸŸ¢ å¦‚æœä¸è€ƒè™‘<code>@TaskInstruct(name = &quot;sort&quot;)</code>ï¼Œä»…ä»…æ˜¯å®šä¹‰äº†ä¸€ä¸ªåå­—ä¸º<code>instruct-service-sort</code>çš„æœåŠ¡èŠ‚ç‚¹ï¼ŒåŠ ä¸Š<code>@TaskInstruct</code>å°±æ˜¯è‡ªå®šä¹‰æŒ‡ä»¤</p> <p>Â Â Â Â ğŸŸ¢ <code>@TaskInstruct</code>æœ‰ä¸€ä¸ª<code>name</code>å±æ€§ï¼Œç”¨æ¥å®šä¹‰æŒ‡ä»¤çš„åç§°ã€‚åœ¨BPMNé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æŒ‡ä»¤æ—¶åç§°å‰é¢éœ€è¦åŠ <code>c-</code>ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­å°±æ˜¯<code>c-sort</code></p> <p>Â Â Â Â ğŸŸ¢ <code>InstructContent</code>å‚æ•°ç”¨æ¥è·å–æŒ‡ä»¤åç§°å’Œå†…å®¹ã€‚æ— éœ€å¢åŠ ä»»ä½•æ³¨è§£ï¼Œç›´æ¥ä½¿ç”¨å³å¯</p> <h3 id="_2-9-2-ä½¿ç”¨æŒ‡ä»¤"><a href="#_2-9-2-ä½¿ç”¨æŒ‡ä»¤" class="header-anchor">#</a> 2.9.2 ä½¿ç”¨æŒ‡ä»¤</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>å‡è®¾å¯¹ä¸€ç»„å•†å“æ ‡ç­¾è¿›è¡Œæ’åº</p></div> <p><a data-fancybox="" title="è‡ªå®šä¹‰æŒ‡ä»¤ä½¿ç”¨" href="../img2/8330994eebbdbfa8a56a270c320ca0b7.png"><img src="/assets/img/8330994eebbdbfa8a56a270c320ca0b7.3cf0143d.png" alt="8330994eebbdbfa8a56a270c320ca0b7"></a></p> <p>æŒ‡ä»¤åç§°æ˜¯<code>c-sort</code>ï¼Œå†…å®¹æ˜¯ï¼š</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sta.shopInfo.labels&quot;</span><span class="token punctuation">,</span> <span class="token comment">// è¦æ’åºæ•°æ®çš„ä½ç½®</span>
    <span class="token property">&quot;sortFieldName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æ ¹æ®å¯¹è±¡çš„å“ªä¸ªå­—æ®µæ¥æ’åº</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;var.labels&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æ’åºåçš„é›†åˆæ”¾åœ¨ä»€ä¹ˆåœ°æ–¹</span>
    <span class="token property">&quot;asc&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// æ˜¯å¦æ˜¯å‡åº</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Â Â Â Â ğŸŸ¢ ä¸Šé¢ä¾‹å­ä¸­ç®€å•å®šä¹‰æœåŠ¡èŠ‚ç‚¹çš„æŒ‡ä»¤åç§°å’Œå€¼ï¼Œå…¶ä»–çš„å¹¶æœªå®šä¹‰</p> <p>Â Â Â Â ğŸŸ¢ æœåŠ¡èŠ‚ç‚¹æ”¯æŒåŒæ—¶é…ç½®æŒ‡ä»¤å’ŒæœåŠ¡èŠ‚ç‚¹åç§°ï¼Œå¹¶ä¸”åŒä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹æ”¯æŒåŒæ—¶é…ç½®å¤šä¸ªä¸åŒæŒ‡ä»¤</p> <p>Â Â Â Â ğŸŸ¢ <code>c-</code>å¼€å¤´çš„æŒ‡ä»¤å¦‚æœå’ŒæœåŠ¡èŠ‚ç‚¹åç§°åŒæ—¶å­˜åœ¨ï¼Œé»˜è®¤ä¼šå…ˆæ‰§è¡Œåç§°å¯¹åº”çš„æœåŠ¡èŠ‚ç‚¹å†æ‰§è¡ŒæŒ‡ä»¤ã€‚å¦‚æœæ‰§è¡Œé¡ºåºè¦åè¿‡æ¥éœ€è¦åœ¨<code>c-</code>å‰é¢åŠ <code>^</code>ï¼Œä¾‹å¦‚ï¼š<code>^c-sort</code></p> <p>Â Â Â Â ğŸŸ¢ åŒ…å«ç½‘å…³ã€æ’ä»–ç½‘å…³ä¹Ÿæ”¯æŒåŒæ—¶é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤ï¼Œå®šä¹‰çš„æŒ‡ä»¤ä¼šåœ¨ç½‘å…³ä¹‹å‰æ‰§è¡Œï¼Œä½¿ç”¨åœºæ™¯æ˜¯ç½‘å…³å‰é¢å®šä¹‰æŒ‡ä»¤å¯¹æ•°æ®è¿›è¡ŒåŠ å·¥ï¼Œç½‘å…³åé¢å†è·Ÿæ¡ä»¶è¡¨è¾¾å¼è¿›è¡Œè·¯ç”±å†³ç­–</p> <div class="custom-block warning"><p class="custom-block-title">æ³¨æ„ï¼š</p> <p>ä»£ç æ–¹å¼å®šä¹‰æµç¨‹æ—¶æ˜¯ä¸æ”¯æŒå¢åŠ <code>^</code>å‰ç¼€æ¥æ”¹å˜æŒ‡ä»¤å’ŒèŠ‚ç‚¹æ–¹æ³•æ‰§è¡Œé¡ºåºçš„</p></div> <h2 id="_2-10-è„šæœ¬æŒ‡ä»¤"><a href="#_2-10-è„šæœ¬æŒ‡ä»¤" class="header-anchor">#</a> 2.10 è„šæœ¬æŒ‡ä»¤</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>KstryæœåŠ¡èŠ‚ç‚¹æ”¯æŒJSè„šæœ¬æŒ‡ä»¤ï¼Œå®ç°æ–¹å¼å°±æ˜¯è‡ªå®šä¹‰æŒ‡ä»¤ã€‚å¦‚æœå½“ä¸‹çš„è„šæœ¬å¼•æ“æˆ–è€…é€»è¾‘ä¸æ»¡è¶³ç°çŠ¶çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤è¿›è¡Œå®šåˆ¶åŒ–è„šæœ¬å¼•æ“çš„å¼€å‘</p></div> <h3 id="_2-10-1-å®ç°è„šæœ¬æŒ‡ä»¤"><a href="#_2-10-1-å®ç°è„šæœ¬æŒ‡ä»¤" class="header-anchor">#</a> 2.10.1 å®ç°è„šæœ¬æŒ‡ä»¤</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TaskInstruct</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;jscript&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@TaskService</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;js-script-instruct&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">instruct</span><span class="token punctuation">(</span><span class="token class-name">InstructContent</span> instructContent<span class="token punctuation">,</span> <span class="token class-name">ScopeDataOperator</span> scopeDataOperator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>instructContent<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">JsScriptProperty</span> property <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scopeDataOperator<span class="token punctuation">.</span><span class="token function">getTaskProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            property <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>scopeDataOperator<span class="token punctuation">.</span><span class="token function">getTaskProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JsScriptProperty</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            LOGGER<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;[{}] js script property parsing exception. instruct: '{}{}', property: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ExceptionEnum</span><span class="token punctuation">.</span>SCRIPT_PROPERTY_PARSER_ERROR<span class="token punctuation">.</span><span class="token function">getExceptionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">BpmnElementProperties</span><span class="token punctuation">.</span>SERVICE_TASK_TASK_INSTRUCT<span class="token punctuation">,</span> instructContent<span class="token punctuation">.</span><span class="token function">getInstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scopeDataOperator<span class="token punctuation">.</span><span class="token function">getTaskProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span>EMPTY<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> invokeMethodName <span class="token operator">=</span> <span class="token string">&quot;invoke&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> script <span class="token operator">=</span> instructContent<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>property<span class="token punctuation">.</span><span class="token function">getInvokeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            invokeMethodName <span class="token operator">=</span> property<span class="token punctuation">.</span><span class="token function">getInvokeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            script <span class="token operator">=</span> <span class="token class-name">GlobalUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DEFAULT_FUNCTION<span class="token punctuation">,</span> invokeMethodName<span class="token punctuation">,</span> script<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        LOGGER<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;invoke js script. instruct: '{}{}', script: {}, property: {}&quot;</span><span class="token punctuation">,</span>
                <span class="token class-name">BpmnElementProperties</span><span class="token punctuation">.</span>SERVICE_TASK_TASK_INSTRUCT<span class="token punctuation">,</span> instructContent<span class="token punctuation">.</span><span class="token function">getInstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> script<span class="token punctuation">,</span> scopeDataOperator<span class="token punctuation">.</span><span class="token function">getTaskProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span>EMPTY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ScriptEngine</span> jsEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScriptEngineManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">&quot;javascript&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Bindings</span> bind <span class="token operator">=</span> jsEngine<span class="token punctuation">.</span><span class="token function">createBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bind<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ksta&quot;</span><span class="token punctuation">,</span> scopeDataOperator<span class="token punctuation">.</span><span class="token function">getStaScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bind<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;kvar&quot;</span><span class="token punctuation">,</span> scopeDataOperator<span class="token punctuation">.</span><span class="token function">getVarScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bind<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;kreq&quot;</span><span class="token punctuation">,</span> scopeDataOperator<span class="token punctuation">.</span><span class="token function">getReqScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bind<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;kres&quot;</span><span class="token punctuation">,</span> scopeDataOperator<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsEngine<span class="token punctuation">.</span><span class="token function">setBindings</span><span class="token punctuation">(</span>bind<span class="token punctuation">,</span> <span class="token class-name">ScriptContext</span><span class="token punctuation">.</span>ENGINE_SCOPE<span class="token punctuation">)</span><span class="token punctuation">;</span>

        jsEngine<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Invocable</span><span class="token punctuation">)</span> jsEngine<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invokeFunction</span><span class="token punctuation">(</span>invokeMethodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> property <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isAllBlank</span><span class="token punctuation">(</span>property<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> property<span class="token punctuation">.</span><span class="token function">getResultConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> typeConverterProcessor<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>property<span class="token punctuation">.</span><span class="token function">getResultConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">,</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>property<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token operator">::</span><span class="token function">isNotBlank</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>rt <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>property<span class="token punctuation">.</span><span class="token function">getReturnTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> target <span class="token operator">:</span> property<span class="token punctuation">.</span><span class="token function">getReturnTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">boolean</span> setRes <span class="token operator">=</span> scopeDataOperator<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>setRes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    LOGGER<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;invoke js script set result fail. instruct: '{}{}', target: {}, result: {}&quot;</span><span class="token punctuation">,</span>
                            <span class="token class-name">BpmnElementProperties</span><span class="token punctuation">.</span>SERVICE_TASK_TASK_INSTRUCT<span class="token punctuation">,</span> instructContent<span class="token punctuation">.</span><span class="token function">getInstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        LOGGER<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;invoke js script success. instruct: '{}{}', result: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">BpmnElementProperties</span><span class="token punctuation">.</span>SERVICE_TASK_TASK_INSTRUCT<span class="token punctuation">,</span> instructContent<span class="token punctuation">.</span><span class="token function">getInstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">buildException</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token class-name">ExceptionEnum</span><span class="token punctuation">.</span>SCRIPT_EXECUTE_ERROR<span class="token punctuation">,</span> <span class="token class-name">GlobalUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;js script execution exception! instruct: '{}{}', property: {}, script: \n{}&quot;</span><span class="token punctuation">,</span>
                <span class="token class-name">BpmnElementProperties</span><span class="token punctuation">.</span>SERVICE_TASK_TASK_INSTRUCT<span class="token punctuation">,</span> instructContent<span class="token punctuation">.</span><span class="token function">getInstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scopeDataOperator<span class="token punctuation">.</span><span class="token function">getTaskProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span>EMPTY<span class="token punctuation">)</span><span class="token punctuation">,</span> script<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><p>Â Â Â Â ä»¥ä¸Šä¸ºä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤å®ç°æ”¯æŒçš„æœåŠ¡èŠ‚ç‚¹è„šæœ¬åŠŸèƒ½çš„æºç ï¼Œå¯ç›´æ¥ä½¿ç”¨é»˜è®¤è„šæœ¬èƒ½åŠ›ï¼Œä¹Ÿå¯ä½œä¸ºå‚è€ƒå®ç°è‡ªå·±çš„è„šæœ¬å¼•æ“</p> <h3 id="_2-10-2-é»˜è®¤è„šæœ¬åŠŸèƒ½"><a href="#_2-10-2-é»˜è®¤è„šæœ¬åŠŸèƒ½" class="header-anchor">#</a> 2.10.2 é»˜è®¤è„šæœ¬åŠŸèƒ½</h3> <p>ä¸‹å›¾æ˜¯åœ¨æœåŠ¡èŠ‚ç‚¹ä¸Šå®šä¹‰çš„ä¸€ä¸ªè„šæœ¬æŒ‡ä»¤ï¼š</p> <p><a data-fancybox="" title="ä½¿ç”¨é»˜è®¤è„šæœ¬" href="../img2/8ad19b3369c13a0afe54afc1a1be974b.png"><img src="/assets/img/8ad19b3369c13a0afe54afc1a1be974b.d0ad485c.png" alt="8ad19b3369c13a0afe54afc1a1be974b"></a></p> <p>Â Â Â Â ğŸŸ¢ è„šæœ¬æŒ‡ä»¤éœ€è¦æŒ‡å®šè„šæœ¬åç§°<code>c-jscript</code>ï¼Œæ­¤åç§°æ˜¯å›ºå®šçš„ï¼ŒæŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå¦åˆ™è„šæœ¬ä¸ç”Ÿæ•ˆ</p> <p>Â Â Â Â ğŸŸ¢ å¦‚æœæŒ‡ä»¤å’ŒæœåŠ¡èŠ‚ç‚¹åç§°åŒæ—¶å­˜åœ¨ï¼Œå¹¶ä¸”æƒ³è¦åœ¨èŠ‚ç‚¹æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼Œå¯ä»¥åœ¨æŒ‡ä»¤åç§°å‰åŠ <code>^</code>ï¼Œè¿™ä¹Ÿæ˜¯è‡ªå®šä¹‰æŒ‡ä»¤çš„åŠŸèƒ½</p> <p>Â Â Â Â ğŸŸ¢ åœ¨æœåŠ¡èŠ‚ç‚¹æˆ–è€…ç½‘å…³ä¸Šå¯ä»¥ä½¿ç”¨<code>task-property</code>æ¥æŒ‡å®šè„šæœ¬å±æ€§ï¼Œé»˜è®¤è„šæœ¬æ”¯æŒçš„å±æ€§å¦‚ä¸‹ï¼š</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;result-converter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;object_to_long_list&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;return-target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;var.classIds&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Â Â Â Â Â Â Â Â ğŸ”· <strong><code>invoke-method</code></strong>ï¼šæŒ‡å®šè„šæœ¬æ–¹æ³•åç§°ã€‚é»˜è®¤æ— éœ€è®¾ç½®ï¼Œæ­¤æ—¶ç›´æ¥å†™è„šæœ¬é€»è¾‘å³å¯ï¼Œå¦‚æœè¯¥å­—æ®µä¸ä¸ºç©ºï¼Œè„šæœ¬å†…å®¹éœ€å®šä¹‰æˆæ–¹æ³•æ ¼å¼å¦‚ä¸‹ï¼Œæ­¤æ—¶<code>&quot;invoke-method&quot;: &quot;inv&quot;</code>ï¼š</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">var</span> classIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> kvar<span class="token punctuation">.</span>studyExperienceList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        classIds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>kvar<span class="token punctuation">.</span>studyExperienceList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>classId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>classIds<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Â Â Â Â Â Â Â Â ğŸ”· <strong><code>return-type</code></strong>ï¼šè„šæœ¬æ‰§è¡Œå®Œä¹‹åç»“æœçš„è¿”å›ç±»å‹</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <strong><code>return-target</code></strong>ï¼šè„šæœ¬æ‰§è¡Œå®Œä¹‹åæœ€ç»ˆçš„ç»“æœè¢«æ”¾åˆ°StoryBusçš„ä»€ä¹ˆä½ç½®ï¼Œæ”¯æŒè®¾ç½®å¤šä¸ª</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <strong><code>result-converter</code></strong>ï¼šæŒ‡å®šç±»å‹è½¬æ¢å™¨ï¼Œå°†è„šæœ¬æ‹¿åˆ°çš„ç»“æœè½¬æ¢æˆéœ€è¦çš„ç±»å‹</p> <p>Â Â Â Â ğŸŸ¢ åŒ…å«ç½‘å…³ã€æ’ä»–ç½‘å…³ä¹Ÿæ”¯æŒé…ç½®è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œè„šæœ¬æŒ‡ä»¤ä¹Ÿæ˜¯æŒ‡ä»¤ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æ”¯æŒçš„</p> <div class="custom-block warning"><p class="custom-block-title">æ³¨æ„ï¼š</p> <p>é«˜ç‰ˆæœ¬JDKä¸æ”¯æŒJSå¼•æ“è·å–ï¼Œ<code>new ScriptEngineManager().getEngineByName(&quot;javascript&quot;);</code>ä¼šå¾—åˆ°ç©ºå€¼ï¼Œæ­¤æ—¶éœ€è¦åœ¨é¡¹ç›®ä¸­åŠ å…¥ä¾èµ–ï¼š</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.openjdk.nashorn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>nashorn-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>15.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <h2 id="_2-11-ä»£ç æ–¹å¼å®šä¹‰æµç¨‹"><a href="#_2-11-ä»£ç æ–¹å¼å®šä¹‰æµç¨‹" class="header-anchor">#</a> 2.11 ä»£ç æ–¹å¼å®šä¹‰æµç¨‹</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>BPMNæ–‡ä»¶è™½ç„¶æœ‰éå¸¸ä¼˜ç§€çš„å¯è§†åŒ–ç‰¹ç‚¹ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œæ¯”å¦‚ideä¸­ç‚¹å‡»å®šä¹‰åœ¨é…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡èŠ‚ç‚¹æ— æ³•å¿«é€Ÿå®šä½åˆ°å…·ä½“æ–¹æ³•ã€æ— æ³•è¯†åˆ«è‡ªå®šä¹‰åè®®çš„æµç¨‹æ–‡ä»¶ç­‰ã€‚Kstryæä¾›ä»£ç å®šä¹‰æµç¨‹çš„æ–¹å¼æ¥å¹³è¡¡è¿™äº›é—®é¢˜ã€‚</p></div> <p>Â Â Â Â  æ¡†æ¶æä¾›<code>ProcessLink</code>ä½œä¸ºä»£ç æ–¹å¼å®šä¹‰æµç¨‹æœ€æ ¸å¿ƒçš„ç±»ï¼Œå®ƒæä¾›äº†ä¼—å¤šè¾…åŠ©æµç¨‹èŠ‚ç‚¹å½¼æ­¤é—´æ‹¼æ¥çš„æ–¹æ³•ï¼š</p> <p>Â Â Â Â ğŸŸ¢ <code>nextTask</code>ï¼šæŒ‡å®šä¸‹ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œç±»ç»„ä»¶å’ŒæœåŠ¡èŠ‚ç‚¹åç§°éƒ½éœ€è¦æä¾›</p> <p>Â Â Â Â ğŸŸ¢ <code>nextService</code>ï¼šæŒ‡å®šä¸‹ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œä»…éœ€è¦æä¾›æœåŠ¡èŠ‚ç‚¹åç§°å³å¯ã€‚åœ¨ç¡®ä¿æœåŠ¡èŠ‚ç‚¹åç§°å…¨å±€å”¯ä¸€æ—¶ä½¿ç”¨ï¼Œå¯ä»¥èŠ‚çœä»£ç é‡</p> <p>Â Â Â Â ğŸŸ¢ <code>nextInstruct</code>ï¼šæŒ‡å®šä¸‹ä¸€ä¸ªæŒ‡ä»¤ã€‚æŒ‡ä»¤æ˜¯ä¸€ç§ç‰¹æ®Šçš„æœåŠ¡èŠ‚ç‚¹ã€‚</p> <p>Â Â Â Â ğŸŸ¢ <code>nextSubProcess</code>ï¼šæŒ‡å®šä¸‹ä¸€ä¸ªå­æµç¨‹</p> <p>Â Â Â Â ğŸŸ¢ <code>nextExclusive</code>ï¼šæŒ‡å®šä¸‹ä¸€ä¸ªæ’ä»–ç½‘å…³</p> <p>Â Â Â Â ğŸŸ¢ <code>nextInclusive</code>ï¼šæŒ‡å®šä¸‹ä¸€ä¸ªåŒ…å«ç½‘å…³</p> <p>Â Â Â Â ğŸŸ¢ <code>nextParallel</code>ï¼šæŒ‡å®šä¸‹ä¸€ä¸ªå¹¶è¡Œç½‘å…³</p> <p>Â Â Â Â ğŸŸ¢ <code>joinTask</code>ï¼šå°†å¤šä¸ªä»»åŠ¡åˆ†æ”¯è¿›è¡Œåˆå¹¶</p> <p>Â Â Â Â ğŸŸ¢ <code>end</code>ï¼šæŒ‡å®šä¸‹ä¸€ä¸ªç»“æŸäº‹ä»¶</p> <h3 id="_2-11-1-ä¸»æµç¨‹å®šä¹‰"><a href="#_2-11-1-ä¸»æµç¨‹å®šä¹‰" class="header-anchor">#</a> 2.11.1 ä¸»æµç¨‹å®šä¹‰</h3> <p><a data-fancybox="" title="æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯æµç¨‹å®šä¹‰" href="../img2/e25009a28fddcdeed786aff92a414151.png"><img src="/assets/img/e25009a28fddcdeed786aff92a414151.ec6f83fc.png" alt="image-WX20230926"></a></p> <p><strong>ä»£ç æ–¹å¼å®šä¹‰æ­¤æµç¨‹å›¾å¦‚ä¸‹ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessLink</span> <span class="token function">studentScoreQueryProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> instructContent <span class="token operator">=</span> <span class="token string">&quot;var classIds = [];&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;for (var i = 0; i&lt; kvar.studyExperienceList.length; i++)&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;{&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;    classIds.push(kvar.studyExperienceList[i].classId);&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span>
            <span class="token operator">+</span> <span class="token string">&quot;return JSON.stringify(classIds)&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">StartProcessLink</span> processLink <span class="token operator">=</span> <span class="token class-name">StartProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">DefProcess</span><span class="token operator">::</span><span class="token function">studentScoreQueryProcess</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">InclusiveJoinPoint</span> asyncInclusive <span class="token operator">=</span> processLink<span class="token punctuation">.</span><span class="token function">nextInclusive</span><span class="token punctuation">(</span>processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">InclusiveJoinPoint</span> asyncInclusive2 <span class="token operator">=</span> asyncInclusive
            <span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Exp</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token class-name">ScopeTypeEnum</span><span class="token punctuation">.</span>REQUEST<span class="token punctuation">,</span> <span class="token class-name">QueryScoreRequest<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>needScore<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getStudyExperienceList</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">nextInstruct</span><span class="token punctuation">(</span><span class="token string">&quot;jscript&quot;</span><span class="token punctuation">,</span> instructContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;JSè„šæœ¬&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;result-converter\&quot;: \&quot;object_to_long_list\&quot;,\&quot;return-target\&quot;: \&quot;var.classIds\&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">nextInclusive</span><span class="token punctuation">(</span>processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
                    processLink<span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notStrictMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
                            asyncInclusive2<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getClasInfoById</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            asyncInclusive2<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getStudentScoreList</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">assembleScoreClassInfo</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    processLink<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
                            asyncInclusive<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getStudentBasic</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            asyncInclusive<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getStudentPrivacy</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">assembleStudentInfo</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">StudentScoreService</span><span class="token operator">::</span><span class="token function">getQueryScoreResponse</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> processLink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>Â Â Â Â ğŸŸ¢ å®šä¹‰<code>ProcessLink</code>å¯¹è±¡ï¼Œæ”¾å…¥Springå®¹å™¨ä¸­ï¼Œæµç¨‹åœ¨å¯åŠ¨æ—¶å°±ä¼šè¢«åŠ è½½ç”Ÿæ•ˆï¼Œè¿™ç§ç”Ÿæ•ˆæ–¹å¼æ˜¯ä¸æ”¯æŒåŠ¨æ€å˜æ›´çš„</p> <h3 id="_2-11-2-å­æµç¨‹å®šä¹‰"><a href="#_2-11-2-å­æµç¨‹å®šä¹‰" class="header-anchor">#</a> 2.11.2 å­æµç¨‹å®šä¹‰</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SubProcessLink</span> <span class="token function">calculateSubProcessDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">SubProcessLink</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">ProcessConfig</span><span class="token operator">::</span><span class="token function">calculateSubProcessDemo</span><span class="token punctuation">,</span> link <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">InclusiveJoinPoint</span> inclusiveJoinPoint <span class="token operator">=</span> link<span class="token punctuation">.</span><span class="token function">nextInclusive</span><span class="token punctuation">(</span>link<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        link<span class="token punctuation">.</span><span class="token function">inclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinLinks</span><span class="token punctuation">(</span>
                inclusiveJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'+'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">plusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                inclusiveJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'*'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">multiplyCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                inclusiveJoinPoint<span class="token punctuation">.</span><span class="token function">nextService</span><span class="token punctuation">(</span><span class="token class-name">Ex</span><span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;var.factor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;'-'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CalculateService</span><span class="token operator">::</span><span class="token function">minusCalculate</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Â Â Â Â ğŸŸ¢ å­æµç¨‹ä¸ä¸»æµç¨‹æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œå®šä¹‰<code>SubProcessLink</code>å¯¹è±¡æ”¾å…¥Springå®¹å™¨ä¸­ï¼Œå­æµç¨‹åœ¨å¯åŠ¨æ—¶å°±ä¼šè¢«åŠ è½½ç”Ÿæ•ˆï¼ŒåŒæ ·ä¸æ”¯æŒåŠ¨æ€å˜æ›´</p> <h3 id="_2-11-3-è§£ææ–‡ä»¶å®šä¹‰æµç¨‹"><a href="#_2-11-3-è§£ææ–‡ä»¶å®šä¹‰æµç¨‹" class="header-anchor">#</a> 2.11.3 è§£ææ–‡ä»¶å®šä¹‰æµç¨‹</h3> <p>Â Â Â Â ä»£ç å®šä¹‰æµç¨‹çœ‹ä¸Šå»æ¯”BPMNå¯è§†åŒ–æµç¨‹å›¾å¤æ‚ä¸å°‘ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æ”¯æŒå‘¢ï¼Ÿ</p> <p>Â Â Â Â æ­£å¦‚å‰é¢æ‰€è¯´çš„ï¼Œå°‘é‡æœåŠ¡èŠ‚ç‚¹ç»„æˆçš„æµç¨‹ï¼Œä»£ç å®šä¹‰èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ã€‚è€Œæ›´é‡è¦çš„ä¸€ä¸ªåŸå› åˆ™æ˜¯ï¼Œç”¨ä»£ç æ–¹å¼å®šä¹‰æµç¨‹å¯ä»¥æ”¯æŒä»»æ„åè®®çš„æµç¨‹é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æŒ‰éœ€è§£æå¼€æºæˆ–å…¬å¸å†…éƒ¨çš„å‰ç«¯æµç¨‹ç»„ä»¶ï¼Œå¹¶é…åˆKstryå®Œæˆæœ€ç»ˆçš„æµç¨‹ç¼–æ’ã€‚</p> <p>Â Â Â Â è€Œæ¡†æ¶æœ¬èº«ï¼Œåœ¨1.1.xä¹‹åçš„ç‰ˆæœ¬é‡ŒPBMNæµç¨‹é…ç½®æ–‡ä»¶ä¹Ÿæ˜¯ç”¨è¿™å¥—APIæ¥è§£æçš„ï¼Œå…·ä½“å¯ä»¥å‚è€ƒKstryæºç ä¸­çš„å®ç°ï¼š <a href="https://gitee.com/kstry/kstry-core/blob/master/src/main/java/cn/kstry/framework/core/component/bpmn/CamundaBpmnModelTransfer.java" target="_blank" rel="noopener noreferrer">CamundaBpmnModelTransfer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚åœ¨åé¢çš„åŠ¨æ€æµç¨‹é…ç½®é‡Œï¼Œè¿™å¥—APIä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„éƒ¨åˆ†</p> <h2 id="_2-12-åŠ¨æ€æµç¨‹é…ç½®"><a href="#_2-12-åŠ¨æ€æµç¨‹é…ç½®" class="header-anchor">#</a> 2.12 åŠ¨æ€æµç¨‹é…ç½®</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>å®šä¹‰è·¯å¾„æ‰«æbpmnæ–‡ä»¶å’Œåˆ›å»º<code>ProcessLink</code>å®ä¾‹æ”¾å…¥Springå®¹å™¨ä¸¤ç§æµç¨‹çš„å®šä¹‰æ–¹å¼æ˜¯é™æ€çš„ï¼Œå¦‚æœè¦ä¿®æ”¹åªèƒ½é‡å¯åº”ç”¨ã€‚æ¡†æ¶åœ¨1.1.xç‰ˆæœ¬ä¹‹åæä¾›äº†åŠ¨æ€è·å–æµç¨‹é…ç½®çš„èƒ½åŠ›ï¼Œå¹¶ä¸”åŠ¨æ€åŒ–é…ç½®æ”¯æŒé€šè¿‡httpæˆ–rpcè°ƒç”¨ã€å…³ç³»æˆ–è€…éå…³ç³»å‹æ•°æ®åº“æŸ¥è¯¢ã€è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ã€è®¢é˜…æ³¨å†Œä¸­å¿ƒã€å…¬å¸è‡ªå®šä¹‰å­˜å‚¨ä»‹è´¨æŸ¥è¯¢ç­‰ä»»æ„æ–¹å¼è·å–</p></div> <h3 id="_2-12-1-ä½¿ç”¨åŠ¨æ€æµç¨‹"><a href="#_2-12-1-ä½¿ç”¨åŠ¨æ€æµç¨‹" class="header-anchor">#</a> 2.12.1 ä½¿ç”¨åŠ¨æ€æµç¨‹</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicProcessRegister</span> <span class="token keyword">implements</span> <span class="token class-name">DynamicProcess</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">version</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessLink</span><span class="token punctuation">&gt;</span></span> <span class="token function">getProcessLink</span><span class="token punctuation">(</span><span class="token class-name">String</span> startId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">DynamicProcessRegister</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;dynamic/goods.bpmn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BpmnProcessParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BpmnProcessParser</span><span class="token punctuation">(</span><span class="token string">&quot;åŠ¨æ€è·å–æµç¨‹&quot;</span><span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> parser<span class="token punctuation">.</span><span class="token function">getProcessLink</span><span class="token punctuation">(</span>startId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Â Â Â Â ğŸŸ¢ åˆ›å»ºå®ç°<code>DynamicProcess</code>æ¥å£çš„ç±»å®ä¾‹ï¼Œæ”¾å…¥Springå®¹å™¨ä¸­ï¼ŒåŠ¨æ€æµç¨‹ç»„ä»¶å³ä¼šç”Ÿæ•ˆ</p> <p>Â Â Â Â ğŸŸ¢ <code>DynamicProcess</code>æä¾›ä¸¤ä¸ªæ–¹æ³•ï¼š</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <strong><code>version(String key)</code></strong>ï¼šä¼ å…¥startIdè¿”å›å½“å‰æµç¨‹çš„ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·æ²¡æœ‰å˜åŒ–å¹¶ä¸”æµç¨‹ç¼“å­˜æ²¡æœ‰å¤±æ•ˆæ—¶ï¼Œæ¡†æ¶ä¸ä¼šè°ƒç”¨<code>getProcessLink(String startId)</code>æ¥è·å–æ–°çš„æµç¨‹ï¼Œåä¹‹åˆ™ä¼šé‡æ–°è·å–æ–°çš„æµç¨‹ã€‚æµç¨‹ç¼“å­˜çš„æ—¶é•¿æ˜¯1å¤©ã€‚ä¿®æ”¹æµç¨‹åæ§åˆ¶è¯¥æ–¹æ³•è¿›è¡Œç‰ˆæœ¬å·å‡çº§ï¼Œæ–°çš„æµç¨‹ä¼šå³åˆ»ç”Ÿæ•ˆã€‚å¦‚æœæƒ³è¦åˆ é™¤æŸä¸ªæµç¨‹ï¼Œå‡çº§ç‰ˆæœ¬å·å<code>getProcessLink(String startId)</code>è¿”å›ç©ºå³å¯å®ç°</p> <p>Â Â Â Â Â Â Â Â ğŸ”· <strong><code>getProcessLink(String startId)</code></strong>ï¼šæ ¹æ®startIdè·å–æµç¨‹é…ç½®ã€‚ç¼“å­˜æœªå¤±æ•ˆä¸”ç‰ˆæœ¬æœªæ”¹å˜æ—¶è¯¥æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ã€‚</p> <p>Â Â Â Â ğŸŸ¢ ä¸Šé¢ä»£ç æ¼”ç¤ºçš„æ˜¯ä»ç±»è·¯å¾„ä¸‹åŠ è½½æµç¨‹é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡æµç¨‹è§£æå™¨è§£æç”Ÿæˆ<code>ProcessLink</code>å¯¹è±¡å¹¶è¿”å›çš„è¿‡ç¨‹ã€‚å¯ä»¥æ ¹æ®éœ€è¦ä»ä»»æ„å­˜å‚¨ä»‹è´¨ä¸­è·å–æµç¨‹é…ç½®ä¿¡æ¯</p> <p>Â Â Â Â ğŸŸ¢ å¦‚æœä¸éœ€è¦ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½è¦è·å–æœ€æ–°çš„æµç¨‹ï¼Œå°†<code>version(String key)</code>çš„è¿”å›å€¼è®¾ç½®æˆå°äº0çš„å€¼å³å¯</p> <h3 id="_2-12-2-ä½¿ç”¨åŠ¨æ€å­æµç¨‹"><a href="#_2-12-2-ä½¿ç”¨åŠ¨æ€å­æµç¨‹" class="header-anchor">#</a> 2.12.2 ä½¿ç”¨åŠ¨æ€å­æµç¨‹</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>æ¡†æ¶åŒæ ·æä¾›äº†åŠ¨æ€è·å–å­æµç¨‹çš„èƒ½åŠ›</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicSubProcessRegister</span> <span class="token keyword">implements</span> <span class="token class-name">DynamicSubProcess</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SubProcessLink</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSubProcessLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">DynamicSubProcessRegister</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;dynamic/goods.bpmn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BpmnProcessParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BpmnProcessParser</span><span class="token punctuation">(</span><span class="token string">&quot;åŠ¨æ€è·å–æµç¨‹&quot;</span><span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span><span class="token function">getAllSubProcessLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Â Â Â Â ğŸŸ¢ åˆ›å»ºå®ç°<code>DynamicSubProcess</code>æ¥å£çš„ç±»å®ä¾‹ï¼Œæ”¾å…¥Springå®¹å™¨ä¸­ï¼ŒåŠ¨æ€å­æµç¨‹ç»„ä»¶å³ä¼šç”Ÿæ•ˆ</p> <p>Â Â Â Â ğŸŸ¢ åŠ¨æ€å­æµç¨‹æ²¡æœ‰ç‰ˆæœ¬çš„æ¦‚å¿µï¼Œåªè¦æ˜¯è·å–å°±æ˜¯æœ€æ–°çš„ã€‚è·å–å­æµç¨‹åŠ¨ä½œæ˜¯åœ¨åˆ›å»ºä¸»æµç¨‹æ—¶è¢«è§¦å‘çš„ï¼Œå¯ä»¥ç†è§£æˆä¸»æµç¨‹å’Œå­æµç¨‹å…±ç”¨ä¸€ä¸ªç‰ˆæœ¬å·</p> <h3 id="_2-12-3-åŠ¨æ€ä¸é™æ€æµç¨‹å…³ç³»"><a href="#_2-12-3-åŠ¨æ€ä¸é™æ€æµç¨‹å…³ç³»" class="header-anchor">#</a> 2.12.3 åŠ¨æ€ä¸é™æ€æµç¨‹å…³ç³»</h3> <p>Â Â Â Â åªæœ‰<code>bpmnPath</code>ä¸€ç§æµç¨‹é…ç½®é€”å¾„æ—¶ï¼Œä¸‹é¢è¿™ç§å¯è§†åŒ–æµç¨‹å›¾å°±æ˜¯è¢«å®šä¹‰å‡ºæ¥çš„æµç¨‹ï¼Œä¹Ÿæ˜¯å‡­æ­¤æ¥æŒ‡å¯¼ç¨‹åºå®é™…çº¿è·¯çš„æ‰§è¡Œã€‚<code>ProcessLink</code>å‡ºç°ä¹‹åï¼Œæ¡†æ¶æä¾›äº†è‡ªå®šä¹‰æµç¨‹çš„èƒ½åŠ›ç»™ä½¿ç”¨è€…ï¼Œåœ¨1.xä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼ŒBPMNå¯è§†åŒ–æµç¨‹å›¾ä¹Ÿæ˜¯è¢«è§£ææˆ<code>ProcessLink</code>å¯¹è±¡æ¥ç”Ÿæ•ˆçš„ï¼Œæ­¤æ—¶çš„BPMNå¯è§†åŒ–æµç¨‹å°±ä½œä¸ºäº†æµç¨‹å®šä¹‰çš„ä¸€ä¸ªå­é›†è€Œå­˜åœ¨ã€‚æ›´å¤šæƒ…å†µä¸‹ä½¿ç”¨è€…å¯ä»¥é€šè¿‡ç¼–ç ã€è§£æå„ç±»é…ç½®æ–‡ä»¶ç­‰æ–¹å¼æ¥åˆ›å»º<code>ProcessLink</code>å®ä¾‹ï¼Œæœ€ç»ˆäº¤ä»˜ç»™æ¡†æ¶çš„<code>ProcessLink</code>å®ä¾‹å°†ä¼šä½œä¸ºæµç¨‹å®šä¹‰æ¥æŒ‡å¯¼ç¨‹åºçš„æ‰§è¡Œã€‚</p> <p><a data-fancybox="" title="image-20211219163429668.png" href="http://cdn.kstry.cn/doc/img/image-20211219163429668.png" style="zoom:60%;"><img src="http://cdn.kstry.cn/doc/img/image-20211219163429668.png" alt="image-20211219163429668.png"></a></p> <p>Â Â Â Â Kstryæä¾›äº†ä¸‰ç§æ–¹å¼æ¥å®šä¹‰æµç¨‹é…ç½®ï¼Œåˆ†åˆ«æ˜¯ï¼š</p> <p>Â Â Â Â ğŸŸ¢ ã€<strong>åŸºç¡€æµç¨‹é…ç½®</strong>ã€‘æŒ‡å®š<code>@EnableKstry</code>æ³¨è§£çš„<code>bpmnPath</code>å±æ€§æ¥æ‰«ææŒ‡å®šç›®å½•ä¸‹çš„bpmné…ç½®æ–‡ä»¶</p> <p>Â Â Â Â ğŸŸ¢ ã€<strong>åŸºç¡€æµç¨‹é…ç½®</strong>ã€‘åˆ›å»º<code>ProcessLink</code>å®ä¾‹æ”¾å…¥Springå®¹å™¨ä¸­</p> <p>Â Â Â Â ğŸŸ¢ ã€<strong>åŠ¨æ€æµç¨‹é…ç½®</strong>ã€‘å®ç°<code>DynamicProcess</code>æ¥å£çš„<code>getProcessLink</code>æ–¹æ³•</p> <p>Â Â Â Â å‰é¢ä¸¤ç§æ–¹å¼å®šä¹‰çš„æµç¨‹æ˜¯åº”ç”¨å¯åŠ¨å‰å°±å¿…é¡»è¦å®šä¹‰å‡ºæ¥çš„å±äºåŸºç¡€æµç¨‹é…ç½®ï¼ŒåŸºç¡€æµç¨‹é™¤éåº”ç”¨é‡å¯å¦åˆ™æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ã€‚æ ¹æ®<code>startId</code>åœ¨åŸºç¡€æµç¨‹é…ç½®åº“é‡Œè·å–ä¸åˆ°æµç¨‹é…ç½®æ—¶æœ€åä¸€ç§æ–¹å¼æ‰ä¼šç”Ÿæ•ˆï¼Œå…¶è·å–æµç¨‹é…ç½®çš„æ–¹å¼æ˜¯åŠ¨æ€çš„ï¼Œä¼ å…¥<code>startId</code>è¿”å›<code>ProcessLink</code>å®ä¾‹ï¼Œå…¶ä¸­æ‰€éœ€çš„æµç¨‹é…ç½®ä¿¡æ¯å¯ä»¥é€šè¿‡httpæˆ–rpcè°ƒç”¨ã€å…³ç³»æˆ–è€…éå…³ç³»å‹æ•°æ®åº“æŸ¥è¯¢ã€è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ã€è®¢é˜…æ³¨å†Œä¸­å¿ƒã€å…¬å¸è‡ªå®šä¹‰å­˜å‚¨ä»‹è´¨æŸ¥è¯¢ç­‰ä»»æ„æ–¹å¼è·å–ã€‚</p> <img src="http://cdn.kstry.cn/doc/img/WX20221212-030616.png" alt="WX20221212-030616" style="zoom:90%;"> <p>Â Â Â Â ä¹‹æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨åŠ¨æ€æ”¹å˜åŸºç¡€æµç¨‹é…ç½®åº“çš„æ–¹å¼æ¥å®ç°æµç¨‹çš„åŠ¨æ€é…ç½®èƒ½åŠ›ï¼Œæœ‰ä»¥ä¸‹åŸå› ï¼š</p> <p>Â Â Â Â ğŸŸ¢ ã€<strong>å®‰å…¨æ€§</strong>ã€‘æµç¨‹é…ç½®å¯èƒ½ä¼šåˆ†é‡è¦çº§åˆ«ï¼Œæ ¸å¿ƒçš„æµç¨‹é…ç½®æ˜¯è¢«ä¸¥æ ¼ç®¡æ§ä¸å…è®¸éšæ„å˜æ›´çš„ï¼Œæ‰€ä»¥è¿™ç±»é…ç½®åº”è¯¥æ”¾åœ¨ä»£ç ä¸­ä¸å…è®¸éšæ„å˜æ›´ã€‚å¦‚æœåœ¨æµç¨‹é…ç½®åŸºç¡€åº“ä¸­æ‰¾åˆ°ä¸<code>startId</code>ç›¸åŒ¹é…çš„æµç¨‹ï¼ŒåŠ¨æ€è·å–éƒ¨åˆ†å°†å¤±æ•ˆï¼Œä»¥æ­¤æ¥ä¿éšœæµç¨‹çš„ç»å¯¹å®‰å…¨ã€‚å³ä¾¿æ ¸å¿ƒæµç¨‹ä¸­æœ‰éƒ¨åˆ†éœ€è¦åŠ¨æ€è·å–çš„æ‰©å±•é€»è¾‘ï¼Œä¹Ÿå¯ä»¥ç”¨åŠ¨æ€å­æµç¨‹çš„å½¢å¼æ¥å®ç°ã€‚</p> <p>Â Â Â Â ğŸŸ¢ ã€<strong>å…¼å®¹æ€§</strong>ã€‘åŠ¨æ€åŒ–é…ç½®å¯èƒ½æ¯”è¾ƒé€‚åˆä½¿ç”¨æ³¨å†Œä¸­å¿ƒæ¥å­˜å‚¨ç»´æŠ¤ï¼Œè¿™æ ·å½“å‘ç”Ÿå˜æ›´æ—¶èƒ½å¿«é€ŸåŠæ—¶é€šçŸ¥ç›¸å…³åº”ç”¨åšæµç¨‹å˜æ›´ã€‚ä½†å¹¶æ²¡æœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒæ˜¯æ‰€æœ‰å…¬å¸éƒ½ä½¿ç”¨çš„ï¼Œé™¤äº†å¼€æºäº§å“è¿˜æœ‰å…¬å¸è‡ªç ”ï¼Œå¦‚æœæƒ³è¦ä¸€ä¸€æ”¯æŒæ˜¯ä¸ç°å®çš„ã€‚é€‰ç”¨å…¶ä»–ä¸­é—´ä»¶äº§å“ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚æ‰€ä»¥è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹å¼å°±æ˜¯æä¾›ä¸€ä¸ªåŠ¨æ€è·å–æµç¨‹é…ç½®çš„å…¥å£ï¼Œè‡³äºæµç¨‹é…ç½®åœ¨ä»€ä¹ˆåœ°æ–¹è·å–å°†æ˜¯å› äººè€Œå¼‚çš„ã€‚</p> <p>Â Â Â Â åœ¨æµç¨‹ä¸­å‡ºç°å¯å¤ç”¨æˆ–è€…å¤æ‚çš„é“¾è·¯ç‰‡æ®µæ—¶ï¼Œå°±å¯ä»¥å°†è¿™äº›ç‰‡æ®µæŠ½ç¦»å‡ºæ¥å®šä¹‰å­æµç¨‹ã€‚çˆ¶æµç¨‹å¯ä»¥é€šè¿‡å­æµç¨‹Idæ¥å¼•ç”¨å­æµç¨‹ã€‚åŒæ ·ä¹Ÿæœ‰ä¸‰ç§æ–¹å¼æ¥å®šä¹‰å­æµç¨‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p> <p>Â Â Â Â ğŸŸ¢ ã€<strong>åŸºç¡€å­æµç¨‹é…ç½®</strong>ã€‘æŒ‡å®š<code>@EnableKstry</code>æ³¨è§£çš„<code>bpmnPath</code>å±æ€§æ¥æ‰«ææŒ‡å®šç›®å½•ä¸‹çš„bpmné…ç½®æ–‡ä»¶</p> <p>Â Â Â Â ğŸŸ¢ ã€<strong>åŸºç¡€å­æµç¨‹é…ç½®</strong>ã€‘åˆ›å»º<code>SubProcessLink</code>å®ä¾‹æ”¾å…¥Springå®¹å™¨ä¸­</p> <p>Â Â Â Â ğŸŸ¢ ã€<strong>åŠ¨æ€å­æµç¨‹é…ç½®</strong>ã€‘å®ç°<code>DynamicSubProcess</code>æ¥å£çš„<code>getSubProcessLinks</code>æ–¹æ³•</p> <p>Â Â Â Â ä¸»æµç¨‹æœ‰åŸºç¡€å’ŒåŠ¨æ€ä¹‹åˆ†ï¼Œç›¸å¯¹åº”ä¹Ÿæœ‰åŸºç¡€å’ŒåŠ¨æ€å­æµç¨‹çš„å­˜åœ¨ã€‚ä¸‹å›¾ä¸ºä¸¤è€…ç»“åˆèµ·æ¥æ—¶ï¼Œç›¸äº’ä¹‹é—´æ˜¯å¦å…è®¸è¢«å¼•ç”¨çš„è¯´æ˜ï¼š</p> <img src="http://cdn.kstry.cn/doc/img/WX20221222-183429.png" alt="WX20221222-183429" style="zoom:90%;"> <p>Â Â Â Â ğŸŸ¢ åŸºç¡€æµç¨‹ä»…èƒ½å¼•ç”¨åŸºç¡€å­æµç¨‹é…ç½®ï¼ŒåŠ¨æ€æµç¨‹å¯ä»¥å¼•ç”¨åŸºç¡€å­æµç¨‹å’ŒåŠ¨æ€å­æµç¨‹é…ç½®</p> <p>Â Â Â Â ğŸŸ¢ ä¸¤ç§å­æµç¨‹åœ¨å„è‡ªçš„åŒºåŸŸå†…å¯ä»¥ç›¸äº’å¼•ç”¨ï¼ŒåŠ¨æ€å­æµç¨‹ä¸­å¯ä»¥å¼•ç”¨åŸºç¡€å­æµç¨‹é…ç½®ï¼Œåä¹‹åˆ™ä¸è¢«å…è®¸</p> <div class="custom-block danger"><p class="custom-block-title">è­¦å‘Š</p> <p>å­æµç¨‹ç›¸äº’é—´å¼•ç”¨æ—¶ï¼Œä¸€å®šä¸èƒ½å‡ºç°ç¯çŠ¶ä¾èµ–ï¼Œå¦åˆ™ä¼šå‡ºç°å¼‚å¸¸â—ï¸â—ï¸â—ï¸</p></div> <h2 id="_2-13-ä½¿ç”¨å¼‚æ­¥æµç¨‹"><a href="#_2-13-ä½¿ç”¨å¼‚æ­¥æµç¨‹" class="header-anchor">#</a> 2.13 ä½¿ç”¨å¼‚æ­¥æµç¨‹</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>æµç¨‹é…ç½®ä¸­å¹¶è¡Œç½‘å…³ã€åŒ…å«ç½‘å…³åé¢çš„æµç¨‹æ”¯æŒå¼€å¯å¼‚æ­¥</p></div> <h3 id="_2-13-1-å¼€å¯å¼‚æ­¥"><a href="#_2-13-1-å¼€å¯å¼‚æ­¥" class="header-anchor">#</a> 2.13.1 å¼€å¯å¼‚æ­¥</h3> <p>Â Â Â Â ğŸŸ¢ <strong>ç›®å‰æ”¯æŒé…ç½®å¼‚æ­¥å¼€å¯çš„ç»„ä»¶æœ‰ï¼šå¹¶è¡Œç½‘å…³ã€åŒ…å«ç½‘å…³ä¸¤ç§</strong>ï¼Œæ’ä»–ç½‘å…³è™½ç„¶æ˜¯å…è®¸æœ‰å¤šä¸ªå‡ºåº¦ï¼Œä½†æœ€ç»ˆåªæœ‰ä¸€ä¸ªå‡ºåº¦è¢«æ‰§è¡Œï¼Œæ‰€ä»¥å¼€å¯å¼‚æ­¥çš„æ•ˆæœä¸å¤§å¹¶æœªæ”¯æŒå¼€å¯å¼‚æ­¥</p> <p>Â Â Â Â ğŸŸ¢ åœ¨ç½‘å…³ä¸Šé…ç½®<code>open-async=true</code>å³å¯å¼€å¯å¼‚æ­¥åŠŸèƒ½</p> <p>Â Â Â Â ğŸŸ¢ å’Œæ™®é€šçš„å¤šçº¿ç¨‹ä½¿ç”¨æ–¹å¼ä¸€æ ·ï¼Œå¹¶å‘åº¦å¤ªé«˜ä¹Ÿå¹¶éä¸€å®šæ˜¯å¥½äº‹ã€‚æ¯å¼€å¯ä¸€ä¸ªæ–°çº¿ç¨‹éƒ½è¦åˆ›å»ºæ–°çš„è®¡ç®—ä»»åŠ¡ï¼ŒåŠ ä¸Šçº¿ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåœ¨ä¸€äº›æœ¬æ¥å°±è€—æ—¶å¾ˆçŸ­çš„æœåŠ¡èŠ‚ç‚¹é—´å¼€å¯å¼‚æ­¥å¤§å¤šæ—¶å€™ä¼šå¾—ä¸å¿å¤±</p> <h3 id="_2-13-2-å¼‚æ­¥åŒ–ç”Ÿå‘½å‘¨æœŸ"><a href="#_2-13-2-å¼‚æ­¥åŒ–ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> 2.13.2 å¼‚æ­¥åŒ–ç”Ÿå‘½å‘¨æœŸ</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>åœ¨å¹¶è¡Œç½‘å…³ã€åŒ…å«ç½‘å…³ä¸Šé…ç½®<code>open-async=true</code>å±æ€§å³å¯å¼€å¯å¼‚æ­¥æµç¨‹ã€‚é‚£ä¹ˆå¼‚æ­¥çš„å¼€å§‹æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Œç»“æŸåˆæ˜¯åœ¨ä½•å¤„å‘¢ï¼Ÿ</p></div> <h4 id="å¼‚æ­¥çš„å¼€å§‹"><a href="#å¼‚æ­¥çš„å¼€å§‹" class="header-anchor">#</a> å¼‚æ­¥çš„å¼€å§‹</h4> <p><strong>å¼€å§‹æµç¨‹å¦‚ä¸‹ï¼š</strong></p> <p>Â Â Â Â ğŸŸ¢ æ‰§è¡Œå¼•æ“æ£€æµ‹åˆ°å¹¶è¡Œç½‘å…³ã€åŒ…å«ç½‘å…³ä¸Šé…ç½®<code>open-async=true</code>å±æ€§åï¼Œä¼šå°†ç½‘å…³åé¢çš„å‡ºåº¦åŒ…è£…æˆå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶è¡Œç½‘å…³ä¸åŒ…å«ç½‘å…³æ‰§è¡Œç­–ç•¥åˆç•¥æ˜¾ä¸åŒï¼š</p> <p>Â Â Â Â Â Â Â Â ğŸ”· å¹¶è¡Œç½‘å…³ä¼šå°†å…¶åçš„å…¨éƒ¨å‡ºåº¦é€ä¸€åŒ…è£…æˆå¼‚æ­¥ä»»åŠ¡ï¼Œæäº¤è‡³çº¿ç¨‹æ± æ‰§è¡Œ</p> <p>Â Â Â Â Â Â Â Â ğŸ”· åŒ…å«ç½‘å…³ä¼šåˆ¤æ–­å…¶åçš„å‡ºåº¦æ˜¯å¦æœ‰æ¡ä»¶è¡¨è¾¾å¼ï¼Œå¦‚æœæœ‰ä¼šå…ˆè§£ææ¡ä»¶è¡¨è¾¾å¼ï¼Œå°†è¡¨è¾¾å¼ç»“æœä¸ºtrueå’Œæ²¡æœ‰è¡¨è¾¾å¼çš„å‡ºåº¦é€ä¸€åŒ…è£…æˆå¼‚æ­¥ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± æ‰§è¡Œ</p> <p>Â Â Â Â ğŸŸ¢ æäº¤å®Œå¼‚æ­¥ä»»åŠ¡çš„çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œä»»åŠ¡æ ˆä¸­çš„å…¶ä»–èŠ‚ç‚¹ä»»åŠ¡ï¼Œä¸ä¼šå†é¡¾åŠå¼‚æ­¥ç½‘å…³å‡ºåº¦åŠå‡ºåº¦ä¹‹åçš„èŠ‚ç‚¹ï¼Œç›´è‡³ä»»åŠ¡æ ˆä¸­æ²¡æœ‰äº†å¯æ‰§è¡ŒèŠ‚ç‚¹æ—¶çº¿ç¨‹ä¼šå½’è¿˜è‡³çº¿ç¨‹æ± ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è¢«è°ƒç”¨</p> <p>Â Â Â Â ğŸŸ¢ çº¿ç¨‹æ± éšæœºé€‰æ‹©çº¿ç¨‹æ‰§è¡Œä¸Šè¿°æµç¨‹ä¸­åˆ›å»ºçš„å¼‚æ­¥ä»»åŠ¡</p> <h4 id="å¼‚æ­¥çš„ç»“æŸ"><a href="#å¼‚æ­¥çš„ç»“æŸ" class="header-anchor">#</a> å¼‚æ­¥çš„ç»“æŸ</h4> <p>Â Â Â Â ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿå¼‚æ­¥å°±æ˜¯åŒä¸€æ—¶é—´å¤šä¸ªçº¿ç¨‹å»åšäº†å¤šä¸ªäº‹æƒ…ï¼Œä»¥æ­¤æ¥èŠ‚çœéœ€è¦ä¸€ä¸ªçº¿ç¨‹åšå¤šä¸ªäº‹æƒ…æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚è¿™ç§æ¨¡å¼æœ‰ç‚¹åƒç®—æ³•é‡Œé¢çš„ç©ºé—´æ¢å–æ—¶é—´çš„å‘³é“ã€‚Kstryä¸­ä»€ä¹ˆæ—¶å€™ç»“æŸå¼€å¯åçš„å¼‚æ­¥ä»»åŠ¡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>å¤šä¸ªå¯ä»¥åŒä¸€æ—¶é—´æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡è¢«èšåˆç½‘å…³èšåˆåå¼‚æ­¥æµç¨‹å°±ç»“æŸäº†</strong>ã€‚æ¯”å¦‚ï¼š</p> <p>Â Â Â Â ğŸŸ¢ ä¸€ä¸ªæµç¨‹è¢«å¹¶è¡Œç½‘å…³æ‹†åˆ†æˆäº†ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œè¿™ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡éƒ½é‡åˆ°åŒä¸€èšåˆèŠ‚ç‚¹åï¼Œä»»åŠ¡å°±è¢«èšåˆèŠ‚ç‚¹å½’æ‹¢äº†ï¼Œå¼‚æ­¥ä»»åŠ¡ä¹Ÿå°±ç»“æŸäº†</p> <p>Â Â Â Â ğŸŸ¢ ä¸€ä¸ªæµç¨‹è¢«å¹¶è¡Œç½‘å…³æ‹†åˆ†æˆäº†ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡åˆåˆ†åˆ«æ‹†åˆ†å‡ºäº†ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œåªæœ‰å››ä¸ªå¼‚æ­¥ä»»åŠ¡å…¨éƒ¨èšåˆæ—¶ï¼Œæ‰ç®—çœŸæ­£æ„ä¹‰ä¸Šçš„å¼‚æ­¥æµç¨‹ç»“æŸï¼Œå¦‚ä¸‹çš„æµç¨‹å®šä¹‰æ˜¯å…è®¸çš„ï¼š</p> <p><a data-fancybox="" title="image-20211215163047312" href="http://cdn.kstry.cn/doc/img/image-20211215163047312.png" style="zoom:40%;"><img src="http://cdn.kstry.cn/doc/img/image-20211215163047312.png" alt="image-20211215163047312"></a></p> <p><strong>å½“å‰èšåˆèŠ‚ç‚¹çš„å…ƒç´ æœ‰ï¼š</strong></p> <p>Â Â Â Â ğŸŸ¢ å¹¶è¡Œç½‘å…³</p> <p>Â Â Â Â ğŸŸ¢ åŒ…å«ç½‘å…³</p> <p>Â Â Â Â ğŸŸ¢ ç»“æŸäº‹ä»¶</p> <p><a data-fancybox="" title="image-20211215163704815" href="http://cdn.kstry.cn/doc/img/image-20211215163704815.png"><img src="http://cdn.kstry.cn/doc/img/image-20211215163704815.png" alt="image-20211215163704815"></a></p> <p><strong>èšåˆèŠ‚ç‚¹å¯ä»¥éšå¿ƒæ‰€æ¬²çš„èšåˆå¤šä¸ªæµç¨‹ã€‚é™¤èšåˆèŠ‚ç‚¹å¤–çš„å…¶ä»–èŠ‚ç‚¹å…ƒç´ ï¼Œåªå…è®¸æ¥æ”¶ä¸€ä¸ªå…¥åº¦</strong></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>ä¹‹æ‰€ä»¥é™¤èšåˆèŠ‚ç‚¹å¤–çš„å…¶ä»–èŠ‚ç‚¹å…ƒç´ ï¼Œåªå…è®¸æ¥æ”¶ä¸€ä¸ªå…¥åº¦æ˜¯å› ä¸ºï¼šå­˜åœ¨å¤šä¸ªå…¥åº¦æ—¶ï¼Œå¦‚æœè¿™äº›å…¥åº¦æ˜¯å¼‚æ­¥çš„å°±ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°è¿™ä¸ªèšé›†ç‚¹ï¼Œå‡è®¾TaskèŠ‚ç‚¹å¯ä»¥æ”¯æŒå¤šå…¥åº¦ï¼Œé‚£ä¹ˆTaskèŠ‚ç‚¹å°±å¯èƒ½è¢«æ‰§è¡Œå¤šæ¬¡ã€‚å› ä¸ºTaskèŠ‚ç‚¹ä¸å…·å¤‡èšåˆèŠ‚ç‚¹çš„èƒ½åŠ›ï¼Œä¸èƒ½è®©å‰é¢çš„æµç¨‹åœä¸‹æ¥ç­‰å¾…å…¨éƒ¨æµç¨‹éƒ½åˆ°è¾¾åæ‰ç»§ç»­ã€‚æ¢å¥è¯è¯´åªæœ‰èšåˆèŠ‚ç‚¹æ‰èƒ½æ”¯æŒå¤šå…¥åº¦</p></div> <h3 id="_2-13-3-çº¿ç¨‹åˆ‡æ¢é’©å­"><a href="#_2-13-3-çº¿ç¨‹åˆ‡æ¢é’©å­" class="header-anchor">#</a> 2.13.3 çº¿ç¨‹åˆ‡æ¢é’©å­</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>æ¡†æ¶æä¾›äº†çº¿ç¨‹é—´åˆ‡æ¢æ—¶çš„å›è°ƒé’©å­ï¼Œç”¨æ¥ä¼ é€’çº¿ç¨‹åˆ‡æ¢å‰åçš„æ•°æ®ã€‚é’©å­åªå¯¹Kstryæ¡†æ¶ä¸­æ‰§è¡Œçš„ä»»åŠ¡ç”Ÿæ•ˆ</p></div> <p><strong>ä½¿ç”¨çº¿ç¨‹åˆ‡æ¢é’©å­</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwitchHook</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadSwitchHook</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ITERATOR_THREAD_LOCAL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPreviousData</span><span class="token punctuation">(</span><span class="token class-name">ScopeDataQuery</span> scopeDataQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ITERATOR_THREAD_LOCAL<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">usePreviousData</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">,</span> <span class="token class-name">ScopeDataQuery</span> scopeDataQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ITERATOR_THREAD_LOCAL<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Â Â Â Â ğŸŸ¢ ç”¨<code>ITERATOR_THREAD_LOCAL.set()</code>åœ¨è°ƒç”¨<code>engine.fire()</code>å‰è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåœ¨åé¢çš„ä»»æ„èŠ‚ç‚¹ä¸Šéƒ½å¯ä»¥ç”¨<code>SwitchHook.ITERATOR_THREAD_LOCAL.get()</code>æ‹¿åˆ°</p> <p>Â Â Â Â ğŸŸ¢ ä»»åŠ¡æ‰§è¡ŒæœŸé—´å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢æ—¶ï¼Œå®ç°<code>ThreadSwitchHook</code>æ¥å£çš„Springç»„ä»¶å°±ä¼šè¢«è°ƒç”¨</p> <p>Â Â Â Â ğŸŸ¢ çº¿ç¨‹åˆ‡æ¢å‰è°ƒç”¨<code>getPreviousData(ScopeDataQuery scopeDataQuery)</code>è·å–åˆ°è¦ä¿å­˜çš„å€¼ï¼Œçº¿ç¨‹åˆ‡æ¢åå†è°ƒç”¨<code>usePreviousData(String data, ScopeDataQuery scopeDataQuery)</code>å°†åˆ‡æ¢å‰æ‹¿åˆ°çš„æ•°æ®ä¼ å…¥ï¼Œç”¨ä»¥åç»­çš„ä½¿ç”¨</p> <p>Â Â Â Â ğŸŸ¢ <code>ThreadSwitchHook</code>ç»„ä»¶å‡ºç°å¤šä¸ªæ—¶ï¼Œé‡å†™<code>getOrder()</code>æ–¹æ³•å³å¯æ”¯æŒæ’åº</p> <h3 id="_2-13-4-reactoræ¨¡å‹"><a href="#_2-13-4-reactoræ¨¡å‹" class="header-anchor">#</a> 2.13.4 Reactoræ¨¡å‹</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>é»˜è®¤æƒ…å†µä¸‹èŠ‚ç‚¹æ–¹æ³•ä¸­è°ƒç”¨è€—æ—¶é•¿çš„æ¥å£æ—¶ä¼šäº§ç”Ÿå·¥ä½œçº¿ç¨‹çš„ç­‰å¾…ï¼Œä»è€Œå½±å“æ•´ä¸ªç³»ç»Ÿçš„ååã€‚æ–¹æ³•æ”¯æŒè¿”å›Monoç±»å‹ç»“æœæ¥é‡Šæ”¾å·¥ä½œçº¿ç¨‹å¹¶ç­‰å¾…è¯·æ±‚å®Œæˆåçš„å›è°ƒï¼Œåç”¨å›è°ƒæ¥æ¨è¿›æµç¨‹çš„ä¸‹ä¸€æ­¥åŠ¨ä½œ</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TaskService</span>
<span class="token annotation punctuation">@NoticeVar</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token class-name">QueryScoreVarScope<span class="token punctuation">.</span>F</span><span class="token punctuation">.</span>classInfos<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ClassInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getClasInfoById</span><span class="token punctuation">(</span><span class="token class-name">IterDataItem</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> classIdItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromFuture</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// mock return result</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> idOptional <span class="token operator">=</span> classIdItem<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClassInfo</span> classInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        classInfo<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>idOptional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        classInfo<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;ç­çº§&quot;</span> <span class="token operator">+</span> idOptional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>classInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> classInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Â Â Â Â ğŸŸ¢ é™¤äº†è¿”å›å€¼ç±»å‹å˜ä¸ºMonoç±»å‹ï¼Œå…¶ä»–åœ°æ–¹ä¸é»˜è®¤èŠ‚ç‚¹æ–¹æ³•ä½¿ç”¨æ–¹å¼å®Œå…¨ç›¸åŒ</p> <p>Â Â Â Â ğŸŸ¢ ç¤ºä¾‹ä¸­æ–¹æ³•ä¼šç›´æ¥è¿”å›Monoå¯¹è±¡ï¼ŒæœŸé—´ä¸ä¼šå‡ºç°ä»»ä½•åœæ»ï¼Œæ‰§è¡Œå¼•æ“æ‹¿åˆ°Monoå¯¹è±¡ä¹‹åä¼šé‡Šæ”¾å½“å‰çº¿ç¨‹ï¼Œç›´è‡³Monoè¿”å›æˆåŠŸæˆ–å¤±è´¥ä¿¡å·åï¼Œå›è°ƒåŠ¨ä½œç»§ç»­é©±åŠ¨æµç¨‹å‘åæ‰§è¡Œ</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/doc/specification/quick_start.html" class="prev">
        ä¸€ã€å¿«é€Ÿå¼€å§‹
      </a></span> <span class="next"><a href="/doc/specification/data_transfer.html">
        ä¸‰ã€æ•°æ®æµè½¬
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fc8f11ce.js" defer></script><script src="/assets/js/2.6d18f2ff.js" defer></script><script src="/assets/js/3.84f41dcf.js" defer></script>
  </body>
</html>
